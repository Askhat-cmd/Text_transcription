–ö–æ–Ω–µ—á–Ω–æ! –°–æ—Å—Ç–∞–≤–ª—é –¥–µ—Ç–∞–ª—å–Ω—ã–π –ü–†–î (Product Requirements Document) –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø–∞–º—è—Ç–∏ –¥–∏–∞–ª–æ–≥–∞ –≤ –≤–∞—à –ø—Ä–æ–µ–∫—Ç.

***

# Product Requirements Document (–ü–†–î)

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–∞–º—è—Ç–∏ –¥–∏–∞–ª–æ–≥–∞ –≤ Bot Psychologist

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 06 —Ñ–µ–≤—Ä–∞–ª—è 2026  
**–ê–≤—Ç–æ—Ä:** System Architect  
**–ü—Ä–æ–µ–∫—Ç:** bot_psychologist (Text_transcription)

***

## 1. –û–±–∑–æ—Ä –∏ —Ü–µ–ª–∏

### 1.1 –ü—Ä–æ–±–ª–µ–º–∞

–ë–æ—Ç-–ø—Å–∏—Ö–æ–ª–æ–≥ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞ –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏. –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫:

- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Å—Ç–æ–∏–º–µ–Ω–∏—è –∏ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å—ã ("—ç—Ç–æ", "—Ç–æ—Ç –º–µ—Ç–æ–¥", "–∫–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å —ç—Ç–æ?")
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏—é –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —É—á–µ—Ç–∞ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –¥–∏–Ω–∞–º–∏–∫–µ
- –ü–æ—Ç–µ—Ä–µ —Å–≤—è–∑–Ω–æ—Å—Ç–∏ –±–µ—Å–µ–¥—ã, –∫—Ä–∏—Ç–∏—á–Ω–æ–π –¥–ª—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–≤—Ç–æ—Ä—è—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏

### 1.2 –†–µ—à–µ–Ω–∏–µ

–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–æ–¥—É–ª—å `conversation_memory.py` –≤ –ø—Ä–æ—Ü–µ—Å—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤, –æ–±–µ—Å–ø–µ—á–∏–≤ –ø–µ—Ä–µ–¥–∞—á—É –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞ –≤ LLM –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ.

### 1.3 –¶–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞

**–û—Å–Ω–æ–≤–Ω—ã–µ:**
- –û–±–µ—Å–ø–µ—á–∏—Ç—å –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ—Å—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∏–∞–ª–æ–≥–∞ –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å —Ä–µ—Ñ–µ—Ä–µ–Ω—Å—ã –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –æ–±–º–µ–Ω—ã
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ:**
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤
- –î–æ–±–∞–≤–∏—Ç—å API endpoints –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–µ–π
- –í–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –≤ Web UI

### 1.4 –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ | –¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|------------------|------------------|
| –£—Å–ø–µ—à–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–æ–≤ | 0% | 85%+ |
| –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ | –ù–µ—Ç | 100% |
| –°—Ä–µ–¥–Ω—è—è –≥–ª—É–±–∏–Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ | 0 —Å–æ–æ–±—â–µ–Ω–∏–π | 3-5 —Å–æ–æ–±—â–µ–Ω–∏–π |
| –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ —Å –ø–∞–º—è—Ç—å—é | N/A | < 3 —Å–µ–∫ |

***

## 2. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 2.1 –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

#### FR-1: –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π  
**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:** `answer_basic.py`, `answer_sag_aware.py`, `answer_graph_powered.py`, `answer_adaptive.py`

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –ü—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ò—Å—Ç–æ—Ä–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é `get_conversation_memory(user_id)`
- –ï—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –ø–∞–º—è—Ç–∏

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**
```python
# –í—Å–µ answer_*.py —Ñ–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
memory = get_conversation_memory(user_id)
conversation_context = memory.get_context_for_llm(n=3)
```

***

#### FR-2: –ü–µ—Ä–µ–¥–∞—á–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ LLM

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π  
**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:** `llm_answerer.py`

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –ú–µ—Ç–æ–¥ `generate_answer()` –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `conversation_history`
- –ò—Å—Ç–æ—Ä–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–µ—Ä–µ–¥ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
- –ï—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞—è, —Ä–∞–±–æ—Ç–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)

**–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è API:**

```python
def generate_answer(
    self,
    user_question: str,
    blocks: List[Block],
    conversation_history: Optional[str] = None,  # –ù–û–í–´–ô –ü–ê–†–ê–ú–ï–¢–†
    model: Optional[str] = None,
    temperature: Optional[float] = None,
    max_tokens: Optional[int] = None
) -> Dict:
    """
    Args:
        conversation_history: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö N –æ–±–º–µ–Ω–æ–≤
    """
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**
- –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —Å `conversation_history=None` (–æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
- –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–µ–π
- –ò—Å—Ç–æ—Ä–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –≤ –ø—Ä–æ–º–ø—Ç –ø–µ—Ä–µ–¥ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏

***

#### FR-3: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±–º–µ–Ω–æ–≤ –≤ –ø–∞–º—è—Ç—å

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π  
**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:** –í—Å–µ `answer_*.py` —Ñ–∞–π–ª—ã

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ–±–º–µ–Ω –≤ –ø–∞–º—è—Ç—å
- –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è: –≤–æ–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤, –∫–æ–Ω—Ü–µ–ø—Ç—ã, —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–¥–ª—è Phase 4)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –¥–∏—Å–∫

**–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è:**

```python
memory.add_turn(
    user_input=question,
    bot_response=result["answer"],
    user_state=user_state,  # —Ç–æ–ª—å–∫–æ –¥–ª—è Phase 4
    blocks_used=len(top_blocks),
    concepts=[b.title for b in top_blocks]
)
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**
- –§–∞–π–ª –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ `.cache_bot_agent/conversations/{user_id}.json`
- –ò—Å—Ç–æ—Ä–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—Ä–æ—Å–µ
- –ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –æ–±–º–µ–Ω–∞

***

#### FR-4: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π  
**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:** `conversation_memory.py`

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –ú–µ—Ç–æ–¥ `get_context_for_llm()` –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π (n) –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä (max_chars)
- –°—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–±—Ä–µ–∑–∞—é—Ç—Å—è –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞

**–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è:**

```python
def get_context_for_llm(
    self, 
    n: int = 3, 
    max_chars: int = 2000
) -> str:
    """
    Args:
        n: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –æ–±–º–µ–Ω–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3)
        max_chars: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ —Å–∏–º–≤–æ–ª–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 2000)
    
    Returns:
        –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–±—Ä–µ–∑–∫–æ–π
    """
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç `max_chars` —Å–∏–º–≤–æ–ª–æ–≤
- –ë–æ–ª–µ–µ –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–µ–µ —Å—Ç–∞—Ä—ã—Ö
- –û—Ç–≤–µ—Ç—ã –±–æ—Ç–∞ –æ–±—Ä–µ–∑–∞—é—Ç—Å—è –¥–æ 200 —Å–∏–º–≤–æ–ª–æ–≤ + "..."

***

#### FR-5: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ user_id –≤ API

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π  
**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:** `api/routes.py`, `api/models.py`

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –í—Å–µ endpoints –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏–Ω–∏–º–∞—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `user_id`
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `user_id = "default"`
- –ò—Å—Ç–æ—Ä–∏—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

**–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è API:**

```python
class QuestionRequest(BaseModel):
    question: str
    user_id: str = "default"  # –ù–û–í–û–ï –ü–û–õ–ï
    user_level: str = "beginner"
    top_k: int = 5
```

**Endpoints, —Ç—Ä–µ–±—É—é—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
- `POST /api/v1/questions/basic`
- `POST /api/v1/questions/sag-aware`
- `POST /api/v1/questions/graph-powered`
- `POST /api/v1/questions/adaptive`

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**
- –í—Å–µ endpoints –ø—Ä–∏–Ω–∏–º–∞—é—Ç `user_id`
- Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- –ò–∑–æ–ª—è—Ü–∏—è –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞

***

#### FR-6: API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–µ–π

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π  
**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:** `api/routes.py`

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å endpoints –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏—Å—Ç–æ—Ä–∏–µ–π –¥–∏–∞–ª–æ–≥–æ–≤.

**–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è:**

```python
# 1. –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET /api/v1/users/{user_id}/history
Query params:
  - limit: int = 10  # –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –æ–±–º–µ–Ω–æ–≤

Response:
{
  "user_id": "test_user",
  "total_turns": 15,
  "turns": [
    {
      "timestamp": "2026-02-06T14:30:00",
      "user_input": "–ß—Ç–æ —Ç–∞–∫–æ–µ –æ—Å–æ–∑–Ω–∞–≤–∞–Ω–∏–µ?",
      "bot_response": "–û—Å–æ–∑–Ω–∞–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ...",
      "user_state": "curiosity",
      "blocks_used": 3
    }
  ]
}

# 2. –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
DELETE /api/v1/users/{user_id}/history

Response:
{
  "status": "success",
  "message": "–ò—Å—Ç–æ—Ä–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è test_user –æ—á–∏—â–µ–Ω–∞"
}

# 3. –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å—Ç–æ—Ä–∏–∏
GET /api/v1/users/{user_id}/summary

Response:
{
  "user_id": "test_user",
  "total_turns": 15,
  "primary_interests": ["–æ—Å–æ–∑–Ω–∞–≤–∞–Ω–∏–µ", "–º–µ–¥–∏—Ç–∞—Ü–∏—è", "—Å—Ç—Ä–µ—Å—Å"],
  "num_breakthroughs": 2,
  "average_rating": 4.2,
  "user_level": "intermediate",
  "last_interaction": "2026-02-06T14:30:00"
}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**
- –í—Å–µ 3 endpoint'–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- –¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ —Å–ª—É—á–∞–∏

***

### 2.2 –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

#### NFR-1: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑ —Ñ–∞–π–ª–∞: < 50 –º—Å
- –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞: < 100 –º—Å
- –û–±—â–µ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞: < 10%

#### NFR-2: –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–æ 10,000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –∏—Å—Ç–æ—Ä–∏—è–º–∏
- –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –∏—Å—Ç–æ—Ä–∏–∏: < 1 –ú–ë –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π (> 1000 –æ–±–º–µ–Ω–æ–≤)

#### NFR-3: –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å

- –ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ –¥–∏—Å–∫ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –æ–±–º–µ–Ω–∞
- Graceful degradation –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–∞ –∏—Å—Ç–æ—Ä–∏–∏
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ API

#### NFR-4: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ—Å—Ç—å

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `.env`:

```env
# –ì–ª—É–±–∏–Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π)
CONVERSATION_HISTORY_DEPTH=3

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (—Å–∏–º–≤–æ–ª—ã)
MAX_CONTEXT_SIZE=2000

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è –∏—Å—Ç–æ—Ä–∏–∏
MAX_CONVERSATION_TURNS=1000
```

***

## 3. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è

### 3.1 –ò–∑–º–µ–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –¢–∏–ø –∏–∑–º–µ–Ω–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|---------------|----------|
| `bot_agent/llm_answerer.py` | –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è | –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `conversation_history` |
| `bot_agent/answer_basic.py` | –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è | –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–∞–º—è—Ç—å |
| `bot_agent/answer_sag_aware.py` | –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è | –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–∞–º—è—Ç—å |
| `bot_agent/answer_graph_powered.py` | –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è | –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–∞–º—è—Ç—å |
| `bot_agent/answer_adaptive.py` | –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è | –£–≥–ª—É–±–ª–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–∞–º—è—Ç–∏ |
| `bot_agent/conversation_memory.py` | –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è | –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è `get_context_for_llm()` |
| `bot_agent/config.py` | –î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ | –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã |
| `api/models.py` | –î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ | –î–æ–±–∞–≤–∏—Ç—å `user_id` –≤ –º–æ–¥–µ–ª–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ |
| `api/routes.py` | –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è + –î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ | –û–±–Ω–æ–≤–∏—Ç—å endpoints, –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ |
| `test_memory_integration.py` | –°–æ–∑–¥–∞–Ω–∏–µ | –ù–æ–≤—ã–π —Ñ–∞–π–ª —Å —Ç–µ—Å—Ç–∞–º–∏ |

### 3.2 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   User      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ HTTP Request
       ‚îÇ {question, user_id}
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   API Routes        ‚îÇ
‚îÇ  (routes.py)        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Answer Module      ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  ConversationMemory  ‚îÇ
‚îÇ  (answer_*.py)      ‚îÇ load    ‚îÇ  (memory.py)         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                               ‚îÇ
       ‚îÇ get_context_for_llm()         ‚îÇ load_from_disk()
       ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   LLM Answerer      ‚îÇ
‚îÇ  (llm_answerer.py)  ‚îÇ
‚îÇ                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ System Prompt ‚îÇ  ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îÇ
‚îÇ  ‚îÇ History (3-5) ‚îÇ  ‚îÇ‚óÄ‚îÄ‚îÄ conversation_history
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îÇ
‚îÇ  ‚îÇ Context Blocks‚îÇ  ‚îÇ‚óÄ‚îÄ‚îÄ retrieved blocks
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îÇ
‚îÇ  ‚îÇ User Question ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº OpenAI API
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   GPT-4/3.5         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº Response
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Save to Memory     ‚îÇ
‚îÇ  memory.add_turn()  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 3.3 –§–æ—Ä–º–∞—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è LLM

```
–ò–°–¢–û–†–ò–Ø –î–ò–ê–õ–û–ì–ê:

–û–±–º–µ–Ω #1:
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ß—Ç–æ —Ç–∞–∫–æ–µ –æ—Å–æ–∑–Ω–∞–≤–∞–Ω–∏–µ?
–ë–æ—Ç: –û—Å–æ–∑–Ω–∞–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –Ω–∞–±–ª—é–¥–∞—Ç—å –∑–∞ —Å–≤–æ–∏–º–∏ –º—ã—Å–ª—è–º–∏...
–°–æ—Å—Ç–æ—è–Ω–∏–µ: curiosity

–û–±–º–µ–Ω #2:
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ê –∫–∞–∫ —ç—Ç–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ?
–ë–æ—Ç: –ù–∞—á–Ω–∏—Ç–µ —Å –ø—Ä–æ—Å—Ç–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è: –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è...
–°–æ—Å—Ç–æ—è–Ω–∏–µ: seeking_practical

–û–±–º–µ–Ω #3:
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ —ç—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç?
–ë–æ—Ç: –î–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è...
–°–æ—Å—Ç–æ—è–Ω–∏–µ: planning

--- –¢–ï–ö–£–©–ò–ô –ó–ê–ü–†–û–° ---

–ú–ê–¢–ï–†–ò–ê–õ –ò–ó –õ–ï–ö–¶–ò–ô:

--- –ë–õ–û–ö 1 ---
–õ–µ–∫—Ü–∏—è: –í–≤–µ–¥–µ–Ω–∏–µ –≤ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å
–¢–µ–º–∞: –ü—Ä–∞–∫—Ç–∏–∫–∞ –æ—Å–æ–∑–Ω–∞–≤–∞–Ω–∏—è
...
```

***

## 4. –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 4.1 –≠—Ç–∞–ø—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

#### –≠—Ç–∞–ø 1: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (2-3 –¥–Ω—è)

**–ó–∞–¥–∞—á–∏:**
1. –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è `llm_answerer.py` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `conversation_history`
2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–∞–º—è—Ç–∏ –≤ `answer_basic.py`
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `conversation_memory.py` ‚Äî —É–ª—É—á—à–∏—Ç—å `get_context_for_llm()`
4. –ë–∞–∑–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Phase 1 —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø–∞–º—è—Ç—å—é –¥–∏–∞–ª–æ–≥–∞

***

#### –≠—Ç–∞–ø 2: –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (2-3 –¥–Ω—è)

**–ó–∞–¥–∞—á–∏:**
1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–∞–º—è—Ç–∏ –≤ `answer_sag_aware.py`
2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–∞–º—è—Ç–∏ –≤ `answer_graph_powered.py`
3. –£–≥–ª—É–±–ª–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `answer_adaptive.py`
4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ `config.py`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ —Ñ–∞–∑—ã (1-4) —Ä–∞–±–æ—Ç–∞—é—Ç —Å –ø–∞–º—è—Ç—å—é

***

#### –≠—Ç–∞–ø 3: API –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (2 –¥–Ω—è)

**–ó–∞–¥–∞—á–∏:**
1. –î–æ–±–∞–≤–∏—Ç—å `user_id` –≤ –º–æ–¥–µ–ª–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ (`api/models.py`)
2. –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ endpoints –≤ `api/routes.py`
3. –î–æ–±–∞–≤–∏—Ç—å endpoints –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–µ–π
4. –û–±–Ω–æ–≤–∏—Ç—å Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç user_id –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π

***

#### –≠—Ç–∞–ø 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (2 –¥–Ω—è)

**–ó–∞–¥–∞—á–∏:**
1. –°–æ–∑–¥–∞—Ç—å `test_memory_integration.py`
2. –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è API
4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
5. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

***

#### –≠—Ç–∞–ø 5: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ UI (1-2 –¥–Ω—è)

**–ó–∞–¥–∞—á–∏:**
1. –û–±–Ω–æ–≤–∏—Ç—å `README.md` —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –ø–∞–º—è—Ç–∏
2. –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ `docs/`
3. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏ –≤ Web UI
4. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –≥–∞–π–¥ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è, –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production

***

### 4.2 Timeline

```
–ù–µ–¥–µ–ª—è 1:
  –î–µ–Ω—å 1-2:  –≠—Ç–∞–ø 1 (–ë–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
  –î–µ–Ω—å 3-4:  –≠—Ç–∞–ø 2 (–ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
  –î–µ–Ω—å 5:    –≠—Ç–∞–ø 3 (API)

–ù–µ–¥–µ–ª—è 2:
  –î–µ–Ω—å 1-2:  –≠—Ç–∞–ø 4 (–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
  –î–µ–Ω—å 3:    –≠—Ç–∞–ø 5 (–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
  –î–µ–Ω—å 4-5:  –†–µ–∑–µ—Ä–≤ –∏ –±–∞–≥—Ñ–∏–∫—Å–∏–Ω–≥
```

**–û–±—â–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 8-10 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π

***

## 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 5.1 Unit-—Ç–µ—Å—Ç—ã

```python
# test_memory_integration.py

def test_llm_answerer_with_history():
    """–¢–µ—Å—Ç: LLMAnswerer –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é"""
    answerer = LLMAnswerer()
    blocks = [...]
    history = "–û–±–º–µ–Ω #1:\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ß—Ç–æ —Ç–∞–∫–æ–µ –º–µ–¥–∏—Ç–∞—Ü–∏—è?\n..."
    
    result = answerer.generate_answer(
        user_question="–ê –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?",
        blocks=blocks,
        conversation_history=history
    )
    
    assert result["answer"] is not None
    assert "error" not in result or result["error"] is None

def test_memory_save_and_load():
    """–¢–µ—Å—Ç: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –ø–∞–º—è—Ç–∏"""
    user_id = "test_user_123"
    memory = get_conversation_memory(user_id)
    
    memory.add_turn(
        user_input="–¢–µ—Å—Ç –≤–æ–ø—Ä–æ—Å",
        bot_response="–¢–µ—Å—Ç –æ—Ç–≤–µ—Ç",
        blocks_used=2
    )
    
    # –ó–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–Ω–æ–≤–æ
    memory2 = ConversationMemory(user_id)
    memory2.load_from_disk()
    
    assert len(memory2.turns) == 1
    assert memory2.turns[0].user_input == "–¢–µ—Å—Ç –≤–æ–ø—Ä–æ—Å"

def test_context_size_limit():
    """–¢–µ—Å—Ç: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞"""
    memory = ConversationMemory("test")
    
    # –î–æ–±–∞–≤–∏—Ç—å 10 –¥–ª–∏–Ω–Ω—ã—Ö –æ–±–º–µ–Ω–æ–≤
    for i in range(10):
        memory.add_turn(
            user_input=f"–í–æ–ø—Ä–æ—Å {i}" * 100,
            bot_response=f"–û—Ç–≤–µ—Ç {i}" * 200,
            blocks_used=1
        )
    
    context = memory.get_context_for_llm(n=10, max_chars=2000)
    
    assert len(context) <= 2000

def test_reference_resolution():
    """–¢–µ—Å—Ç: –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–æ–≤"""
    user_id = "test_ref_user"
    
    # –ü–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å
    result1 = answer_question(
        question="–†–∞—Å—Å–∫–∞–∂–∏ –ø—Ä–æ –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏",
        user_id=user_id
    )
    
    # –í—Ç–æ—Ä–æ–π –≤–æ–ø—Ä–æ—Å —Å —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–æ–º
    result2 = answer_question(
        question="–ö–∞–∫ —á–∞—Å—Ç–æ —ç—Ç–æ –¥–µ–ª–∞—Ç—å?",  # "—ç—Ç–æ" = –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏
        user_id=user_id
    )
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞: –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å
    memory = get_conversation_memory(user_id)
    context = memory.get_context_for_llm(n=2)
    
    assert "–¥—ã—Ö–∞—Ç–µ–ª—å–Ω" in context.lower()
    assert "–ö–∞–∫ —á–∞—Å—Ç–æ —ç—Ç–æ –¥–µ–ª–∞—Ç—å?" in context
```

### 5.2 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

```python
def test_api_with_user_id():
    """–¢–µ—Å—Ç: API endpoints –ø—Ä–∏–Ω–∏–º–∞—é—Ç user_id"""
    client = TestClient(app)
    
    response = client.post("/api/v1/questions/basic", json={
        "question": "–ß—Ç–æ —Ç–∞–∫–æ–µ –º–µ–¥–∏—Ç–∞—Ü–∏—è?",
        "user_id": "api_test_user",
        "top_k": 5
    })
    
    assert response.status_code == 200
    assert "answer" in response.json()

def test_history_isolation():
    """–¢–µ—Å—Ç: –ò—Å—Ç–æ—Ä–∏—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏"""
    client = TestClient(app)
    
    # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 1
    client.post("/api/v1/questions/basic", json={
        "question": "–í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 1",
        "user_id": "user_1"
    })
    
    # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 2
    client.post("/api/v1/questions/basic", json={
        "question": "–í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 2",
        "user_id": "user_2"
    })
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–æ—Ä–∏–π
    history1 = client.get("/api/v1/users/user_1/history").json()
    history2 = client.get("/api/v1/users/user_2/history").json()
    
    assert len(history1["turns"]) == 1
    assert len(history2["turns"]) == 1
    assert history1["turns"][0]["user_input"] != history2["turns"][0]["user_input"]
```

### 5.3 –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏

- [ ] –í—Å–µ unit-—Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (coverage > 80%)
- [ ] –í—Å–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –†–µ—Ñ–µ—Ä–µ–Ω—Å—ã —Ä–∞–∑—Ä–µ—à–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤ 85%+ —Å–ª—É—á–∞–µ–≤
- [ ] –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ —É–≤–µ–ª–∏—á–∏–ª–æ—Å—å –Ω–µ –±–æ–ª–µ–µ —á–µ–º –Ω–∞ 10%
- [ ] –ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] API endpoints —Ä–∞–±–æ—Ç–∞—é—Ç —Å `user_id`
- [ ] Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] README.md —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

***

## 6. –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|---------|-----------|
| –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤ OpenAI | –í—ã—Å–æ–∫–∞—è | –°—Ä–µ–¥–Ω. | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (2000 —Å–∏–º–≤–æ–ª–æ–≤) |
| –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏—Å—Ç–æ—Ä–∏–∏ | –°—Ä–µ–¥–Ω—è—è | –°—Ä–µ–¥–Ω. | –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –ø–∞–º—è—Ç–∏ –≤ `_memory_instances` |
| –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –¥–æ—Å—Ç—É–ø–µ –∫ —Ñ–∞–π–ª—É | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫. | File locking –∏–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –ë–î (–±—É–¥—É—â–µ–µ) |
| –û–±—Ä–∞—Ç–Ω–∞—è –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å API | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫. | `user_id` –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `"default"` |
| –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∏—Å–∫–∞ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π | –°—Ä–µ–¥–Ω—è—è | –°—Ä–µ–¥–Ω. | –†–æ—Ç–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π (> 1000 –æ–±–º–µ–Ω–æ–≤) |

***

## 7. –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –§–∞–∑–∞ 2 (–ø–æ—Å–ª–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)

1. **–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö**
   - PostgreSQL –∏–ª–∏ SQLite –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏
   - –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ concurrent access

2. **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏**
   - –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –æ–±–º–µ–Ω–æ–≤
   - –ü–æ–∏—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –æ–±–º–µ–Ω–æ–≤ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N)

3. **–£–º–Ω–∞—è –∫–æ–º–ø—Ä–µ—Å—Å–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**
   - Summarization –¥–ª–∏–Ω–Ω—ã—Ö –∏—Å—Ç–æ—Ä–∏–π —á–µ—Ä–µ–∑ LLM
   - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –≤—ã–±–æ—Ä —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –æ–±–º–µ–Ω–æ–≤

4. **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –≤ Web UI**
   - Timeline —Å –æ–±–º–µ–Ω–∞–º–∏
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é, –∫–æ–Ω—Ü–µ–ø—Ç–∞–º
   - Export –∏—Å—Ç–æ—Ä–∏–∏ –≤ PDF/JSON

5. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ insights**
   - –¢—Ä–µ–∫–∏–Ω–≥ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–æ –≤—Ä–µ–º–µ–Ω–∏
   - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

***

## 8. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ A: –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

**–ü–æ–ª–Ω—ã–π –∫–æ–¥ –¥–ª—è `answer_basic.py`:**

```python
# bot_agent/answer_basic.py

import logging
from typing import Dict, List
from .data_loader import get_data_loader
from .retriever import Retriever
from .llm_answerer import LLMAnswerer
from .conversation_memory import get_conversation_memory

logger = logging.getLogger(__name__)

def answer_question(
    question: str,
    user_id: str = "default",
    user_level: str = "beginner",
    top_k: int = 5,
) -> Dict:
    """
    Phase 1: –ë–∞–∑–æ–≤—ã–π QA —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –ø–∞–º—è—Ç–∏ –¥–∏–∞–ª–æ–≥–∞
    
    Args:
        question: –í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        user_id: –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        user_level: –£—Ä–æ–≤–µ–Ω—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Phase 1)
        top_k: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞
        
    Returns:
        Dict —Å –æ—Ç–≤–µ—Ç–æ–º –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
    """
    logger.info(f"üîç Phase 1 Basic QA: {question} (user: {user_id})")
    
    # 1. –ó–ê–ì–†–£–ó–ò–¢–¨ –ü–ê–ú–Ø–¢–¨
    memory = get_conversation_memory(user_id)
    conversation_context = memory.get_context_for_llm(n=3)
    
    # 2. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    loader = get_data_loader()
    blocks = loader.get_all_blocks()
    
    logger.debug(f"üìö –ó–∞–≥—Ä—É–∂–µ–Ω–æ –±–ª–æ–∫–æ–≤: {len(blocks)}")
    
    # 3. –ü–æ–∏—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –±–ª–æ–∫–æ–≤
    retriever = Retriever(blocks)
    results = retriever.search(question, top_k=top_k)
    
    if not results:
        logger.warning("‚ö†Ô∏è –ù–µ –Ω–∞–π–¥–µ–Ω–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –±–ª–æ–∫–æ–≤")
        response = (
            "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —è –Ω–µ –Ω–∞—à—ë–ª —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –¥–ª—è —ç—Ç–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞. "
            "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –∑–∞–¥–∞—Ç—å –±–æ–ª–µ–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≤–æ–ø—Ä–æ—Å."
        )
        
        # –°–û–•–†–ê–ù–ò–¢–¨ –í –ü–ê–ú–Ø–¢–¨
        memory.add_turn(
            user_input=question,
            bot_response=response,
            blocks_used=0
        )
        
        return {
            "answer": response,
            "blocks_used": 0,
            "sources": [],
            "model": None,
            "tokens": 0
        }
    
    # 4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∏—Å—Ç–æ—Ä–∏–∏
    answerer = LLMAnswerer()
    top_blocks = [r["block"] for r in results]
    
    logger.debug(f"ü§ñ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ (—Ç–æ–ø-{len(top_blocks)} –±–ª–æ–∫–æ–≤)...")
    
    result = answerer.generate_answer(
        user_question=question,
        blocks=top_blocks,
        conversation_history=conversation_context  # –ü–ï–†–ï–î–ê–¢–¨ –ò–°–¢–û–†–ò–Æ
    )
    
    # 5. –°–û–•–†–ê–ù–ò–¢–¨ –í –ü–ê–ú–Ø–¢–¨
    memory.add_turn(
        user_input=question,
        bot_response=result["answer"],
        blocks_used=len(top_blocks),
        concepts=[b.title for b in top_blocks]
    )
    
    logger.info(f"‚úÖ –û—Ç–≤–µ—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω ({result['tokens_used']} —Ç–æ–∫–µ–Ω–æ–≤)")
    
    # 6. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    return {
        "answer": result["answer"],
        "blocks_used": len(top_blocks),
        "sources": [
            {
                "title": b.title,
                "document": b.document_title,
                "link": b.youtube_link,
                "start": b.start,
                "end": b.end,
                "similarity": results[i]["score"]
            }
            for i, b in enumerate(top_blocks)
        ],
        "model": result["model_used"],
        "tokens": result["tokens_used"]
    }
```

***

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ B: –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π .env.example

```env
# ============================================
# Bot Psychologist Configuration
# ============================================

# ===== OpenAI =====
OPENAI_API_KEY=sk-proj-your-key-here

# LLM –º–æ–¥–µ–ª—å
LLM_MODEL=gpt-4o-mini
LLM_TEMPERATURE=0.7
LLM_MAX_TOKENS=800

# ===== Data Paths =====
DATA_ROOT=../voice_bot_pipeline/data

# ===== Cache =====
CACHE_DIR=.cache_bot_agent

# ===== Memory Configuration =====
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
CONVERSATION_HISTORY_DEPTH=3

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏—Å—Ç–æ—Ä–∏–∏ (—Å–∏–º–≤–æ–ª—ã)
MAX_CONTEXT_SIZE=2000

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±–º–µ–Ω–æ–≤ –≤ –∏—Å—Ç–æ—Ä–∏–∏ (–¥–ª—è —Ä–æ—Ç–∞—Ü–∏–∏)
MAX_CONVERSATION_TURNS=1000

# ===== Retrieval =====
RETRIEVAL_TOP_K=5
```

***

## 9. –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å

| –†–æ–ª—å | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å | –ö–æ–Ω—Ç–∞–∫—Ç |
|------|----------------|---------|
| Product Owner | –ü—Ä–∏–µ–º–∫–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã | Askhat-cmd |
| Backend Developer | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø–∞–º—è—Ç–∏ | TBD |
| QA Engineer | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –≤–∞–ª–∏–¥–∞—Ü–∏—è | TBD |
| DevOps | –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ | TBD |

***

## 10. –ì–ª–æ—Å—Å–∞—Ä–∏–π

| –¢–µ—Ä–º–∏–Ω | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ |
|--------|-------------|
| **Conversation Memory** | –ú–æ–¥—É–ª—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| **Context** | –ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö N –æ–±–º–µ–Ω–æ–≤, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º–∞—è –≤ LLM |
| **Turn** | –û–¥–∏–Ω –æ–±–º–µ–Ω (–≤–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è + –æ—Ç–≤–µ—Ç –±–æ—Ç–∞) |
| **–†–µ—Ñ–µ—Ä–µ–Ω—Å** | –û—Ç—Å—ã–ª–∫–∞ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç—É ("—ç—Ç–æ", "—Ç–æ—Ç –º–µ—Ç–æ–¥") |
| **user_id** | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –∏—Å—Ç–æ—Ä–∏–π |
| **Phase 1-4** | –≠—Ç–∞–ø—ã —Ä–∞–∑–≤–∏—Ç–∏—è –±–æ—Ç–∞ (Basic QA ‚Üí Adaptive QA) |

***

**–ö–æ–Ω–µ—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞**

***

–≠—Ç–æ—Ç –ü–†–î –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ø—Ä–∏–Ω—Ç–æ–≤, –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–¥–∞—á –≤ —Ç—Ä–µ–∫–µ—Ä–µ (Jira/Linear) –∏ –∫–∞–∫ —Å–ø—Ä–∞–≤–æ—á–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –≤—Å–µ–π –∫–æ–º–∞–Ω–¥—ã.