# Task ID: 24
# Title: Phase 4.4: Создание answer_adaptive.py — Адаптивный QA
# Status: done
# Dependencies: 21, 22, 23
# Priority: high
# Description: Основная функция Phase 4: answer_question_adaptive. Интеграция всех компонентов: state_classifier, conversation_memory, path_builder с базовыми компонентами Phase 1-3.
# Details:
Создать bot_agent/answer_adaptive.py с answer_question_adaptive(): 1) Параметры: query, user_id, user_level, include_path_recommendation, include_feedback_prompt, debug, 2) Этап 1: загрузка данных и памяти, 3) Этап 2: анализ состояния через state_classifier, 4) Этап 3: поиск блоков через retriever, 5) Этап 4: генерация ответа с контекстом состояния, 6) Этап 5: рекомендация пути через path_builder, 7) Этап 6: подготовка запроса обратной связи, 8) Этап 7: сохранение в conversation_memory, 9) Возврат расширенного Dict: status, answer, state_analysis, path_recommendation, conversation_context, feedback_prompt, sources, concepts, metadata.

# Test Strategy:


# Subtasks:
## 1. 4.4.1 Создать структуру answer_question_adaptive с импортами [done]
### Dependencies: None
### Description: Импорты: data_loader, retriever, LLMAnswerer, UserLevelAdapter, SemanticAnalyzer, graph_client, state_classifier, conversation_memory, path_builder, config
### Details:


## 2. 4.4.2 Этапы 1-2: Загрузка данных, памяти, анализ состояния [done]
### Dependencies: None
### Description: Загрузка data_loader, get_conversation_memory(user_id), state_classifier.analyze_message с history context
### Details:


## 3. 4.4.3 Этапы 3-4: Поиск блоков, генерация ответа с контекстом состояния [done]
### Dependencies: None
### Description: Retriever search, filter_blocks_by_level, добавление state_context в промпт, LLM generate_answer
### Details:


## 4. 4.4.4 Этап 5: Построение рекомендации пути [done]
### Dependencies: None
### Description: path_builder.build_path если include_path_recommendation, форматирование path_recommendation dict
### Details:


## 5. 4.4.5 Этапы 6-7: Подготовка обратной связи и сохранение в память [done]
### Dependencies: None
### Description: feedback_prompt по состоянию, memory.add_turn с state/concepts, автосохранение
### Details:


## 6. 4.4.6 Форматирование финального результата Phase 4 [done]
### Dependencies: None
### Description: Возврат Dict: status, answer, state_analysis, path_recommendation, conversation_context, feedback_prompt, sources, concepts, metadata, timestamp, processing_time
### Details:


