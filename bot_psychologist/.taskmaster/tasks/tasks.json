{
  "master": {
    "tasks": [
      {
        "id": 1,
        "title": "Phase 1.1: Project Initialization",
        "description": "Create folder structure and dependencies",
        "details": "",
        "testStrategy": "",
        "status": "done",
        "dependencies": [],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "1.1.1 Create bot_agent folder structure",
            "description": "Create folders: bot_agent/, logs/bot_agent/",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 1
          },
          {
            "id": 2,
            "title": "1.1.2 Create requirements_bot.txt",
            "description": "Add dependencies: openai, scikit-learn, numpy, python-dotenv",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 1
          },
          {
            "id": 3,
            "title": "1.1.3 Setup .env configuration",
            "description": "Configure OPENAI_API_KEY, PRIMARY_MODEL, DATA_ROOT",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 1
          },
          {
            "id": 4,
            "title": "1.1.4 Create __init__.py for bot_agent",
            "description": "Initialize package with logging and main imports",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 1
          }
        ]
      },
      {
        "id": 2,
        "title": "Phase 1.2: Create config.py",
        "description": "Configuration module with paths, LLM parameters, search settings, caching",
        "details": "",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          1
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "1.2.1 Define PROJECT_ROOT and DATA_ROOT paths",
            "description": "Configure base paths for data and project root",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 2
          },
          {
            "id": 2,
            "title": "1.2.2 Configure search parameters",
            "description": "TOP_K_BLOCKS, MIN_RELEVANCE_SCORE settings",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 2
          },
          {
            "id": 3,
            "title": "1.2.3 Configure LLM parameters",
            "description": "LLM_MODEL, TEMPERATURE, MAX_TOKENS, OPENAI_API_KEY",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 2
          },
          {
            "id": 4,
            "title": "1.2.4 Add validation method",
            "description": "Config.validate() to check required settings",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 2
          }
        ]
      },
      {
        "id": 3,
        "title": "Phase 1.3: Create data_loader.py",
        "description": "Data loader for SAG v2.0 JSON files with Block and Document dataclasses",
        "details": "",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          2
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "1.3.1 Create Block dataclass",
            "description": "Dataclass with fields: block_id, video_id, start, end, title, summary, content, keywords, youtube_link",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 3
          },
          {
            "id": 2,
            "title": "1.3.2 Create Document dataclass",
            "description": "Dataclass with fields: video_id, source_url, title, blocks, metadata",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 3
          },
          {
            "id": 3,
            "title": "1.3.3 Implement DataLoader class",
            "description": "Class with methods: load_all_data, get_all_blocks, get_document_by_video_id, get_block_by_id",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 3
          },
          {
            "id": 4,
            "title": "1.3.4 Create global data_loader singleton",
            "description": "Singleton instance for caching loaded data across requests",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 3
          }
        ]
      },
      {
        "id": 4,
        "title": "Phase 1.4: Create retriever.py",
        "description": "Simple TF-IDF retriever for semantic block search with cosine similarity",
        "details": "",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          3
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "1.4.1 Build TF-IDF index",
            "description": "TfidfVectorizer with char n-grams for Russian text",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 4
          },
          {
            "id": 2,
            "title": "1.4.2 Implement retrieve method",
            "description": "Cosine similarity search returning top-k blocks with scores",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 4
          },
          {
            "id": 3,
            "title": "1.4.3 Add relevance threshold filter",
            "description": "Filter results by MIN_RELEVANCE_SCORE from config",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 4
          }
        ]
      },
      {
        "id": 5,
        "title": "Phase 1.5: Create llm_answerer.py",
        "description": "LLM answerer module for generating responses via OpenAI API with system prompt",
        "details": "",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          4
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "1.5.1 Create system prompt",
            "description": "Psychologist bot persona: calm, supportive, no medical diagnoses",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 5
          },
          {
            "id": 2,
            "title": "1.5.2 Build context prompt",
            "description": "Format blocks with title, summary, content, youtube_link, timecodes",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 5
          },
          {
            "id": 3,
            "title": "1.5.3 Integrate OpenAI API",
            "description": "Chat completion with temperature, max_tokens, error handling",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 5
          }
        ]
      },
      {
        "id": 6,
        "title": "Phase 1.6: Create answer_basic.py",
        "description": "Main QA function answer_question_basic combining retriever and LLM answerer",
        "details": "",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          5
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "1.6.1 Implement answer_question_basic function",
            "description": "Main function: load data -> retrieve blocks -> generate answer -> return result",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 6
          },
          {
            "id": 2,
            "title": "1.6.2 Create simple ask() interface",
            "description": "Wrapper function returning only text answer for quick usage",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 6
          },
          {
            "id": 3,
            "title": "1.6.3 Add error handling and debug info",
            "description": "Handle no_data, no_blocks, LLM errors; optional debug output",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 6
          }
        ]
      },
      {
        "id": 7,
        "title": "Phase 1.7: Create test_phase1.py",
        "description": "Test script to verify Phase 1 QA bot functionality with sample questions",
        "details": "",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          6
        ],
        "priority": "medium",
        "subtasks": [
          {
            "id": 1,
            "title": "1.7.1 Create test questions",
            "description": "Sample questions about awareness, practices, transformation",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 7
          },
          {
            "id": 2,
            "title": "1.7.2 Run tests and verify output",
            "description": "Check answer quality, sources, youtube links with timecodes",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 7
          },
          {
            "id": 3,
            "title": "1.7.3 Validate logging",
            "description": "Verify logs are written to logs/bot_agent/bot_agent.log",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 7
          }
        ]
      },
      {
        "id": 8,
        "title": "Phase 2.1: Расширение data_loader.py (SAG v2.0)",
        "description": "Обновить data_loader.py — добавить поддержку новых полей SAG v2.0: block_type, emotional_tone, conceptual_depth, complexity_score, graph_entities. Обновить класс Block и метод _load_single_document.",
        "details": "Файл: bot_agent/data_loader.py. Добавить поля: block_type (monologue/dialogue/practice/theory), emotional_tone (contemplative/explanatory/intense/light), conceptual_depth (low/medium/high), complexity_score (1.0-10.0), graph_entities (List[str] до 30 сущностей). Обновить __post_init__ и парсинг JSON.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          7
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "2.1.1 Добавить новые поля SAG v2.0 в Block dataclass",
            "description": "Добавить поля: block_type, emotional_tone, conceptual_depth, complexity_score, graph_entities",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 8
          },
          {
            "id": 2,
            "title": "2.1.2 Добавить __post_init__ для инициализации опциональных полей",
            "description": "Инициализация graph_entities как пустой список если None",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 8
          },
          {
            "id": 3,
            "title": "2.1.3 Обновить _load_single_document для парсинга SAG v2.0 полей",
            "description": "Парсинг block_type, emotional_tone, conceptual_depth, complexity_score, graph_entities из JSON",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 8
          },
          {
            "id": 4,
            "title": "2.1.4 Добавить метод get_preview в Block",
            "description": "Метод для получения краткого содержания блока с ограничением длины",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 8
          }
        ]
      },
      {
        "id": 9,
        "title": "Phase 2.2: Создание user_level_adapter.py",
        "description": "Новый модуль для адаптации ответов под уровень пользователя (beginner/intermediate/advanced). Фильтрация блоков по сложности, адаптация системных промптов, извлечение ключевых концептов.",
        "details": "Файл: bot_agent/user_level_adapter.py. Компоненты: UserLevel enum, UserLevelAdapter class с методами filter_blocks_by_level, adapt_system_prompt, extract_key_concepts, get_answer_length_guidance, format_concepts_for_output.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          8
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "2.2.1 Создать UserLevel enum",
            "description": "Enum: BEGINNER, INTERMEDIATE, ADVANCED со строковыми значениями",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 9
          },
          {
            "id": 2,
            "title": "2.2.2 Создать UserLevelAdapter class с конструктором",
            "description": "Конструктор принимает user_level строку и конвертирует в UserLevel enum",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 9
          },
          {
            "id": 3,
            "title": "2.2.3 Реализовать filter_blocks_by_level",
            "description": "Фильтрация блоков по complexity_score и conceptual_depth в зависимости от уровня",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 9
          },
          {
            "id": 4,
            "title": "2.2.4 Реализовать adapt_system_prompt",
            "description": "Добавление инструкций для LLM в зависимости от уровня пользователя",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 9
          },
          {
            "id": 5,
            "title": "2.2.5 Реализовать вспомогательные методы",
            "description": "extract_key_concepts, get_answer_length_guidance, format_concepts_for_output",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 9
          }
        ]
      },
      {
        "id": 10,
        "title": "Phase 2.3: Создание semantic_analyzer.py",
        "description": "Модуль для анализа семантических отношений между концептами в найденных блоках. Извлечение primary_concepts, related_concepts, conceptual_links.",
        "details": "Файл: bot_agent/semantic_analyzer.py. Класс SemanticAnalyzer с методами: analyze_relations (возвращает structured dict), _find_related_concepts, _extract_conceptual_links, _generate_analysis_summary.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          8
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "2.3.1 Создать SemanticAnalyzer class",
            "description": "Базовый класс для анализа семантических отношений между концептами",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 10
          },
          {
            "id": 2,
            "title": "2.3.2 Реализовать analyze_relations",
            "description": "Возвращает Dict с primary_concepts, related_concepts, conceptual_links, analysis_summary",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 10
          },
          {
            "id": 3,
            "title": "2.3.3 Реализовать _find_related_concepts и _extract_conceptual_links",
            "description": "Поиск связей между концептами через совместное появление в блоках",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 10
          },
          {
            "id": 4,
            "title": "2.3.4 Реализовать _generate_analysis_summary",
            "description": "Генерация текстового резюме семантического анализа",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 10
          }
        ]
      },
      {
        "id": 11,
        "title": "Phase 2.4: Создание answer_sag_aware.py",
        "description": "Новая функция answer_question_sag_aware для ответов с учетом SAG v2.0. Интеграция UserLevelAdapter и SemanticAnalyzer. 6 этапов обработки запроса.",
        "details": "Файл: bot_agent/answer_sag_aware.py. Функция answer_question_sag_aware(query, user_level, top_k, debug). Этапы: 1) Инициализация компонентов, 2) Поиск блоков, 3) Адаптация по уровню, 4) Семантический анализ, 5) Формирование ответа через LLM, 6) Форматирование вывода. Возвращает расширенный Dict с concepts, relations, metadata.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          9,
          10
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "2.4.1 Создать структуру answer_question_sag_aware с импортами",
            "description": "Импорты: data_loader, retriever, LLMAnswerer, UserLevelAdapter, SemanticAnalyzer, config",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 11
          },
          {
            "id": 2,
            "title": "2.4.2 Этап 1-2: Инициализация компонентов и поиск блоков",
            "description": "Загрузка данных, создание level_adapter и semantic_analyzer, поиск через retriever",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 11
          },
          {
            "id": 3,
            "title": "2.4.3 Этап 3-4: Адаптация по уровню и семантический анализ",
            "description": "filter_blocks_by_level, analyze_relations для извлечения концептов",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 11
          },
          {
            "id": 4,
            "title": "2.4.4 Этап 5: Формирование ответа через LLM",
            "description": "adapted_system_prompt, расширенный контекст с концептами, generate_answer",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 11
          },
          {
            "id": 5,
            "title": "2.4.5 Этап 6: Форматирование вывода",
            "description": "Возврат Dict с status, answer, sources, concepts, relations, metadata, debug",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 11
          }
        ]
      },
      {
        "id": 12,
        "title": "Phase 2.5: Обновление __init__.py",
        "description": "Обновить bot_agent/__init__.py — добавить импорт Phase 2 модулей и обновить __all__.",
        "details": "Файл: bot_agent/__init__.py. Добавить: from answer_sag_aware import answer_question_sag_aware. Обновить __all__ = [..., 'answer_question_sag_aware']. Обновить лог инициализации.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          11
        ],
        "priority": "medium",
        "subtasks": [
          {
            "id": 1,
            "title": "2.5.1 Добавить импорт answer_sag_aware",
            "description": "from answer_sag_aware import answer_question_sag_aware",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 12
          },
          {
            "id": 2,
            "title": "2.5.2 Обновить __all__ и лог инициализации",
            "description": "Добавить answer_question_sag_aware в __all__, обновить лог: Phase 1 + Phase 2",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 12
          }
        ]
      },
      {
        "id": 13,
        "title": "Phase 2.6: Создание test_phase2.py",
        "description": "Тестовый скрипт для проверки Phase 2 функциональности с разными уровнями пользователя и тестовыми вопросами.",
        "details": "Файл: test_phase2.py. Тестовые комбинации: вопрос + уровень (beginner/intermediate/advanced). Проверка: status, processing_time, answer, concepts, relations, sources. Вывод debug информации.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          12
        ],
        "priority": "medium",
        "subtasks": [
          {
            "id": 1,
            "title": "2.6.1 Создать test_phase2.py с тестовыми кейсами",
            "description": "Тестовые комбинации: (вопрос, уровень) для beginner/intermediate/advanced",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 13
          },
          {
            "id": 2,
            "title": "2.6.2 Реализовать вывод результатов",
            "description": "Вывод status, processing_time, answer, concepts, relations, sources, debug",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 13
          },
          {
            "id": 3,
            "title": "2.6.3 Запуск и верификация тестов",
            "description": "Выполнить python test_phase2.py и проверить корректность результатов",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 13
          }
        ]
      },
      {
        "id": 14,
        "title": "Phase 2.7: Финальная проверка и валидация Phase 2",
        "description": "Финальная проверка всех компонентов Phase 2 по чек-листу. Валидация результатов и готовности к Phase 3.",
        "details": "Чек-лист: data_loader.py обновлён, user_level_adapter.py создан, semantic_analyzer.py создан, answer_sag_aware.py создан, __init__.py обновлён, test_phase2.py создан и проходит, ответы адаптируются под уровень, концепты извлекаются корректно.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          13
        ],
        "priority": "medium",
        "subtasks": [
          {
            "id": 1,
            "title": "2.7.1 Пройти чек-лист Phase 2",
            "description": "Проверить: data_loader.py обновлён, все модули созданы, __init__.py обновлён, тесты проходят",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 14
          },
          {
            "id": 2,
            "title": "2.7.2 Валидация результатов Phase 2",
            "description": "Ответы адаптируются под уровень, концепты извлекаются, готовность к Phase 3",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 14
          }
        ]
      }
    ],
    "metadata": {
      "created": "2025-12-19T04:02:29.457Z",
      "updated": "2025-12-19T06:17:34.285Z",
      "description": "Tasks for master context"
    }
  }
}