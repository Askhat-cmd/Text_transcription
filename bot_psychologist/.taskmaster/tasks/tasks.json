{
  "master": {
    "tasks": [
      {
        "id": 1,
        "title": "Phase 1.1: Project Initialization",
        "description": "Create folder structure and dependencies",
        "details": "",
        "testStrategy": "",
        "status": "done",
        "dependencies": [],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "1.1.1 Create bot_agent folder structure",
            "description": "Create folders: bot_agent/, logs/bot_agent/",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 1
          },
          {
            "id": 2,
            "title": "1.1.2 Create requirements_bot.txt",
            "description": "Add dependencies: openai, scikit-learn, numpy, python-dotenv",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 1
          },
          {
            "id": 3,
            "title": "1.1.3 Setup .env configuration",
            "description": "Configure OPENAI_API_KEY, PRIMARY_MODEL, DATA_ROOT",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 1
          },
          {
            "id": 4,
            "title": "1.1.4 Create __init__.py for bot_agent",
            "description": "Initialize package with logging and main imports",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 1
          }
        ]
      },
      {
        "id": 2,
        "title": "Phase 1.2: Create config.py",
        "description": "Configuration module with paths, LLM parameters, search settings, caching",
        "details": "",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          1
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "1.2.1 Define PROJECT_ROOT and DATA_ROOT paths",
            "description": "Configure base paths for data and project root",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 2
          },
          {
            "id": 2,
            "title": "1.2.2 Configure search parameters",
            "description": "TOP_K_BLOCKS, MIN_RELEVANCE_SCORE settings",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 2
          },
          {
            "id": 3,
            "title": "1.2.3 Configure LLM parameters",
            "description": "LLM_MODEL, TEMPERATURE, MAX_TOKENS, OPENAI_API_KEY",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 2
          },
          {
            "id": 4,
            "title": "1.2.4 Add validation method",
            "description": "Config.validate() to check required settings",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 2
          }
        ]
      },
      {
        "id": 3,
        "title": "Phase 1.3: Create data_loader.py",
        "description": "Data loader for SAG v2.0 JSON files with Block and Document dataclasses",
        "details": "",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          2
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "1.3.1 Create Block dataclass",
            "description": "Dataclass with fields: block_id, video_id, start, end, title, summary, content, keywords, youtube_link",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 3
          },
          {
            "id": 2,
            "title": "1.3.2 Create Document dataclass",
            "description": "Dataclass with fields: video_id, source_url, title, blocks, metadata",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 3
          },
          {
            "id": 3,
            "title": "1.3.3 Implement DataLoader class",
            "description": "Class with methods: load_all_data, get_all_blocks, get_document_by_video_id, get_block_by_id",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 3
          },
          {
            "id": 4,
            "title": "1.3.4 Create global data_loader singleton",
            "description": "Singleton instance for caching loaded data across requests",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 3
          }
        ]
      },
      {
        "id": 4,
        "title": "Phase 1.4: Create retriever.py",
        "description": "Simple TF-IDF retriever for semantic block search with cosine similarity",
        "details": "",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          3
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "1.4.1 Build TF-IDF index",
            "description": "TfidfVectorizer with char n-grams for Russian text",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 4
          },
          {
            "id": 2,
            "title": "1.4.2 Implement retrieve method",
            "description": "Cosine similarity search returning top-k blocks with scores",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 4
          },
          {
            "id": 3,
            "title": "1.4.3 Add relevance threshold filter",
            "description": "Filter results by MIN_RELEVANCE_SCORE from config",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 4
          }
        ]
      },
      {
        "id": 5,
        "title": "Phase 1.5: Create llm_answerer.py",
        "description": "LLM answerer module for generating responses via OpenAI API with system prompt",
        "details": "",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          4
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "1.5.1 Create system prompt",
            "description": "Psychologist bot persona: calm, supportive, no medical diagnoses",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 5
          },
          {
            "id": 2,
            "title": "1.5.2 Build context prompt",
            "description": "Format blocks with title, summary, content, youtube_link, timecodes",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 5
          },
          {
            "id": 3,
            "title": "1.5.3 Integrate OpenAI API",
            "description": "Chat completion with temperature, max_tokens, error handling",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 5
          }
        ]
      },
      {
        "id": 6,
        "title": "Phase 1.6: Create answer_basic.py",
        "description": "Main QA function answer_question_basic combining retriever and LLM answerer",
        "details": "",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          5
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "1.6.1 Implement answer_question_basic function",
            "description": "Main function: load data -> retrieve blocks -> generate answer -> return result",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 6
          },
          {
            "id": 2,
            "title": "1.6.2 Create simple ask() interface",
            "description": "Wrapper function returning only text answer for quick usage",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 6
          },
          {
            "id": 3,
            "title": "1.6.3 Add error handling and debug info",
            "description": "Handle no_data, no_blocks, LLM errors; optional debug output",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 6
          }
        ]
      },
      {
        "id": 7,
        "title": "Phase 1.7: Create test_phase1.py",
        "description": "Test script to verify Phase 1 QA bot functionality with sample questions",
        "details": "",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          6
        ],
        "priority": "medium",
        "subtasks": [
          {
            "id": 1,
            "title": "1.7.1 Create test questions",
            "description": "Sample questions about awareness, practices, transformation",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 7
          },
          {
            "id": 2,
            "title": "1.7.2 Run tests and verify output",
            "description": "Check answer quality, sources, youtube links with timecodes",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 7
          },
          {
            "id": 3,
            "title": "1.7.3 Validate logging",
            "description": "Verify logs are written to logs/bot_agent/bot_agent.log",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 7
          }
        ]
      },
      {
        "id": 8,
        "title": "Phase 2.1: Расширение data_loader.py (SAG v2.0)",
        "description": "Обновить data_loader.py — добавить поддержку новых полей SAG v2.0: block_type, emotional_tone, conceptual_depth, complexity_score, graph_entities. Обновить класс Block и метод _load_single_document.",
        "details": "Файл: bot_agent/data_loader.py. Добавить поля: block_type (monologue/dialogue/practice/theory), emotional_tone (contemplative/explanatory/intense/light), conceptual_depth (low/medium/high), complexity_score (1.0-10.0), graph_entities (List[str] до 30 сущностей). Обновить __post_init__ и парсинг JSON.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          7
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "2.1.1 Добавить новые поля SAG v2.0 в Block dataclass",
            "description": "Добавить поля: block_type, emotional_tone, conceptual_depth, complexity_score, graph_entities",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 8
          },
          {
            "id": 2,
            "title": "2.1.2 Добавить __post_init__ для инициализации опциональных полей",
            "description": "Инициализация graph_entities как пустой список если None",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 8
          },
          {
            "id": 3,
            "title": "2.1.3 Обновить _load_single_document для парсинга SAG v2.0 полей",
            "description": "Парсинг block_type, emotional_tone, conceptual_depth, complexity_score, graph_entities из JSON",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 8
          },
          {
            "id": 4,
            "title": "2.1.4 Добавить метод get_preview в Block",
            "description": "Метод для получения краткого содержания блока с ограничением длины",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 8
          }
        ]
      },
      {
        "id": 9,
        "title": "Phase 2.2: Создание user_level_adapter.py",
        "description": "Новый модуль для адаптации ответов под уровень пользователя (beginner/intermediate/advanced). Фильтрация блоков по сложности, адаптация системных промптов, извлечение ключевых концептов.",
        "details": "Файл: bot_agent/user_level_adapter.py. Компоненты: UserLevel enum, UserLevelAdapter class с методами filter_blocks_by_level, adapt_system_prompt, extract_key_concepts, get_answer_length_guidance, format_concepts_for_output.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          8
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "2.2.1 Создать UserLevel enum",
            "description": "Enum: BEGINNER, INTERMEDIATE, ADVANCED со строковыми значениями",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 9
          },
          {
            "id": 2,
            "title": "2.2.2 Создать UserLevelAdapter class с конструктором",
            "description": "Конструктор принимает user_level строку и конвертирует в UserLevel enum",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 9
          },
          {
            "id": 3,
            "title": "2.2.3 Реализовать filter_blocks_by_level",
            "description": "Фильтрация блоков по complexity_score и conceptual_depth в зависимости от уровня",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 9
          },
          {
            "id": 4,
            "title": "2.2.4 Реализовать adapt_system_prompt",
            "description": "Добавление инструкций для LLM в зависимости от уровня пользователя",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 9
          },
          {
            "id": 5,
            "title": "2.2.5 Реализовать вспомогательные методы",
            "description": "extract_key_concepts, get_answer_length_guidance, format_concepts_for_output",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 9
          }
        ]
      },
      {
        "id": 10,
        "title": "Phase 2.3: Создание semantic_analyzer.py",
        "description": "Модуль для анализа семантических отношений между концептами в найденных блоках. Извлечение primary_concepts, related_concepts, conceptual_links.",
        "details": "Файл: bot_agent/semantic_analyzer.py. Класс SemanticAnalyzer с методами: analyze_relations (возвращает structured dict), _find_related_concepts, _extract_conceptual_links, _generate_analysis_summary.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          8
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "2.3.1 Создать SemanticAnalyzer class",
            "description": "Базовый класс для анализа семантических отношений между концептами",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 10
          },
          {
            "id": 2,
            "title": "2.3.2 Реализовать analyze_relations",
            "description": "Возвращает Dict с primary_concepts, related_concepts, conceptual_links, analysis_summary",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 10
          },
          {
            "id": 3,
            "title": "2.3.3 Реализовать _find_related_concepts и _extract_conceptual_links",
            "description": "Поиск связей между концептами через совместное появление в блоках",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 10
          },
          {
            "id": 4,
            "title": "2.3.4 Реализовать _generate_analysis_summary",
            "description": "Генерация текстового резюме семантического анализа",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 10
          }
        ]
      },
      {
        "id": 11,
        "title": "Phase 2.4: Создание answer_sag_aware.py",
        "description": "Новая функция answer_question_sag_aware для ответов с учетом SAG v2.0. Интеграция UserLevelAdapter и SemanticAnalyzer. 6 этапов обработки запроса.",
        "details": "Файл: bot_agent/answer_sag_aware.py. Функция answer_question_sag_aware(query, user_level, top_k, debug). Этапы: 1) Инициализация компонентов, 2) Поиск блоков, 3) Адаптация по уровню, 4) Семантический анализ, 5) Формирование ответа через LLM, 6) Форматирование вывода. Возвращает расширенный Dict с concepts, relations, metadata.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          9,
          10
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "2.4.1 Создать структуру answer_question_sag_aware с импортами",
            "description": "Импорты: data_loader, retriever, LLMAnswerer, UserLevelAdapter, SemanticAnalyzer, config",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 11
          },
          {
            "id": 2,
            "title": "2.4.2 Этап 1-2: Инициализация компонентов и поиск блоков",
            "description": "Загрузка данных, создание level_adapter и semantic_analyzer, поиск через retriever",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 11
          },
          {
            "id": 3,
            "title": "2.4.3 Этап 3-4: Адаптация по уровню и семантический анализ",
            "description": "filter_blocks_by_level, analyze_relations для извлечения концептов",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 11
          },
          {
            "id": 4,
            "title": "2.4.4 Этап 5: Формирование ответа через LLM",
            "description": "adapted_system_prompt, расширенный контекст с концептами, generate_answer",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 11
          },
          {
            "id": 5,
            "title": "2.4.5 Этап 6: Форматирование вывода",
            "description": "Возврат Dict с status, answer, sources, concepts, relations, metadata, debug",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 11
          }
        ]
      },
      {
        "id": 12,
        "title": "Phase 2.5: Обновление __init__.py",
        "description": "Обновить bot_agent/__init__.py — добавить импорт Phase 2 модулей и обновить __all__.",
        "details": "Файл: bot_agent/__init__.py. Добавить: from answer_sag_aware import answer_question_sag_aware. Обновить __all__ = [..., 'answer_question_sag_aware']. Обновить лог инициализации.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          11
        ],
        "priority": "medium",
        "subtasks": [
          {
            "id": 1,
            "title": "2.5.1 Добавить импорт answer_sag_aware",
            "description": "from answer_sag_aware import answer_question_sag_aware",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 12
          },
          {
            "id": 2,
            "title": "2.5.2 Обновить __all__ и лог инициализации",
            "description": "Добавить answer_question_sag_aware в __all__, обновить лог: Phase 1 + Phase 2",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 12
          }
        ]
      },
      {
        "id": 13,
        "title": "Phase 2.6: Создание test_phase2.py",
        "description": "Тестовый скрипт для проверки Phase 2 функциональности с разными уровнями пользователя и тестовыми вопросами.",
        "details": "Файл: test_phase2.py. Тестовые комбинации: вопрос + уровень (beginner/intermediate/advanced). Проверка: status, processing_time, answer, concepts, relations, sources. Вывод debug информации.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          12
        ],
        "priority": "medium",
        "subtasks": [
          {
            "id": 1,
            "title": "2.6.1 Создать test_phase2.py с тестовыми кейсами",
            "description": "Тестовые комбинации: (вопрос, уровень) для beginner/intermediate/advanced",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 13
          },
          {
            "id": 2,
            "title": "2.6.2 Реализовать вывод результатов",
            "description": "Вывод status, processing_time, answer, concepts, relations, sources, debug",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 13
          },
          {
            "id": 3,
            "title": "2.6.3 Запуск и верификация тестов",
            "description": "Выполнить python test_phase2.py и проверить корректность результатов",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 13
          }
        ]
      },
      {
        "id": 14,
        "title": "Phase 2.7: Финальная проверка и валидация Phase 2",
        "description": "Финальная проверка всех компонентов Phase 2 по чек-листу. Валидация результатов и готовности к Phase 3.",
        "details": "Чек-лист: data_loader.py обновлён, user_level_adapter.py создан, semantic_analyzer.py создан, answer_sag_aware.py создан, __init__.py обновлён, test_phase2.py создан и проходит, ответы адаптируются под уровень, концепты извлекаются корректно.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          13
        ],
        "priority": "medium",
        "subtasks": [
          {
            "id": 1,
            "title": "2.7.1 Пройти чек-лист Phase 2",
            "description": "Проверить: data_loader.py обновлён, все модули созданы, __init__.py обновлён, тесты проходят",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 14
          },
          {
            "id": 2,
            "title": "2.7.2 Валидация результатов Phase 2",
            "description": "Ответы адаптируются под уровень, концепты извлекаются, готовность к Phase 3",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 14
          }
        ]
      },
      {
        "id": 15,
        "title": "Phase 3.1: Создание graph_client.py — клиент Knowledge Graph",
        "description": "Модуль для работы с Knowledge Graph. Содержит классы GraphNode, GraphEdge, KnowledgeGraphClient. Загрузка графов из JSON, поиск узлов и связей, BFS-навигация.",
        "details": "Файл: bot_agent/graph_client.py. Типы узлов: CONCEPT, PRACTICE, TECHNIQUE, EXERCISE, PATTERN, PROCESS_STAGE. Типы связей: IS_PRACTICE_FOR, IS_TECHNIQUE_FOR, ENABLES, REQUIRES, IS_PART_OF, HAS_PART, RELATED_TO. Источник данных: *.knowledge_graph.json или поле knowledge_graph внутри *.for_vector.json. Глобальный синглтон graph_client.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          14
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "3.1.1 Создать класс GraphNode",
            "description": "Класс узла Knowledge Graph: node_id, name, node_type (CONCEPT, PRACTICE, TECHNIQUE, EXERCISE, PATTERN, PROCESS_STAGE), metadata",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 15
          },
          {
            "id": 2,
            "title": "3.1.2 Создать класс GraphEdge",
            "description": "Класс связи: from_id, to_id, from_name, to_name, edge_type, explanation, confidence (0.0-1.0), metadata",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 15
          },
          {
            "id": 3,
            "title": "3.1.3 Создать KnowledgeGraphClient с загрузкой графов",
            "description": "Методы: load_graphs_from_all_documents, _find_graph_file_for_doc, _load_single_graph. Источник: *.knowledge_graph.json или поле knowledge_graph в for_vector.json",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 15
          },
          {
            "id": 4,
            "title": "3.1.4 Реализовать методы поиска узлов",
            "description": "Методы: find_node (по имени, case-insensitive), find_node_by_id, node_by_name индекс для быстрого поиска",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 15
          },
          {
            "id": 5,
            "title": "3.1.5 Реализовать методы поиска связей",
            "description": "Методы: get_related (outgoing/incoming/both), adjacency и reverse_adjacency индексы, фильтрация по edge_types",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 15
          },
          {
            "id": 6,
            "title": "3.1.6 Реализовать навигационные методы",
            "description": "Методы: get_practices_for_concept, get_chain (BFS), get_prerequisites_for_concept, get_concept_hierarchy, get_statistics",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 15
          },
          {
            "id": 7,
            "title": "3.1.7 Создать глобальный синглтон graph_client",
            "description": "Инстанс KnowledgeGraphClient для использования во всём проекте с lazy-loading",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 15
          }
        ]
      },
      {
        "id": 16,
        "title": "Phase 3.2: Создание practices_recommender.py — рекомендатор практик",
        "description": "Модуль для рекомендации практик, техник и упражнений на основе Knowledge Graph. Построение путей обучения между концептами.",
        "details": "Файл: bot_agent/practices_recommender.py. Класс PracticesRecommender с методами: suggest_practices_for_concept (поиск практик через граф + привязка к блокам), get_learning_path (BFS от start_concept к target_concept через граф), get_practice_details (детали практики из блоков). Глобальный синглтон practices_recommender.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          15
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "3.2.1 Создать класс PracticesRecommender",
            "description": "Базовый класс с инициализацией graph_client.load_graphs_from_all_documents()",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 16
          },
          {
            "id": 2,
            "title": "3.2.2 Реализовать suggest_practices_for_concept",
            "description": "Поиск практик через граф для концепта, привязка к блокам по graph_entities, возврат Dict с practice_name, type, confidence, source_blocks",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 16
          },
          {
            "id": 3,
            "title": "3.2.3 Реализовать get_learning_path",
            "description": "Построение пути обучения от start_concept к target_concept через BFS или на основе prerequisites",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 16
          },
          {
            "id": 4,
            "title": "3.2.4 Реализовать get_practice_details",
            "description": "Получение полной информации о практике: description, full_content, source_blocks из блоков по graph_entities",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 16
          },
          {
            "id": 5,
            "title": "3.2.5 Создать глобальный синглтон practices_recommender",
            "description": "Инстанс PracticesRecommender для использования в answer_graph_powered",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 16
          }
        ]
      },
      {
        "id": 17,
        "title": "Phase 3.3: Создание answer_graph_powered.py — Graph-Powered QA",
        "description": "Функция answer_question_graph_powered для ответов с полной поддержкой Knowledge Graph. 8 этапов обработки: от базового поиска до формирования ответа с практиками и цепочками.",
        "details": "Файл: bot_agent/answer_graph_powered.py. Этапы: 1) Инициализация, 2) Поиск блоков, 3) Загрузка Knowledge Graph, 4) Анализ концептов через граф, 5) Формирование ответа, 6) Рекомендация практик, 7) Анализ цепочек, 8) Форматирование результата. Возвращает расширенный Dict: status, answer, sources, concepts, relations, practices, concept_hierarchy, learning_path, metadata.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          15,
          16
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "3.3.1 Создать структуру answer_question_graph_powered с импортами",
            "description": "Импорты: data_loader, retriever, LLMAnswerer, UserLevelAdapter, SemanticAnalyzer, graph_client, practices_recommender, config",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 17
          },
          {
            "id": 2,
            "title": "3.3.2 Этапы 1-2: Базовая обработка и поиск блоков",
            "description": "Инициализация компонентов (как в Phase 2), поиск релевантных блоков через retriever",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 17
          },
          {
            "id": 3,
            "title": "3.3.3 Этапы 3-4: Загрузка Knowledge Graph и анализ концептов",
            "description": "Загрузка графов, получение иерархии концептов через get_concept_hierarchy для primary_concepts",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 17
          },
          {
            "id": 4,
            "title": "3.3.4 Этап 5: Формирование ответа через LLM",
            "description": "Обогащённый контекст с информацией из графа (структура концептов), генерация ответа через LLMAnswerer",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 17
          },
          {
            "id": 5,
            "title": "3.3.5 Этапы 6-7: Рекомендация практик и анализ цепочек",
            "description": "suggest_practices_for_concept для main_concept, get_learning_path между primary_concepts",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 17
          },
          {
            "id": 6,
            "title": "3.3.6 Этап 8: Форматирование результата",
            "description": "Возврат Dict: status, answer, sources, concepts, relations, practices, concept_hierarchy, learning_path, metadata, debug",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 17
          }
        ]
      },
      {
        "id": 18,
        "title": "Phase 3.4: Обновление __init__.py для Phase 3",
        "description": "Обновить bot_agent/__init__.py — добавить импорт Phase 3 модулей и обновить __all__.",
        "details": "Файл: bot_agent/__init__.py. Добавить: from answer_graph_powered import answer_question_graph_powered. Обновить __all__ с новыми экспортами. Обновить лог инициализации: Phase 1 + Phase 2 + Phase 3.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          17
        ],
        "priority": "medium",
        "subtasks": [
          {
            "id": 1,
            "title": "3.4.1 Добавить импорт answer_graph_powered",
            "description": "from answer_graph_powered import answer_question_graph_powered",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 18
          },
          {
            "id": 2,
            "title": "3.4.2 Обновить __all__ и лог инициализации",
            "description": "Добавить answer_question_graph_powered в __all__, обновить лог: Phase 1 + Phase 2 + Phase 3",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 18
          }
        ]
      },
      {
        "id": 19,
        "title": "Phase 3.5: Создание test_phase3.py",
        "description": "Тестовый скрипт для проверки Phase 3 функциональности с разными уровнями пользователей, проверкой практик, цепочек и иерархии концептов.",
        "details": "Файл: test_phase3.py. Тестовые кейсы: (вопрос, уровень, with_practices, with_chain). Проверка: status, processing_time, answer, concepts, practices, learning_path, concept_hierarchy. Debug-вывод с graph_stats.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          18
        ],
        "priority": "medium",
        "subtasks": [
          {
            "id": 1,
            "title": "3.5.1 Создать test_phase3.py с тестовыми кейсами",
            "description": "Тестовые комбинации: (вопрос, уровень, with_practices, with_chain) для beginner/intermediate/advanced",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 19
          },
          {
            "id": 2,
            "title": "3.5.2 Реализовать вывод результатов Phase 3",
            "description": "Вывод: status, processing_time, answer, concepts, practices, learning_path, concept_hierarchy, debug (graph_stats)",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 19
          },
          {
            "id": 3,
            "title": "3.5.3 Запуск и верификация тестов Phase 3",
            "description": "Выполнить python test_phase3.py, проверить: графы загружаются, практики рекомендуются, цепочки строятся, иерархия отображается",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 19
          }
        ]
      },
      {
        "id": 20,
        "title": "Phase 3.6: Финальная проверка и валидация Phase 3",
        "description": "Финальная проверка всех компонентов Phase 3 по чек-листу. Валидация загрузки графов, поиска практик, построения цепочек и иерархии концептов.",
        "details": "Чек-лист: graph_client.py создан и загружает графы, practices_recommender.py создан и находит практики, answer_graph_powered.py создан и работает, __init__.py обновлён, test_phase3.py создан и проходит, графы загружаются корректно, практики рекомендуются, цепочки связей строятся, иерархия концептов отображается.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          19
        ],
        "priority": "medium",
        "subtasks": [
          {
            "id": 1,
            "title": "3.6.1 Пройти чек-лист Phase 3",
            "description": "Проверить: graph_client.py создан, practices_recommender.py создан, answer_graph_powered.py создан, __init__.py обновлён, test_phase3.py создан и проходит",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 20
          },
          {
            "id": 2,
            "title": "3.6.2 Валидация результатов Phase 3",
            "description": "Графы успешно загружаются, практики находятся и рекомендуются, цепочки связей строятся, иерархия концептов отображается правильно",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 20
          }
        ]
      },
      {
        "id": 21,
        "title": "Phase 4.1: Создание state_classifier.py — Классификатор состояний",
        "description": "Модуль классификации психологического состояния пользователя. Содержит: UserState enum (10 состояний от UNAWARE до INTEGRATED), StateAnalysis dataclass, StateClassifier class с keyword и LLM анализом, рекомендации по состояниям.",
        "details": "Создать bot_agent/state_classifier.py с: 1) UserState enum (UNAWARE, CURIOUS, OVERWHELMED, RESISTANT, CONFUSED, COMMITTED, PRACTICING, STAGNANT, BREAKTHROUGH, INTEGRATED), 2) StateAnalysis dataclass (primary_state, confidence, secondary_states, indicators, emotional_tone, depth, recommendations), 3) StateClassifier class с методами analyze_message, _classify_by_keywords, _classify_by_llm, _merge_classifications, _get_recommendations_for_state, 4) Глобальный инстанс state_classifier.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          20
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "4.1.1 Создать UserState enum (10 состояний)",
            "description": "Enum: UNAWARE, CURIOUS, OVERWHELMED, RESISTANT, CONFUSED, COMMITTED, PRACTICING, STAGNANT, BREAKTHROUGH, INTEGRATED",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 21
          },
          {
            "id": 2,
            "title": "4.1.2 Создать StateAnalysis dataclass",
            "description": "Поля: primary_state, confidence (0.0-1.0), secondary_states, indicators, emotional_tone, depth, recommendations",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 21
          },
          {
            "id": 3,
            "title": "4.1.3 Создать StateClassifier class с state_indicators",
            "description": "Конструктор с LLMAnswerer, метод _init_state_indicators с ключевыми словами для каждого состояния",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 21
          },
          {
            "id": 4,
            "title": "4.1.4 Реализовать analyze_message и _classify_by_keywords",
            "description": "Основной метод analyze_message, первичная классификация по ключевым словам с подсчетом score",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 21
          },
          {
            "id": 5,
            "title": "4.1.5 Реализовать _classify_by_llm",
            "description": "LLM анализ через OpenAI API с JSON промптом для уточнения состояния",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 21
          },
          {
            "id": 6,
            "title": "4.1.6 Реализовать _merge_classifications",
            "description": "Объединение результатов keyword и LLM классификации, формирование StateAnalysis",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 21
          },
          {
            "id": 7,
            "title": "4.1.7 Реализовать _get_recommendations_for_state",
            "description": "Возврат рекомендаций по работе с пользователем для каждого из 10 состояний",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 21
          },
          {
            "id": 8,
            "title": "4.1.8 Создать глобальный state_classifier singleton",
            "description": "Инстанс StateClassifier для использования во всём проекте",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 21
          }
        ]
      },
      {
        "id": 22,
        "title": "Phase 4.2: Создание conversation_memory.py — Память диалога",
        "description": "Модуль долгосрочной памяти диалога. Персистентное хранение истории, метаданные пользователя, интересы, вызовы, прорывы. Поддержка обратной связи.",
        "details": "Создать bot_agent/conversation_memory.py с: 1) ConversationTurn dataclass (timestamp, user_input, user_state, bot_response, blocks_used, concepts, user_feedback, user_rating), 2) ConversationMemory class (user_id, turns, metadata), 3) Методы: load_from_disk, save_to_disk, add_turn, add_feedback, get_last_turns, get_context_for_llm, get_primary_interests, get_challenges, get_breakthroughs, get_summary, 4) Factory function get_conversation_memory с кэшем.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          20
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "4.2.1 Создать ConversationTurn dataclass",
            "description": "Поля: timestamp, user_input, user_state, bot_response, blocks_used, concepts, user_feedback, user_rating",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 22
          },
          {
            "id": 2,
            "title": "4.2.2 Создать ConversationMemory class",
            "description": "Конструктор с user_id, turns, metadata (created, last_updated, total_turns, user_level, primary_interests, challenges, breakthroughs)",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 22
          },
          {
            "id": 3,
            "title": "4.2.3 Реализовать load_from_disk / save_to_disk",
            "description": "JSON persistence в cache_dir/conversations/{user_id}.json",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 22
          },
          {
            "id": 4,
            "title": "4.2.4 Реализовать add_turn / add_feedback",
            "description": "Добавление хода в историю, добавление обратной связи (positive/negative/neutral, rating 1-5)",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 22
          },
          {
            "id": 5,
            "title": "4.2.5 Реализовать get_last_turns / get_context_for_llm",
            "description": "Получение последних N оборотов, форматирование контекста для LLM",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 22
          },
          {
            "id": 6,
            "title": "4.2.6 Реализовать get_primary_interests / get_challenges / get_breakthroughs",
            "description": "Анализ истории: интересы по частоте концептов, вызовы по negative feedback, прорывы по positive feedback",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 22
          },
          {
            "id": 7,
            "title": "4.2.7 Реализовать get_summary",
            "description": "Возврат Dict: total_turns, primary_interests, num_challenges, num_breakthroughs, average_rating, user_level",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 22
          },
          {
            "id": 8,
            "title": "4.2.8 Создать get_conversation_memory factory function",
            "description": "Factory с кэшем _memory_instances для получения/создания памяти по user_id",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 22
          }
        ]
      },
      {
        "id": 23,
        "title": "Phase 4.3: Создание path_builder.py — Построитель траекторий",
        "description": "Модуль построения персональных путей трансформации. Генерация шагов пути на основе текущего состояния, уровня, истории, Knowledge Graph. Интеграция с практиками.",
        "details": "Создать bot_agent/path_builder.py с: 1) TransformationPathStep dataclass (step_number, title, description, duration_weeks, practices, key_concepts, expected_outcomes, focus_areas, warning_signs), 2) PersonalTransformationPath dataclass (user_id, current_state, target_state, current_level, path_steps, total_duration_weeks, key_focus, challenges_identified, adaptation_notes), 3) PathBuilder class с build_path, _get_intermediate_states, _build_step, _get_concepts_for_transition, _get_expected_outcomes, _personalize_path, _determine_key_focus, 4) Глобальный инстанс path_builder.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          21,
          22
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "4.3.1 Создать TransformationPathStep dataclass",
            "description": "Поля: step_number, title, description, duration_weeks, practices, key_concepts, expected_outcomes, focus_areas, warning_signs",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 23
          },
          {
            "id": 2,
            "title": "4.3.2 Создать PersonalTransformationPath dataclass",
            "description": "Поля: user_id, current_state, target_state, current_level, path_steps, total_duration_weeks, key_focus, challenges_identified, adaptation_notes",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 23
          },
          {
            "id": 3,
            "title": "4.3.3 Создать PathBuilder class с конструктором",
            "description": "Инициализация с загрузкой графов через graph_client.load_graphs_from_all_documents()",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 23
          },
          {
            "id": 4,
            "title": "4.3.4 Реализовать build_path (основной метод)",
            "description": "5 этапов: анализ интересов/вызовов, промежуточные состояния, шаги пути, персонализация, определение фокуса",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 23
          },
          {
            "id": 5,
            "title": "4.3.5 Реализовать _get_intermediate_states",
            "description": "Построение цепочки переходов между состояниями на основе state_progression",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 23
          },
          {
            "id": 6,
            "title": "4.3.6 Реализовать _build_step / _get_concepts_for_transition",
            "description": "Построение одного шага пути, определение концептов для перехода, получение практик из графа",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 23
          },
          {
            "id": 7,
            "title": "4.3.7 Реализовать вспомогательные методы состояний",
            "description": "_get_expected_outcomes, _get_focus_areas, _get_warning_signs, _get_step_description для каждого состояния",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 23
          },
          {
            "id": 8,
            "title": "4.3.8 Реализовать _personalize_path / _determine_key_focus / singleton",
            "description": "Персонализация по интересам/вызовам/уровню, определение фокуса, глобальный path_builder",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 23
          }
        ]
      },
      {
        "id": 24,
        "title": "Phase 4.4: Создание answer_adaptive.py — Адаптивный QA",
        "description": "Основная функция Phase 4: answer_question_adaptive. Интеграция всех компонентов: state_classifier, conversation_memory, path_builder с базовыми компонентами Phase 1-3.",
        "details": "Создать bot_agent/answer_adaptive.py с answer_question_adaptive(): 1) Параметры: query, user_id, user_level, include_path_recommendation, include_feedback_prompt, debug, 2) Этап 1: загрузка данных и памяти, 3) Этап 2: анализ состояния через state_classifier, 4) Этап 3: поиск блоков через retriever, 5) Этап 4: генерация ответа с контекстом состояния, 6) Этап 5: рекомендация пути через path_builder, 7) Этап 6: подготовка запроса обратной связи, 8) Этап 7: сохранение в conversation_memory, 9) Возврат расширенного Dict: status, answer, state_analysis, path_recommendation, conversation_context, feedback_prompt, sources, concepts, metadata.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          21,
          22,
          23
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "4.4.1 Создать структуру answer_question_adaptive с импортами",
            "description": "Импорты: data_loader, retriever, LLMAnswerer, UserLevelAdapter, SemanticAnalyzer, graph_client, state_classifier, conversation_memory, path_builder, config",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 24
          },
          {
            "id": 2,
            "title": "4.4.2 Этапы 1-2: Загрузка данных, памяти, анализ состояния",
            "description": "Загрузка data_loader, get_conversation_memory(user_id), state_classifier.analyze_message с history context",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 24
          },
          {
            "id": 3,
            "title": "4.4.3 Этапы 3-4: Поиск блоков, генерация ответа с контекстом состояния",
            "description": "Retriever search, filter_blocks_by_level, добавление state_context в промпт, LLM generate_answer",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 24
          },
          {
            "id": 4,
            "title": "4.4.4 Этап 5: Построение рекомендации пути",
            "description": "path_builder.build_path если include_path_recommendation, форматирование path_recommendation dict",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 24
          },
          {
            "id": 5,
            "title": "4.4.5 Этапы 6-7: Подготовка обратной связи и сохранение в память",
            "description": "feedback_prompt по состоянию, memory.add_turn с state/concepts, автосохранение",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 24
          },
          {
            "id": 6,
            "title": "4.4.6 Форматирование финального результата Phase 4",
            "description": "Возврат Dict: status, answer, state_analysis, path_recommendation, conversation_context, feedback_prompt, sources, concepts, metadata, timestamp, processing_time",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 24
          }
        ]
      },
      {
        "id": 25,
        "title": "Phase 4.5: Обновление __init__.py для Phase 4",
        "description": "Обновить bot_agent/__init__.py — добавить импорт Phase 4 модулей, обновить __all__ и лог инициализации.",
        "details": "1) Добавить: from answer_adaptive import answer_question_adaptive, 2) Обновить __all__ добавив answer_question_adaptive, 3) Обновить лог: Bot Agent v0.4.0 initialized (Phase 1 + 2 + 3 + 4).",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          24
        ],
        "priority": "medium",
        "subtasks": [
          {
            "id": 1,
            "title": "4.5.1 Добавить импорт Phase 4 модулей",
            "description": "from answer_adaptive import answer_question_adaptive",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 25
          },
          {
            "id": 2,
            "title": "4.5.2 Обновить __all__ и лог инициализации",
            "description": "Добавить answer_question_adaptive в __all__, обновить лог: Bot Agent v0.4.0 (Phase 1 + 2 + 3 + 4)",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 25
          }
        ]
      },
      {
        "id": 26,
        "title": "Phase 4.6: Создание test_phase4.py",
        "description": "Тестовый скрипт для проверки Phase 4 функциональности. 4 тестовых сценария: новый пользователь, продолжение диалога (память), STAGNANT состояние, BREAKTHROUGH состояние.",
        "details": "Создать bot_psychologist/test_phase4.py с: 1) 4 тестовых сценария с разными user_id, user_level, состояниями, 2) Вывод: status, processing_time, state_analysis, answer, path_recommendation, feedback_prompt, sources, debug, 3) Проверка: состояние определяется корректно, память сохраняется, путь строится, обратная связь запрашивается.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          25
        ],
        "priority": "medium",
        "subtasks": [
          {
            "id": 1,
            "title": "4.6.1 Создать test_phase4.py с тестовыми сценариями",
            "description": "4 сценария: новый пользователь (beginner), продолжение диалога (память), STAGNANT (intermediate), BREAKTHROUGH (advanced)",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 26
          },
          {
            "id": 2,
            "title": "4.6.2 Реализовать вывод результатов",
            "description": "Вывод: status, processing_time, state_analysis, answer, path_recommendation, feedback_prompt, sources, debug info",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 26
          },
          {
            "id": 3,
            "title": "4.6.3 Запуск и верификация тестов Phase 4",
            "description": "Выполнить python test_phase4.py, проверить все 4 сценария passed",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 26
          }
        ]
      },
      {
        "id": 27,
        "title": "Phase 4.7: Финальная проверка и валидация Phase 4",
        "description": "Финальная проверка всех компонентов Phase 4 по чек-листу. Валидация: классификация состояний, память диалога, построение путей, адаптивные ответы, готовность к production.",
        "details": "1) Чек-лист Phase 4: state_classifier.py создан (10 состояний, keyword + LLM анализ), conversation_memory.py создан (персистентное хранилище), path_builder.py создан (персональные пути), answer_adaptive.py создан (основной pipeline), __init__.py обновлён, test_phase4.py создан и проходит, 2) Валидация результатов: состояния определяются корректно, история сохраняется и загружается, пути строятся персонализированно, все 4 тестовых сценария passed.",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          26
        ],
        "priority": "medium",
        "subtasks": [
          {
            "id": 1,
            "title": "4.7.1 Пройти чек-лист Phase 4",
            "description": "Проверить: state_classifier.py, conversation_memory.py, path_builder.py, answer_adaptive.py созданы, __init__.py обновлён, test_phase4.py проходит",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 27
          },
          {
            "id": 2,
            "title": "4.7.2 Валидация результатов Phase 4",
            "description": "Состояния определяются корректно, память сохраняется и загружается, пути строятся персонализированно, готовность к production",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 27
          }
        ]
      },
      {
        "id": 28,
        "title": "Phase 5.1: Создание api/models.py — Pydantic Models",
        "description": "Создать api/models.py с Pydantic моделями для валидации запросов и ответов API. Включает Enum для уровней и обратной связи, Request Models (AskQuestionRequest, FeedbackRequest, GetUserHistoryRequest, GetStatsRequest) и Response Models (SourceResponse, StateAnalysisResponse, PathRecommendationResponse, AnswerResponse, AdaptiveAnswerResponse, etc.).",
        "details": "Файл: bot_psychologist/api/models.py\n\nСодержимое:\n1. ENUMS: UserLevel (beginner/intermediate/advanced), FeedbackType (positive/negative/neutral)\n2. REQUEST MODELS:\n   - AskQuestionRequest: query, user_id, user_level, include_path, include_feedback_prompt, debug\n   - FeedbackRequest: user_id, turn_index, feedback, rating, comment\n   - GetUserHistoryRequest: user_id, last_n_turns\n   - GetStatsRequest: user_id (optional), time_range_days\n3. RESPONSE MODELS:\n   - SourceResponse: block_id, title, youtube_link, start, end, block_type, complexity_score\n   - StateAnalysisResponse: primary_state, confidence, emotional_tone, recommendations\n   - PathStepResponse: step_number, title, duration_weeks, practices, key_concepts\n   - PathRecommendationResponse: current_state, target_state, key_focus, steps_count, total_duration_weeks, first_step\n   - AnswerResponse: status, answer, concepts, sources, metadata, timestamp, processing_time_seconds\n   - AdaptiveAnswerResponse: всё от AnswerResponse + state_analysis, path_recommendation, feedback_prompt, conversation_context\n   - ConversationTurnResponse, UserHistoryResponse, FeedbackResponse, HealthCheckResponse, ErrorResponse, StatsResponse",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          27
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "5.1.1 Создать Enum UserLevel и FeedbackType",
            "description": "Создать UserLevel (beginner/intermediate/advanced) и FeedbackType (positive/negative/neutral) enums",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 28
          },
          {
            "id": 2,
            "title": "5.1.2 Создать Request Models",
            "description": "AskQuestionRequest с валидаторами, FeedbackRequest, GetUserHistoryRequest, GetStatsRequest",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 28
          },
          {
            "id": 3,
            "title": "5.1.3 Создать базовые Response Models",
            "description": "SourceResponse, StateAnalysisResponse, PathStepResponse, PathRecommendationResponse",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 28
          },
          {
            "id": 4,
            "title": "5.1.4 Создать основные Response Models",
            "description": "AnswerResponse, AdaptiveAnswerResponse с полной структурой Phase 4",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 28
          },
          {
            "id": 5,
            "title": "5.1.5 Создать вспомогательные Response Models",
            "description": "ConversationTurnResponse, UserHistoryResponse, FeedbackResponse, HealthCheckResponse, ErrorResponse, StatsResponse",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 28
          }
        ]
      },
      {
        "id": 29,
        "title": "Phase 5.2: Создание api/auth.py — API Key Authentication & Rate Limiting",
        "description": "Создать api/auth.py с классом APIKeyManager для управления API ключами и rate limiting. Включает валидацию ключей, проверку лимитов запросов, dependency для FastAPI verify_api_key.",
        "details": "Файл: bot_psychologist/api/auth.py\n\nСодержимое:\n1. APIKeyManager class:\n   - __init__: инициализация api_keys dict (test-key-001, dev-key-001), request_counts dict\n   - get_api_key(key): получить информацию об API ключе\n   - is_valid(key): проверить валидность и активность ключа\n   - check_rate_limit(api_key): проверить лимит частоты запросов (100-1000 req/min)\n   - add_api_key(key, name, rate_limit): добавить новый ключ\n2. verify_api_key async dependency:\n   - Проверка заголовка X-API-Key\n   - HTTPException 403 если ключ отсутствует или невалиден\n   - HTTPException 429 если превышен rate limit\n3. get_api_key_info с lru_cache\n4. Глобальный api_key_manager singleton",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          27
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "5.2.1 Создать APIKeyManager class",
            "description": "Конструктор с api_keys dict (test-key-001, dev-key-001), request_counts dict",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 29
          },
          {
            "id": 2,
            "title": "5.2.2 Реализовать get_api_key и is_valid",
            "description": "Методы для получения информации о ключе и проверки валидности",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 29
          },
          {
            "id": 3,
            "title": "5.2.3 Реализовать check_rate_limit",
            "description": "Ограничение частоты запросов (100-1000 req/min) с очисткой старых записей",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 29
          },
          {
            "id": 4,
            "title": "5.2.4 Реализовать verify_api_key dependency",
            "description": "Async dependency для FastAPI: X-API-Key header, HTTPException 403/429",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 29
          },
          {
            "id": 5,
            "title": "5.2.5 Создать singleton и get_api_key_info",
            "description": "Глобальный api_key_manager singleton и get_api_key_info с lru_cache",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 29
          }
        ]
      },
      {
        "id": 30,
        "title": "Phase 5.3: Создание api/routes.py — API Endpoints",
        "description": "Создать api/routes.py с REST endpoints для всех функций Phase 1-4. Включает 4 endpoints для вопросов (/basic, /sag-aware, /graph-powered, /adaptive), endpoints для истории, обратной связи, статистики и health check.",
        "details": "Файл: bot_psychologist/api/routes.py\n\nСодержимое:\n1. Router: APIRouter(prefix=\"/api/v1\", tags=[\"bot\"])\n2. QUESTIONS ENDPOINTS:\n   - POST /questions/basic — Phase 1 базовый QA\n   - POST /questions/sag-aware — Phase 2 SAG-aware QA\n   - POST /questions/graph-powered — Phase 3 Graph-powered QA\n   - POST /questions/adaptive — Phase 4 Adaptive QA (главный endpoint)\n3. USER HISTORY ENDPOINTS:\n   - POST /users/{user_id}/history — получение истории диалога\n4. FEEDBACK ENDPOINTS:\n   - POST /feedback — отправка обратной связи\n5. STATISTICS ENDPOINTS:\n   - GET /stats — общая статистика системы\n6. HEALTH CHECK:\n   - GET /health — проверка здоровья сервера\n7. Интеграция:\n   - Импорт answer_question_basic, answer_question_sag_aware, answer_question_graph_powered, answer_question_adaptive\n   - Импорт get_conversation_memory\n   - Импорт Pydantic models\n   - Импорт verify_api_key dependency",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          28,
          29
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "5.3.1 Создать router с prefix /api/v1",
            "description": "Настроить APIRouter с prefix, tags, импорты bot_agent functions, models, auth",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 30
          },
          {
            "id": 2,
            "title": "5.3.2 Реализовать POST /questions/basic",
            "description": "Phase 1 базовый QA endpoint, интеграция с answer_question_basic",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 30
          },
          {
            "id": 3,
            "title": "5.3.3 Реализовать POST /questions/sag-aware",
            "description": "Phase 2 SAG-aware QA endpoint, интеграция с answer_question_sag_aware",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 30
          },
          {
            "id": 4,
            "title": "5.3.4 Реализовать POST /questions/graph-powered",
            "description": "Phase 3 Graph-powered QA endpoint, интеграция с answer_question_graph_powered",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 30
          },
          {
            "id": 5,
            "title": "5.3.5 Реализовать POST /questions/adaptive",
            "description": "Phase 4 Adaptive QA endpoint (главный), интеграция с answer_question_adaptive",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 30
          },
          {
            "id": 6,
            "title": "5.3.6 Реализовать POST /users/{user_id}/history",
            "description": "Endpoint для получения истории диалога пользователя",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 30
          },
          {
            "id": 7,
            "title": "5.3.7 Реализовать POST /feedback",
            "description": "Endpoint для отправки обратной связи на ответ бота",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 30
          },
          {
            "id": 8,
            "title": "5.3.8 Реализовать GET /stats и GET /health",
            "description": "Endpoints для статистики системы и проверки здоровья сервера",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 30
          }
        ]
      },
      {
        "id": 31,
        "title": "Phase 5.4: Создание api/main.py — FastAPI Application",
        "description": "Создать api/main.py — главный файл FastAPI приложения. Включает настройку app, middleware (CORS, TrustedHost, logging), подключение router, custom OpenAPI schema, root endpoints и uvicorn entrypoint.",
        "details": "Файл: bot_psychologist/api/main.py\n\nСодержимое:\n1. Logging setup: basicConfig с INFO level\n2. Lifespan context manager для startup/shutdown\n3. FastAPI app:\n   - title: \"Bot Psychologist API\"\n   - version: \"0.5.0\"\n   - docs_url: \"/api/docs\"\n   - redoc_url: \"/api/redoc\"\n   - openapi_url: \"/api/openapi.json\"\n4. MIDDLEWARE:\n   - CORSMiddleware: allow_origins (localhost:3000, localhost:8080), allow_methods, allow_headers\n   - TrustedHostMiddleware: allowed_hosts (localhost, 127.0.0.1)\n   - Custom log_requests middleware: логирование входящих запросов и времени обработки\n5. Router: app.include_router(router)\n6. Custom OpenAPI: custom_openapi() с logo и описанием\n7. ROOT ENDPOINTS:\n   - GET / — информация о сервере\n   - GET /api/v1/info — детальная информация об API и endpoints\n8. Uvicorn entrypoint: uvicorn.run(\"main:app\", host=\"0.0.0.0\", port=8000, reload=True)",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          30
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "5.4.1 Настроить logging и lifespan",
            "description": "basicConfig с INFO level, lifespan context manager для startup/shutdown",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 31
          },
          {
            "id": 2,
            "title": "5.4.2 Создать FastAPI app с metadata",
            "description": "title, version 0.5.0, docs_url /api/docs, redoc_url /api/redoc, openapi_url",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 31
          },
          {
            "id": 3,
            "title": "5.4.3 Добавить CORSMiddleware",
            "description": "Cross-origin requests: allow_origins (localhost:3000, 8080), allow_methods, allow_headers",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 31
          },
          {
            "id": 4,
            "title": "5.4.4 Добавить TrustedHostMiddleware",
            "description": "Безопасность: allowed_hosts (localhost, 127.0.0.1)",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 31
          },
          {
            "id": 5,
            "title": "5.4.5 Добавить log_requests middleware",
            "description": "Custom middleware для логирования входящих запросов и времени обработки",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 31
          },
          {
            "id": 6,
            "title": "5.4.6 Подключить router и custom_openapi",
            "description": "app.include_router(router), custom_openapi() с logo и описанием",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 31
          },
          {
            "id": 7,
            "title": "5.4.7 Создать root endpoints и uvicorn",
            "description": "GET /, GET /api/v1/info, uvicorn.run entrypoint (host 0.0.0.0, port 8000)",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 31
          }
        ]
      },
      {
        "id": 32,
        "title": "Phase 5.5: Создание api/__init__.py и api/requirements.txt",
        "description": "Создать api/__init__.py с экспортами модуля и api/requirements.txt с зависимостями для Phase 5.",
        "details": "Файлы:\n\n1. bot_psychologist/api/__init__.py:\n   - from .main import app\n   - from .models import *\n   - from .auth import api_key_manager, verify_api_key\n   - __all__ = [\"app\", \"api_key_manager\", \"verify_api_key\"]\n\n2. bot_psychologist/api/requirements.txt:\n   - fastapi==0.104.1\n   - uvicorn[standard]==0.24.0\n   - pydantic==2.5.0\n   - pydantic-settings==2.1.0\n   - python-multipart==0.0.6\n   - python-jose[cryptography]==3.3.0\n   - passlib[bcrypt]==1.7.4\n   - pytest==7.4.3\n   - pytest-asyncio==0.21.1\n   - httpx==0.25.1",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          31
        ],
        "priority": "medium",
        "subtasks": [
          {
            "id": 1,
            "title": "5.5.1 Создать api/__init__.py",
            "description": "Экспорты: app, api_key_manager, verify_api_key; __all__ список",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 32
          },
          {
            "id": 2,
            "title": "5.5.2 Создать api/requirements.txt",
            "description": "Зависимости: fastapi, uvicorn, pydantic, pytest, httpx и др.",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 32
          }
        ]
      },
      {
        "id": 33,
        "title": "Phase 5.6: Создание test_api.py — Тестирование API",
        "description": "Создать test_api.py — тестовый скрипт для проверки всех API endpoints. Включает тесты health check, adaptive question, user history, feedback, statistics и invalid API key.",
        "details": "Файл: bot_psychologist/test_api.py\n\nСодержимое:\n1. Константы: BASE_URL = \"http://localhost:8000\", API_KEY = \"test-key-001\"\n2. get_headers(): возврат {\"X-API-Key\": API_KEY, \"Content-Type\": \"application/json\"}\n3. ТЕСТЫ:\n   - test_health_check(): GET /api/v1/health, assert status 200\n   - test_adaptive_question(): POST /api/v1/questions/adaptive с payload, assert status 200\n   - test_user_history(): POST /api/v1/users/{user_id}/history, assert status 200\n   - test_feedback(): POST /api/v1/feedback с payload, assert status 200\n   - test_statistics(): GET /api/v1/stats, assert status 200\n   - test_invalid_api_key(): запрос с невалиден ключом, assert status 403\n4. Main block: запуск всех тестов с выводом результатов",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          32
        ],
        "priority": "medium",
        "subtasks": [
          {
            "id": 1,
            "title": "5.6.1 Создать test_health_check",
            "description": "GET /api/v1/health, assert status 200, проверка status: healthy",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 33
          },
          {
            "id": 2,
            "title": "5.6.2 Создать test_adaptive_question",
            "description": "POST /api/v1/questions/adaptive, payload с query и user_id, проверка state_analysis",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 33
          },
          {
            "id": 3,
            "title": "5.6.3 Создать test_user_history",
            "description": "POST /api/v1/users/{user_id}/history, проверка total_turns и turns",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 33
          },
          {
            "id": 4,
            "title": "5.6.4 Создать test_feedback",
            "description": "POST /api/v1/feedback, payload с user_id, turn_index, feedback, проверка success",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 33
          },
          {
            "id": 5,
            "title": "5.6.5 Создать test_statistics",
            "description": "GET /api/v1/stats, проверка total_users, total_questions, average_processing_time",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 33
          },
          {
            "id": 6,
            "title": "5.6.6 Создать test_invalid_api_key",
            "description": "Запрос с невалидным API ключом, assert status 403, проверка detail",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 33
          }
        ]
      },
      {
        "id": 34,
        "title": "Phase 5.7: Запуск и тестирование API Server",
        "description": "Установить зависимости, запустить FastAPI сервер, проверить Swagger документацию и выполнить все тесты test_api.py.",
        "details": "Шаги:\n1. Установка зависимостей:\n   cd bot_psychologist\n   pip install -r api/requirements.txt\n\n2. Запуск сервера:\n   python api/main.py\n\n3. Проверка endpoints:\n   - Main: http://localhost:8000\n   - Swagger Docs: http://localhost:8000/api/docs\n   - ReDoc: http://localhost:8000/api/redoc\n\n4. Запуск тестов:\n   python test_api.py\n\n5. Ожидаемые результаты:\n   - Все 6 тестов проходят\n   - Health check возвращает status: healthy\n   - Adaptive question возвращает ответ с state_analysis\n   - API key authentication работает (403 для невалиден ключей)",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          33
        ],
        "priority": "medium",
        "subtasks": [
          {
            "id": 1,
            "title": "5.7.1 Установить зависимости",
            "description": "pip install -r api/requirements.txt",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 34
          },
          {
            "id": 2,
            "title": "5.7.2 Запустить FastAPI сервер",
            "description": "python api/main.py, проверить http://localhost:8000",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 34
          },
          {
            "id": 3,
            "title": "5.7.3 Проверить Swagger документацию",
            "description": "Открыть http://localhost:8000/api/docs, проверить все endpoints",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 34
          },
          {
            "id": 4,
            "title": "5.7.4 Выполнить все тесты test_api.py",
            "description": "python test_api.py, убедиться что все 6 тестов проходят",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 34
          }
        ]
      },
      {
        "id": 35,
        "title": "Phase 5.8: Финальная проверка и валидация Phase 5",
        "description": "Финальная проверка всех компонентов Phase 5 по чек-листу. Валидация: все endpoints работают, Swagger документация доступна, authentication и rate limiting функционируют, готовность к Phase 6.",
        "details": "Чек-лист Phase 5:\n- [ ] Создан api/models.py (Pydantic models)\n- [ ] Создан api/auth.py (API Key validation + Rate limiting)\n- [ ] Создан api/routes.py (4 endpoints для вопросов + 3 дополнительных)\n- [ ] Создан api/main.py (FastAPI app + middleware)\n- [ ] Создан api/__init__.py\n- [ ] Создан api/requirements.txt\n- [ ] Создан test_api.py\n- [ ] FastAPI сервер запущен и все endpoints работают\n- [ ] Swagger документация доступна\n- [ ] 6/6 тестов пройдены\n\nВалидация:\n- POST /api/v1/questions/basic работает (Phase 1)\n- POST /api/v1/questions/sag-aware работает (Phase 2)\n- POST /api/v1/questions/graph-powered работает (Phase 3)\n- POST /api/v1/questions/adaptive работает (Phase 4)\n- POST /api/v1/users/{user_id}/history работает\n- POST /api/v1/feedback работает\n- GET /api/v1/stats работает\n- GET /api/v1/health работает\n- Authentication: 403 для невалиден API ключей\n- Rate limiting: 429 при превышении лимита\n\nГотовность к Phase 6 (Web UI)",
        "testStrategy": "",
        "status": "done",
        "dependencies": [
          34
        ],
        "priority": "medium",
        "subtasks": [
          {
            "id": 1,
            "title": "5.8.1 Пройти чек-лист Phase 5",
            "description": "Проверить все файлы: models.py, auth.py, routes.py, main.py, __init__.py, requirements.txt, test_api.py",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 35
          },
          {
            "id": 2,
            "title": "5.8.2 Валидация endpoints",
            "description": "Проверить все 8 endpoints работают с API key auth, rate limiting функционирует",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 35
          },
          {
            "id": 3,
            "title": "5.8.3 Подтвердить готовность к Phase 6",
            "description": "Swagger доступен, все тесты проходят, готовность к Web UI",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 35
          }
        ]
      }
    ],
    "metadata": {
      "created": "2025-12-19T04:02:29.457Z",
      "updated": "2025-12-19T08:21:23.090Z",
      "description": "Tasks for master context"
    }
  }
}