# üìã –ü–†–î: –°–∏—Å—Ç–µ–º–∞ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è Bot Psychologist

## Product Requirements Document ‚Äî –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –í–µ—Ä—Å–∏—è v1.1


***

**–í–µ—Ä—Å–∏—è:** 1.1 (–∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–¥ bot_psychologist)
**–î–∞—Ç–∞:** 10 —Ñ–µ–≤—Ä–∞–ª—è 2026
**–û–±–ª–∞—Å—Ç—å:** –§–∞–∑–∞ 1 ‚Äî –ë–∞–∑–æ–≤–æ–µ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
**–°—Ä–æ–∫:** üöÄ **1-2 –¥–Ω—è**
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0 (–ö—Ä–∏—Ç–∏—á–Ω–æ)

***

## üéØ –ö—Ä–∞—Ç–∫–æ–µ –û–ø–∏—Å–∞–Ω–∏–µ

### –¶–µ–ª—å

–í–Ω–µ–¥—Ä–∏—Ç—å **–º–∏–Ω–∏–º–∞–ª—å–Ω–æ –∂–∏–∑–Ω–µ—Å–ø–æ—Å–æ–±–Ω—É—é —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è** –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ª–æ–≥–∏–∫–∏ AI-–±–æ—Ç–∞-–ø—Å–∏—Ö–æ–ª–æ–≥–∞, —É—á–∏—Ç—ã–≤–∞—é—â—É—é —Å–ø–µ—Ü–∏—Ñ–∏–∫—É –ø—Ä–æ–µ–∫—Ç–∞ (4 —Ñ–∞–∑—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤, –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π pipeline, semantic memory).

### –ß—Ç–æ –í–∫–ª—é—á–µ–Ω–æ (MVP)

‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–∞–π–ª—ã (app.log, error.log, retrieval.log)
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ, —Ö—Ä–∞–Ω–µ–Ω–∏–µ 30 –¥–Ω–µ–π)
‚úÖ –¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∫–ª—é—á–µ–≤—ã–µ –º–æ–¥—É–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ retrieval pipeline —Å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π
‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Å—Å–∏—è–º–∏ –∏ –ø–∞–º—è—Ç—å—é
‚úÖ –†—É—Å—Å–∫–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ

### –ß—Ç–æ –ù–ï –í–∫–ª—é—á–µ–Ω–æ (–ü–æ–∑–∂–µ)

‚ùå JSON —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏
‚ùå –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
‚ùå –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (user_id –≤ –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏)
‚ùå –û—Ç–¥–µ–ª—å–Ω—ã–µ debug –ª–æ–≥–≥–µ—Ä—ã
‚ùå –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥/–∞–ª–µ—Ä—Ç—ã
‚ùå –í–Ω–µ—à–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (Sentry, DataDog)

### ROI

- **–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** 3-4 —á–∞—Å–∞
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ –æ—Ç–ª–∞–¥–∫–∏:** 60-80%
- **–°—Ç–æ–∏–º–æ—Å—Ç—å:** \$0 (—Ç–æ–ª—å–∫–æ stdlib)

***

## üìä –¶–µ–ª–∏ –∏ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ (P0)

| ID | –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –£—Å–∏–ª–∏—è |
| :-- | :-- | :-- |
| R1 | –õ–æ–≥–∏ –≤ —Ñ–∞–π–ª—ã (–Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ) | 30 –º–∏–Ω |
| R2 | –†–æ—Ç–∞—Ü–∏—è (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ, 30 –¥–Ω–µ–π —Ö—Ä–∞–Ω–µ–Ω–∏—è) | 10 –º–∏–Ω |
| R3 | –ö–æ–Ω—Å–æ–ª—å + –§–∞–π–ª –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ | 10 –º–∏–Ω |
| R4 | ERROR –ª–æ–≥–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª | 10 –º–∏–Ω |
| R5 | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ api/main.py | 20 –º–∏–Ω |
| R6 | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ retriever.py | 30 –º–∏–Ω |
| R7 | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ answer_adaptive.py | 40 –º–∏–Ω |
| R8 | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ conversation_memory.py | 20 –º–∏–Ω |
| R9 | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ semantic_memory.py | 20 –º–∏–Ω |
| R10 | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ retrieval –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ | 30 –º–∏–Ω |

**–ò—Ç–æ–≥–æ:** ~3.5 —á–∞—Å–∞ —Ä–∞–±–æ—Ç—ã

***

## üèóÔ∏è –ü–ª–∞–Ω –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å `logging_config.py` (40 –º–∏–Ω)

**–§–∞–π–ª:** `bot_psychologist/logging_config.py`

```python
"""
–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è production
–ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –æ—Ç–ª–∞–¥–∫–∏

–°–æ–∑–¥–∞–µ—Ç —Ç—Ä–∏ –ª–æ–≥-—Ñ–∞–π–ª–∞:
- logs/app/bot.log - –≤—Å–µ –ª–æ–≥–∏ INFO+
- logs/retrieval/retrieval.log - –ª–æ–≥–∏ retrieval pipeline
- logs/error/error.log - —Ç–æ–ª—å–∫–æ ERROR+
"""

import logging
import sys
from pathlib import Path
from logging.handlers import TimedRotatingFileHandler

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
BASE_DIR = Path(__file__).parent
LOG_DIR = BASE_DIR / "logs"

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
(LOG_DIR / "app").mkdir(parents=True, exist_ok=True)
(LOG_DIR / "retrieval").mkdir(parents=True, exist_ok=True)
(LOG_DIR / "error").mkdir(parents=True, exist_ok=True)


class ColoredFormatter(logging.Formatter):
    """–¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏"""
    
    COLORS = {
        'DEBUG': '\033[36m',     # –ì–æ–ª—É–±–æ–π
        'INFO': '\033[32m',      # –ó–µ–ª–µ–Ω—ã–π
        'WARNING': '\033[33m',   # –ñ–µ–ª—Ç—ã–π
        'ERROR': '\033[31m',     # –ö—Ä–∞—Å–Ω—ã–π
        'CRITICAL': '\033[35m',  # –ü—É—Ä–ø—É—Ä–Ω—ã–π
        'RESET': '\033[0m'
    }
    
    def format(self, record):
        # –†–∞—Å–∫—Ä–∞—Å–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        color = self.COLORS.get(record.levelname, self.COLORS['RESET'])
        levelname_colored = f"{color}{record.levelname:8s}{self.COLORS['RESET']}"
        
        # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è
        time_str = self.formatTime(record, '%H:%M:%S')
        
        # –°–æ–±—Ä–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        return f"{time_str} | {levelname_colored} | {record.name:35s} | {record.getMessage()}"


def setup_logging(level=logging.INFO):
    """
    –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ production –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    
    –°–æ–∑–¥–∞–µ—Ç:
    - logs/app/bot.log          - –í—Å–µ INFO+ –ª–æ–≥–∏
    - logs/retrieval/retrieval.log - Retrieval pipeline
    - logs/error/error.log      - –¢–æ–ª—å–∫–æ ERROR+
    - Console output (—Ü–≤–µ—Ç–Ω–æ–π)
    
    Args:
        level: –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: INFO)
    
    –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
        from logging_config import setup_logging
        setup_logging()
        
        logger = logging.getLogger(__name__)
        logger.info("–ü—Ä–∏–≤–µ—Ç –º–∏—Ä")
    """
    
    # –ü–æ–ª—É—á–∏—Ç—å root logger
    root_logger = logging.getLogger()
    root_logger.setLevel(level)
    
    # –û—á–∏—Å—Ç–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ handlers
    root_logger.handlers.clear()
    
    # ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    # CONSOLE HANDLER (—Ü–≤–µ—Ç–Ω–æ–π)
    # ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    console_handler = logging.StreamHandler(sys.stdout)
    console_handler.setLevel(level)
    console_handler.setFormatter(ColoredFormatter())
    root_logger.addHandler(console_handler)
    
    # ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    # APP LOG (–≤—Å–µ –ª–æ–≥–∏)
    # ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    app_handler = TimedRotatingFileHandler(
        filename=LOG_DIR / "app" / "bot.log",
        when="midnight",        # –†–æ—Ç–∞—Ü–∏—è –≤ –ø–æ–ª–Ω–æ—á—å
        interval=1,
        backupCount=30,         # –•—Ä–∞–Ω–∏—Ç—å 30 –¥–Ω–µ–π
        encoding="utf-8"
    )
    app_handler.setLevel(logging.INFO)
    app_handler.setFormatter(logging.Formatter(
        '%(asctime)s | %(levelname)-8s | %(name)-35s | %(message)s',
        datefmt='%Y-%m-%d %H:%M:%S'
    ))
    app_handler.suffix = "%Y%m%d"  # bot.log.20260210
    root_logger.addHandler(app_handler)
    
    # ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    # RETRIEVAL LOG (–ø–æ–∏—Å–∫ –∏ retrieval)
    # ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    retrieval_handler = TimedRotatingFileHandler(
        filename=LOG_DIR / "retrieval" / "retrieval.log",
        when="midnight",
        interval=1,
        backupCount=30,
        encoding="utf-8"
    )
    retrieval_handler.setLevel(logging.INFO)
    retrieval_handler.setFormatter(logging.Formatter(
        '%(asctime)s | %(levelname)-8s | %(message)s',
        datefmt='%Y-%m-%d %H:%M:%S'
    ))
    retrieval_handler.suffix = "%Y%m%d"
    
    # –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä —Ç–æ–ª—å–∫–æ –¥–ª—è retrieval –ª–æ–≥–æ–≤
    retrieval_handler.addFilter(lambda record: 'RETRIEVAL' in record.getMessage() or 
                                               'retriever' in record.name.lower() or
                                               'stage_filter' in record.name.lower() or
                                               'confidence_scorer' in record.name.lower())
    root_logger.addHandler(retrieval_handler)
    
    # ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    # ERROR LOG (—Ç–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏)
    # ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    error_handler = TimedRotatingFileHandler(
        filename=LOG_DIR / "error" / "error.log",
        when="midnight",
        interval=1,
        backupCount=90,         # –û—à–∏–±–∫–∏ —Ö—Ä–∞–Ω–∏—Ç—å –¥–æ–ª—å—à–µ
        encoding="utf-8"
    )
    error_handler.setLevel(logging.ERROR)
    error_handler.setFormatter(logging.Formatter(
        '%(asctime)s | %(levelname)-8s | %(name)s\n'
        '–§—É–Ω–∫—Ü–∏—è: %(funcName)s:%(lineno)d\n'
        '–°–æ–æ–±—â–µ–Ω–∏–µ: %(message)s\n'
        '–ü—É—Ç—å: %(pathname)s\n'
        '%(exc_info)s\n'
        '‚îÄ' * 80 + '\n',
        datefmt='%Y-%m-%d %H:%M:%S'
    ))
    error_handler.suffix = "%Y%m%d"
    root_logger.addHandler(error_handler)
    
    # ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    # –ü–û–î–ê–í–ò–¢–¨ –®–£–ú–ù–´–ï –õ–û–ì–ì–ï–†–´
    # ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    logging.getLogger("httpx").setLevel(logging.WARNING)
    logging.getLogger("httpcore").setLevel(logging.WARNING)
    logging.getLogger("asyncio").setLevel(logging.WARNING)
    logging.getLogger("urllib3").setLevel(logging.WARNING)
    logging.getLogger("openai").setLevel(logging.WARNING)
    logging.getLogger("voyageai").setLevel(logging.WARNING)
    logging.getLogger("sentence_transformers").setLevel(logging.WARNING)
    logging.getLogger("transformers").setLevel(logging.WARNING)
    logging.getLogger("torch").setLevel(logging.WARNING)
    
    # ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    # –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –°–¢–ê–†–¢–ê
    # ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    logging.info("=" * 70)
    logging.info("‚úÖ –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞")
    logging.info(f"   –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ª–æ–≥–æ–≤: {LOG_DIR}")
    logging.info(f"   –û—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥: logs/app/bot.log")
    logging.info(f"   Retrieval –ª–æ–≥: logs/retrieval/retrieval.log")
    logging.info(f"   –õ–æ–≥ –æ—à–∏–±–æ–∫: logs/error/error.log")
    logging.info(f"   –•—Ä–∞–Ω–µ–Ω–∏–µ: 30 –¥–Ω–µ–π (app), 90 –¥–Ω–µ–π (error)")
    logging.info("=" * 70)


def get_logger(name: str) -> logging.Logger:
    """
    –ü–æ–ª—É—á–∏—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä –ª–æ–≥–≥–µ—Ä–∞
    
    –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
        logger = get_logger(__name__)
        logger.info("–°–æ–æ–±—â–µ–Ω–∏–µ")
    """
    return logging.getLogger(name)
```

**–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~160 —Å—Ç—Ä–æ–∫
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** —Ç–æ–ª—å–∫–æ stdlib (–Ω–∏–∫–∞–∫–∏—Ö –≤–Ω–µ—à–Ω–∏—Ö –ø–∞–∫–µ—Ç–æ–≤)

***

### –®–∞–≥ 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `api/main.py` (20 –º–∏–Ω)

**–§–∞–π–ª:** `bot_psychologist/api/main.py`

```python
# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
# –î–û–ë–ê–í–ò–¢–¨ –í –ù–ê–ß–ê–õ–û (–ø–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–æ–≤)
# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

import sys
from pathlib import Path

# –î–æ–±–∞–≤–∏—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –ø—É—Ç—å
sys.path.insert(0, str(Path(__file__).parent.parent))

from logging_config import setup_logging, get_logger
import time

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –û–î–ò–ù –†–ê–ó –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥—É–ª—è
setup_logging()

logger = get_logger(__name__)

# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
# –û–ë–ù–û–í–ò–¢–¨ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Æ APP
# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

from contextlib import asynccontextmanager
from fastapi import FastAPI, Request
from fastapi.responses import JSONResponse

@asynccontextmanager
async def lifespan(app: FastAPI):
    """–°–æ–±—ã—Ç–∏—è –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
    # –°—Ç–∞—Ä—Ç
    logger.info("üöÄ API –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è")
    logger.info(f"   –í–µ—Ä—Å–∏—è: {app.version}")
    logger.info(f"   –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://localhost:8000/docs")
    
    yield
    
    # –û—Å—Ç–∞–Ω–æ–≤–∫–∞
    logger.info("üõë API –°–µ—Ä–≤–µ—Ä –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è")

app = FastAPI(
    title="Bot Psychologist API",
    version="1.0.0",
    lifespan=lifespan
)

# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
# –î–û–ë–ê–í–ò–¢–¨ MIDDLEWARE –î–õ–Ø –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø –ó–ê–ü–†–û–°–û–í
# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

@app.middleware("http")
async def log_requests(request: Request, call_next):
    """–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∑–∞–º–µ—Ä–æ–º –≤—Ä–µ–º–µ–Ω–∏"""
    start_time = time.time()
    
    # –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Ö–æ–¥—è—â–∏–π –∑–∞–ø—Ä–æ—Å
    logger.info(f"‚Üí {request.method} {request.url.path}")
    
    # –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞–ø—Ä–æ—Å
    try:
        response = await call_next(request)
        
        # –í—ã—á–∏—Å–ª–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É
        latency_ms = (time.time() - start_time) * 1000
        
        # –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç
        logger.info(
            f"‚Üê {request.method} {request.url.path} | "
            f"–°—Ç–∞—Ç—É—Å: {response.status_code} | "
            f"–í—Ä–µ–º—è: {latency_ms:.1f}ms"
        )
        
        return response
        
    except Exception as e:
        latency_ms = (time.time() - start_time) * 1000
        logger.error(
            f"‚úó {request.method} {request.url.path} —É–ø–∞–ª –ø–æ—Å–ª–µ {latency_ms:.1f}ms",
            exc_info=True
        )
        raise

# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
# –î–û–ë–ê–í–ò–¢–¨ –ì–õ–û–ë–ê–õ–¨–ù–´–ô –û–ë–†–ê–ë–û–¢–ß–ò–ö –û–®–ò–ë–û–ö
# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

@app.exception_handler(Exception)
async def global_exception_handler(request: Request, exc: Exception):
    """–ü–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å –∏ –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è"""
    logger.error(
        f"–ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ {request.method} {request.url.path}",
        exc_info=True
    )
    
    return JSONResponse(
        status_code=500,
        content={"detail": "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞"}
    )

# ... –æ—Å—Ç–∞–ª—å–Ω–æ–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
```


***

### –®–∞–≥ 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `bot_agent/retriever.py` (30 –º–∏–Ω)

```python
# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
# –î–û–ë–ê–í–ò–¢–¨ –í –ù–ê–ß–ê–õ–û
# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

from logging_config import get_logger

logger = get_logger(__name__)

# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
# –û–ë–ù–û–í–ò–¢–¨ –º–µ—Ç–æ–¥ retrieve()
# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

def retrieve(self, query: str, top_k: int = 5) -> List[Block]:
    """Retrieval —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –±–ª–æ–∫–æ–≤ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º"""
    
    # –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—á–∞–ª–æ
    logger.info(f"[RETRIEVAL] –°—Ç–∞—Ä—Ç retrieval")
    logger.info(f"[RETRIEVAL]   –ó–∞–ø—Ä–æ—Å: '{query[:80]}...'")
    logger.info(f"[RETRIEVAL]   top_k: {top_k}")
    
    try:
        # TF-IDF –ø–æ–∏—Å–∫
        logger.info("[RETRIEVAL] –ó–∞–ø—É—Å–∫ TF-IDF –ø–æ–∏—Å–∫–∞...")
        tfidf_results = self._tfidf_search(query, top_k=top_k)
        
        logger.info(
            f"[RETRIEVAL] TF-IDF –Ω–∞—à–µ–ª {len(tfidf_results)} –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤"
        )
        
        # –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ø —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å–æ —Å–∫–æ—Ä–∞–º–∏
        for i, block in enumerate(tfidf_results[:3], 1):
            logger.info(
                f"[RETRIEVAL]   #{i}: score={block.score:.3f}, "
                f"block_id={block.metadata.get('block_id', 'unknown')}"
            )
        
        # Voyage rerank (—Å fallback)
        if self.voyage_reranker and self.voyage_reranker.enabled:
            logger.info("[RETRIEVAL] –ü–æ–ø—ã—Ç–∫–∞ Voyage rerank...")
            try:
                reranked = self.voyage_reranker.rerank(query, tfidf_results, top_k=top_k)
                logger.info(
                    f"[RETRIEVAL] ‚úÖ Voyage rerank —É—Å–ø–µ—à–µ–Ω: {len(reranked)} –±–ª–æ–∫–æ–≤"
                )
                return reranked
                
            except Exception as voyage_error:
                logger.warning(
                    f"[RETRIEVAL] ‚ö†Ô∏è  Voyage rerank —É–ø–∞–ª: {voyage_error}"
                )
                logger.warning(
                    f"[RETRIEVAL] ‚ö†Ô∏è  Fallback –Ω–∞ TF-IDF —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã"
                )
                return tfidf_results
        else:
            logger.info("[RETRIEVAL] Voyage rerank –æ—Ç–∫–ª—é—á–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º TF-IDF")
            return tfidf_results
        
    except Exception as e:
        logger.error(
            f"[RETRIEVAL] ‚ùå Retrieval —É–ø–∞–ª: {e}",
            exc_info=True
        )
        raise
```


***

### –®–∞–≥ 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `bot_agent/answer_adaptive.py` (40 –º–∏–Ω)

```python
# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
# –î–û–ë–ê–í–ò–¢–¨ –í –ù–ê–ß–ê–õ–û
# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

from logging_config import get_logger

logger = get_logger(__name__)

# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
# –û–ë–ù–û–í–ò–¢–¨ –º–µ—Ç–æ–¥ answer_adaptive()
# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

def answer_adaptive(
    self,
    user_query: str,
    user_id: str,
    session_id: str = None
) -> dict:
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ —Å –ø–æ–ª–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º"""
    
    logger.info("=" * 70)
    logger.info(f"[ADAPTIVE] –ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å")
    logger.info(f"[ADAPTIVE]   user_id: {user_id}")
    logger.info(f"[ADAPTIVE]   session_id: {session_id}")
    logger.info(f"[ADAPTIVE]   –∑–∞–ø—Ä–æ—Å: '{user_query[:80]}...'")
    logger.info("=" * 70)
    
    try:
        # –§–∞–∑–∞ 1: Query augmentation
        logger.info("üéØ –§–∞–∑–∞ 1: Query Augmentation")
        augmented = self._augment_query(user_query, user_id, session_id)
        logger.info(f"   –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å: '{augmented[:80]}...'")
        
        # –§–∞–∑–∞ 2: Retrieval
        logger.info("üéØ –§–∞–∑–∞ 2: Retrieval")
        blocks = self.retriever.retrieve(augmented, top_k=10)
        logger.info(f"   –ü–æ–ª—É—á–µ–Ω–æ {len(blocks)} –±–ª–æ–∫–æ–≤")
        
        # –§–∞–∑–∞ 3: Stage filter
        logger.info("üéØ –§–∞–∑–∞ 3: Stage Filter")
        working_state = self.get_working_state(user_id, session_id)
        filtered = self.stage_filter.filter(blocks, working_state)
        logger.info(f"   –ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞: {len(filtered)} –±–ª–æ–∫–æ–≤")
        
        if len(filtered) == 0:
            logger.warning("   ‚ö†Ô∏è  –ù–µ—Ç –±–ª–æ–∫–æ–≤ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞! Fallback –Ω–∞ —Ç–æ–ø-3")
            filtered = blocks[:3]
        
        # –§–∞–∑–∞ 4: Decision gate
        logger.info("üéØ –§–∞–∑–∞ 4: Decision Gate")
        decision_result = self.decision_gate.decide(user_query, filtered, working_state)
        logger.info(f"   –†–µ–∂–∏–º: {decision_result['recommended_mode']}")
        logger.info(f"   –ü—Ä–∞–≤–∏–ª–æ: {decision_result.get('decision_rule_id', 'N/A')}")
        logger.info(f"   –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {decision_result.get('confidence_score', 0):.2f}")
        
        # –§–∞–∑–∞ 5: Confidence cap
        logger.info("üéØ –§–∞–∑–∞ 5: Confidence Cap")
        final_blocks = self.confidence_scorer.cap(filtered, decision_result['confidence_score'])
        logger.info(f"   –§–∏–Ω–∞–ª—å–Ω—ã—Ö –±–ª–æ–∫–æ–≤: {len(final_blocks)}")
        
        # –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –¥–µ—Ç–∞–ª–∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –±–ª–æ–∫–æ–≤
        for i, block in enumerate(final_blocks, 1):
            logger.info(
                f"   –ë–ª–æ–∫ #{i}: confidence={getattr(block, 'confidence', 1.0):.2f}, "
                f"block_id={block.metadata.get('block_id', 'unknown')}"
            )
        
        # –§–∞–∑–∞ 6: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞
        logger.info("üéØ –§–∞–∑–∞ 6: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –û—Ç–≤–µ—Ç–∞")
        response = self._generate_response(
            user_query, 
            final_blocks, 
            user_id, 
            session_id,
            decision_result
        )
        
        logger.info(f"[ADAPTIVE] ‚úÖ –û—Ç–≤–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω ({len(response.get('answer', ''))} —Å–∏–º–≤–æ–ª–æ–≤)")
        logger.info("=" * 70)
        
        return response
        
    except Exception as e:
        logger.error(
            f"[ADAPTIVE] ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç",
            exc_info=True
        )
        raise
```


***

### –®–∞–≥ 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `bot_agent/conversation_memory.py` (20 –º–∏–Ω)

```python
# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
# –î–û–ë–ê–í–ò–¢–¨ –í –ù–ê–ß–ê–õ–û
# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

from logging_config import get_logger

logger = get_logger(__name__)

# –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã save_turn, load_history, clear_history

def save_turn(self, user_id: str, user_msg: str, bot_msg: str):
    """–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ö–æ–¥ –¥–∏–∞–ª–æ–≥–∞ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º"""
    logger.info(f"[MEMORY] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ö–æ–¥–∞ –¥–ª—è user_id={user_id}")
    try:
        # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
        logger.info(f"[MEMORY] ‚úÖ –•–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω (–≤—Å–µ–≥–æ: {len(history)} —Ö–æ–¥–æ–≤)")
    except Exception as e:
        logger.error(f"[MEMORY] ‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: {e}", exc_info=True)
        raise

def load_history(self, user_id: str, last_n: int = None) -> List[dict]:
    """–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º"""
    logger.info(f"[MEMORY] –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è user_id={user_id}, last_n={last_n}")
    try:
        history = # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
        logger.info(f"[MEMORY] ‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(history)} —Ö–æ–¥–æ–≤")
        return history
    except Exception as e:
        logger.error(f"[MEMORY] ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: {e}", exc_info=True)
        return []

def clear_history(self, user_id: str):
    """–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º"""
    logger.info(f"[MEMORY] –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è user_id={user_id}")
    try:
        # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
        logger.info(f"[MEMORY] ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞")
    except Exception as e:
        logger.error(f"[MEMORY] ‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏: {e}", exc_info=True)
        raise
```


***

### –®–∞–≥ 6: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `bot_agent/semantic_memory.py` (20 –º–∏–Ω)

```python
# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
# –î–û–ë–ê–í–ò–¢–¨ –í –ù–ê–ß–ê–õ–û
# ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

from logging_config import get_logger

logger = get_logger(__name__)

# –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã search, add_turn, rebuild

def search(self, user_id: str, query: str, top_k: int = 3) -> List[dict]:
    """–ü–æ–∏—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –æ–±–º–µ–Ω–æ–≤ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º"""
    logger.info(f"[SEMANTIC] –ü–æ–∏—Å–∫ –¥–ª—è user_id={user_id}, query='{query[:50]}...'")
    try:
        results = # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
        logger.info(f"[SEMANTIC] ‚úÖ –ù–∞–π–¥–µ–Ω–æ {len(results)} —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –æ–±–º–µ–Ω–æ–≤")
        for i, r in enumerate(results, 1):
            logger.info(f"[SEMANTIC]   #{i}: similarity={r['similarity']:.3f}")
        return results
    except Exception as e:
        logger.error(f"[SEMANTIC] ‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞: {e}", exc_info=True)
        return []

def add_turn(self, user_id: str, user_msg: str, bot_msg: str):
    """–î–æ–±–∞–≤–∏—Ç—å —Ö–æ–¥ –≤ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫—É—é –ø–∞–º—è—Ç—å —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º"""
    logger.info(f"[SEMANTIC] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ö–æ–¥–∞ –¥–ª—è user_id={user_id}")
    try:
        # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
        logger.info(f"[SEMANTIC] ‚úÖ –•–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω")
    except Exception as e:
        logger.error(f"[SEMANTIC] ‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: {e}", exc_info=True)
```


***

### –®–∞–≥ 7: –î–æ–±–∞–≤–∏—Ç—å `.gitignore` (5 –º–∏–Ω)

**–§–∞–π–ª:** `bot_psychologist/.gitignore` (–¥–æ–±–∞–≤–∏—Ç—å)

```bash
# –õ–æ–≥–∏
logs/*.log
logs/**/*.log
logs/**/*.log.*

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
!logs/.gitkeep
!logs/app/.gitkeep
!logs/retrieval/.gitkeep
!logs/error/.gitkeep
```

**–°–æ–∑–¥–∞—Ç—å .gitkeep —Ñ–∞–π–ª—ã:**

```bash
touch bot_psychologist/logs/.gitkeep
touch bot_psychologist/logs/app/.gitkeep
touch bot_psychologist/logs/retrieval/.gitkeep
touch bot_psychologist/logs/error/.gitkeep
```


***

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (15 –º–∏–Ω)

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
cd bot_psychologist
python -m uvicorn api.main:app --reload --port 8000

# –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
# ======================================================================
# ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
#    –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ª–æ–≥–æ–≤: /path/to/bot_psychologist/logs
#    –û—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥: logs/app/bot.log
#    Retrieval –ª–æ–≥: logs/retrieval/retrieval.log
#    –õ–æ–≥ –æ—à–∏–±–æ–∫: logs/error/error.log
#    –•—Ä–∞–Ω–µ–Ω–∏–µ: 30 –¥–Ω–µ–π (app), 90 –¥–Ω–µ–π (error)
# ======================================================================
# üöÄ API –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
#    –í–µ—Ä—Å–∏—è: 1.0.0
#    –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://localhost:8000/docs

# 2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
curl -X POST http://localhost:8000/api/v1/questions/adaptive \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your-key" \
  -d '{"query": "—á—Ç–æ —Ç–∞–∫–æ–µ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å?", "user_id": "test_user"}'

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
tail -f logs/app/bot.log

# –û–∂–∏–¥–∞–µ—Ç—Å—è:
# 2026-02-10 17:00:01 | INFO     | api.main                            | ‚Üí POST /api/v1/questions/adaptive
# 2026-02-10 17:00:01 | INFO     | bot_agent.answer_adaptive           | [ADAPTIVE] –ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
# 2026-02-10 17:00:01 | INFO     | bot_agent.retriever                 | [RETRIEVAL] –°—Ç–∞—Ä—Ç retrieval
# ...

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å retrieval –ª–æ–≥
tail -f logs/retrieval/retrieval.log

# 5. –í—ã–∑–≤–∞—Ç—å –æ—à–∏–±–∫—É –¥–ª—è —Ç–µ—Å—Ç–∞ error.log
# (—Å–¥–µ–ª–∞—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å)

tail -f logs/error/error.log
```


### –ß–µ–∫-–ª–∏—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏

```
‚úÖ –ü–æ—è–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚úÖ –ö–æ–Ω—Å–æ–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ü–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥
‚úÖ logs/app/bot.log —Å–æ–∑–¥–∞–Ω –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–ø–∏—Å–∏
‚úÖ logs/retrieval/retrieval.log —Å–æ–∑–¥–∞–Ω
‚úÖ logs/error/error.log —Å–æ–∑–¥–∞–Ω
‚úÖ –ó–∞–ø—Ä–æ—Å—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è (‚Üí POST /path)
‚úÖ –û—Ç–≤–µ—Ç—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è (‚Üê POST /path | –°—Ç–∞—Ç—É—Å: 200)
‚úÖ –®–∞–≥–∏ retrieval –≤–∏–¥–Ω—ã
‚úÖ –û—à–∏–±–∫–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ error.log —Å–æ stack traces
‚úÖ –°—Ç–∞—Ä—ã–µ –ª–æ–≥–∏ —Ä–æ—Ç–∏—Ä—É—é—Ç—Å—è (—Ç–µ—Å—Ç: touch -t 202601010000 logs/app/bot.log)
```


***

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –§–∞–π–ª–æ–≤

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

```
bot_psychologist/
‚îú‚îÄ‚îÄ logging_config.py          ‚Üê –ù–û–í–´–ô (~160 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ logs/                       ‚Üê –ù–û–í–´–ô
‚îÇ   ‚îú‚îÄ‚îÄ .gitkeep
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ .gitkeep
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ bot.log            ‚Üê –°–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
‚îÇ   ‚îú‚îÄ‚îÄ retrieval/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ .gitkeep
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ retrieval.log      ‚Üê –°–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º retrieval
‚îÇ   ‚îî‚îÄ‚îÄ error/
‚îÇ       ‚îú‚îÄ‚îÄ .gitkeep
‚îÇ       ‚îî‚îÄ‚îÄ error.log          ‚Üê –°–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ
```


### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

```
bot_psychologist/
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îî‚îÄ‚îÄ main.py                ‚Üê –ò–∑–º–µ–Ω–µ–Ω (+50 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ bot_agent/
‚îÇ   ‚îú‚îÄ‚îÄ retriever.py           ‚Üê –ò–∑–º–µ–Ω–µ–Ω (+35 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ answer_adaptive.py     ‚Üê –ò–∑–º–µ–Ω–µ–Ω (+50 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ conversation_memory.py ‚Üê –ò–∑–º–µ–Ω–µ–Ω (+15 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îî‚îÄ‚îÄ semantic_memory.py     ‚Üê –ò–∑–º–µ–Ω–µ–Ω (+15 —Å—Ç—Ä–æ–∫)
‚îî‚îÄ‚îÄ .gitignore                 ‚Üê –ò–∑–º–µ–Ω–µ–Ω (+10 —Å—Ç—Ä–æ–∫)
```

**–í—Å–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**

- –ù–æ–≤–æ–µ: 160 —Å—Ç—Ä–æ–∫ (logging_config.py)
- –ò–∑–º–µ–Ω–µ–Ω–æ: 175 —Å—Ç—Ä–æ–∫ (6 —Ñ–∞–π–ª–æ–≤)
- **–ò—Ç–æ–≥–æ: 335 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞**

***

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ü—Ä–∏–µ–º–∫–∏

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ü—Ä–æ–π—Ç–∏

- [ ] ‚úÖ `logging_config.py` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è
- [ ] ‚úÖ `setup_logging()` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] ‚úÖ `logs/app/bot.log` —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- [ ] ‚úÖ `logs/retrieval/retrieval.log` —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ retrieval
- [ ] ‚úÖ `logs/error/error.log` —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–∏
- [ ] ‚úÖ –ö–æ–Ω—Å–æ–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ü–≤–µ—Ç–Ω—ã–µ –ª–æ–≥–∏
- [ ] ‚úÖ –§–∞–π–ª–æ–≤—ã–µ –ª–æ–≥–∏ –≤–∫–ª—é—á–∞—é—Ç timestamp, level, logger name, message
- [ ] ‚úÖ –†–æ—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (—Ñ–∞–π–ª—ã –∏–º–µ–Ω—É—é—Ç—Å—è `bot.log.YYYYMMDD`)
- [ ] ‚úÖ API –∑–∞–ø—Ä–æ—Å—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è (–≤—Ö–æ–¥—è—â–∏–µ + –∏—Å—Ö–æ–¥—è—â–∏–µ —Å latency)
- [ ] ‚úÖ –®–∞–≥–∏ retrieval –≤–∏–¥–Ω—ã –≤ –ª–æ–≥–∞—Ö
- [ ] ‚úÖ –†–∞–±–æ—Ç–∞ —Å –ø–∞–º—è—Ç—å—é –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è
- [ ] ‚úÖ –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å–æ stack traces
- [ ] ‚úÖ –ù–µ—Ç –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (<5% overhead)


### –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

```python
# –ü–æ—Å–ª–µ 1 –¥–Ω—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
{
    "logs_created": True,
    "log_entries_count": ">200",
    "retrieval_logs_count": ">50",
    "errors_caught": ">0",
    "debug_time_reduction": ">60%",
    "developer_satisfaction": "üòäüëç",
}
```


***

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –°—Ç–∞—Ä—Ç

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–≥–æ—Ç–æ–≤—ã –∫ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—é)

```bash
# 1. –°–æ–∑–¥–∞—Ç—å logging_config.py
cd bot_psychologist
cat > logging_config.py << 'EOF'
# ... (—Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∏–∑ –®–∞–≥–∞ 1 –≤—ã—à–µ)
EOF

# 2. –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ª–æ–≥–æ–≤
mkdir -p logs/app logs/retrieval logs/error
touch logs/.gitkeep logs/app/.gitkeep logs/retrieval/.gitkeep logs/error/.gitkeep

# 3. –û–±–Ω–æ–≤–∏—Ç—å .gitignore
cat >> .gitignore << 'EOF'
# –õ–æ–≥–∏
logs/*.log
logs/**/*.log
logs/**/*.log.*
!logs/.gitkeep
!logs/app/.gitkeep
!logs/retrieval/.gitkeep
!logs/error/.gitkeep
EOF

# 4. –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª—ã (–≤—Ä—É—á–Ω—É—é - —Å–º. —à–∞–≥–∏ 2-6 –≤—ã—à–µ)
# - api/main.py
# - bot_agent/retriever.py
# - bot_agent/answer_adaptive.py
# - bot_agent/conversation_memory.py
# - bot_agent/semantic_memory.py

# 5. –¢–µ—Å—Ç
python -m uvicorn api.main:app --reload --port 8000

# 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
tail -f logs/app/bot.log
tail -f logs/retrieval/retrieval.log
```


***

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π vs –ü–æ–ª–Ω—ã–π –ü–†–î

| –§—É–Ω–∫—Ü–∏—è | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ü–†–î | –ü–æ–ª–Ω—ã–π –ü–†–î |
| :-- | :-- | :-- |
| **–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏** | 3-4 —á–∞—Å–∞ | 4-6 –¥–Ω–µ–π |
| **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞** | ~335 | ~2000 |
| **–§–∞–π–ª–æ–≤—ã–µ –ª–æ–≥–∏** | app, retrieval, error | app, api, retrieval, memory, error, debug |
| **–†–æ—Ç–∞—Ü–∏—è** | –ï–∂–µ–¥–Ω–µ–≤–Ω–æ | –ï–∂–µ–¥–Ω–µ–≤–Ω–æ + –ü–æ —Ä–∞–∑–º–µ—Ä—É |
| **–í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å** | –¶–≤–µ—Ç–Ω–æ–π | –¶–≤–µ—Ç–Ω–æ–π + JSON |
| **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞** | ‚ùå | ‚úÖ user_id, session_id |
| **–õ–æ–≥–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** | ‚ùå | ‚úÖ Latency, –º–µ—Ç—Ä–∏–∫–∏ |
| **JSON —Ñ–æ—Ä–º–∞—Ç** | ‚ùå | ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ |
| **Debug –ª–æ–≥–≥–µ—Ä—ã** | ‚ùå | ‚úÖ retrieval, conversation, decision |
| **–°–∫—Ä–∏–ø—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞** | ‚ùå | ‚úÖ –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫, –∞–ª–µ—Ä—Ç—ã |
| **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** | –≠—Ç–æ—Ç –ü–†–î | –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è + runbook |


***

## üéØ –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏ (–ë—É–¥—É—â–µ–µ)

–ü–æ—Å–ª–µ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ –ª–æ–≥–∏–∫–∏ –±–æ—Ç–∞ (1-2 –Ω–µ–¥–µ–ª–∏), –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–æ –ø–æ–ª–Ω–æ–≥–æ –ü–†–î:

### –§–∞–∑–∞ 2 (–ü–æ–∑–∂–µ)

- JSON —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (user_id, session_id)
- –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- Debug –ª–æ–≥–≥–µ—Ä—ã (–æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã)


### –§–∞–∑–∞ 3 (–ë—É–¥—É—â–µ–µ)

- –°–∫—Ä–∏–ø—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞–ª–µ—Ä—Ç–æ–≤ (Slack/Telegram)
- –ê–≥—Ä–µ–≥–∞—Ü–∏—è –æ—à–∏–±–æ–∫
- Dashboard –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**–ù–æ –°–ï–ô–ß–ê–°:** –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏! üöÄ

***

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

**–í–æ–ø—Ä–æ—Å—ã?**

- –†–æ—Ç–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç? ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ `logs/`
- –õ–æ–≥–∏ –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è? ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `setup_logging()` –≤—ã–∑–≤–∞–Ω
- –û—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞? ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `sys.path.insert()`
- Retrieval –ª–æ–≥–∏ –ø—É—Å—Ç—ã? ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä –≤ retrieval_handler

**–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å?** –ö–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–¥ –∏ –≤–Ω–µ–¥—Ä—è–π—Ç–µ! –í—Å—ë –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

***

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
**–†–∞—Å—á–µ—Ç–Ω–æ–µ –≤—Ä–µ–º—è:** 3-4 —á–∞—Å–∞
**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π
**–í–ª–∏—è–Ω–∏–µ:** –í—ã—Å–æ–∫–æ–µ

üöÄ **–í–ü–ï–†–ï–î!**
<span style="display:none">[^1]</span>

<div align="center">‚ÅÇ</div>

[^1]: Minimal-PRD_-Production-Logging-Quick-Start.md

