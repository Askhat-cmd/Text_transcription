

# –¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –ó–ê–î–ê–ù–ò–ï –î–õ–Ø CURSOR AI AGENT

## üéØ –¶–ï–õ–¨

–î–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –±–∞–≥ –≤ retrieval —Å–∏—Å—Ç–µ–º–µ: –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∏—Å—Ç–æ—á–Ω–∏–∫/–±–ª–æ–∫ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞.

***

## üìã –û–ü–ò–°–ê–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´

### –°–∏–º–ø—Ç–æ–º—ã:

- ‚úÖ **OpenAI API —Ä–∞–±–æ—Ç–∞–µ—Ç** (403 –æ—à–∏–±–∫–∞ —Ä–µ—à–µ–Ω–∞ —á–µ—Ä–µ–∑ VPN)
- ‚úÖ **State Classification —Ä–∞–±–æ—Ç–∞–µ—Ç** (curious, confused –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)
- ‚ùå **Retrieval –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏**: –í—Å–µ —Ä–∞–∑–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ–ª—É—á–∞—é—Ç **–æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –±–ª–æ–∫**


### –ü—Ä–∏–º–µ—Ä—ã –∏–∑ –ª–æ–≥–æ–≤:

```
–í–æ–ø—Ä–æ—Å: "–ø—Ä–∏–≤–µ—Ç, –º–µ–Ω—è –∑–æ–≤—É—Ç –ê—Å—Ö–∞—Ç"
–ò—Å—Ç–æ—á–Ω–∏–∫: "–í–æ–ø—Ä–æ—Å—ã –∏ –∏—Ö –ø—Ä–∏—Ä–æ–¥–∞ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –æ—Å–æ–∑–Ω–∞–≤–∞–Ω–∏—è"

–í–æ–ø—Ä–æ—Å: "–ß—Ç–æ —Ç–∞–∫–æ–µ —Å–∞–º–æ–≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ?"
–ò—Å—Ç–æ—á–Ω–∏–∫: "–í–æ–ø—Ä–æ—Å—ã –∏ –∏—Ö –ø—Ä–∏—Ä–æ–¥–∞ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –æ—Å–æ–∑–Ω–∞–≤–∞–Ω–∏—è"

–í–æ–ø—Ä–æ—Å: "–ö–∞–∫ —Å—Ç–∞—Ç—å —É–≤–µ—Ä–µ–Ω–Ω—ã–º —á–µ–ª–æ–≤–µ–∫–æ–º?"
–ò—Å—Ç–æ—á–Ω–∏–∫: "–í–æ–ø—Ä–æ—Å—ã –∏ –∏—Ö –ø—Ä–∏—Ä–æ–¥–∞ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –æ—Å–æ–∑–Ω–∞–≤–∞–Ω–∏—è"

–í–æ–ø—Ä–æ—Å: "–∫–∞–∫ –º–µ–Ω—è –∑–æ–≤—É—Ç?"
–ò—Å—Ç–æ—á–Ω–∏–∫: "–í–æ–ø—Ä–æ—Å—ã –∏ –∏—Ö –ø—Ä–∏—Ä–æ–¥–∞ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –æ—Å–æ–∑–Ω–∞–≤–∞–Ω–∏—è"
```

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:** –†–∞–∑–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –±–ª–æ–∫–∏ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π (781 –±–ª–æ–∫ –¥–æ—Å—Ç—É–ø–µ–Ω).

***

## üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê: –®–ê–ì –ó–ê –®–ê–ì–û–ú

### –®–ê–ì 1: –í–∫–ª—é—á–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–§–∞–π–ª:** `bot_agent/answer_adaptive.py`

**–ù–∞–π—Ç–∏ —Ñ—É–Ω–∫—Ü–∏—é:** `answer_question_adaptive()`

**–î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –ü–û–°–õ–ï –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞ retrieval:**

```python
# –ü–æ—Å–ª–µ initial retrieval
logger.info(f"üîç [DEBUG] Initial retrieval: {len(blocks)} –±–ª–æ–∫–æ–≤")
for i, block in enumerate(blocks[:5]):
    logger.info(f"  [{i+1}] block_id={block.block_id}, score={block.score:.3f}, title={block.title[:50]}")

# –ü–æ—Å–ª–µ stage_filter (–µ—Å–ª–∏ –µ—Å—Ç—å)
logger.info(f"üîç [DEBUG] After stage filter: {len(blocks)} –±–ª–æ–∫–æ–≤")
for i, block in enumerate(blocks[:5]):
    logger.info(f"  [{i+1}] block_id={block.block_id}, title={block.title[:50]}")

# –ü–æ—Å–ª–µ confidence_cap (–µ—Å–ª–∏ –µ—Å—Ç—å)
logger.info(f"üîç [DEBUG] After confidence cap: {len(blocks)} –±–ª–æ–∫–æ–≤")
for i, block in enumerate(blocks[:5]):
    logger.info(f"  [{i+1}] block_id={block.block_id}, title={block.title[:50]}")

# –ü–µ—Ä–µ–¥ –ø–µ—Ä–µ–¥–∞—á–µ–π –≤ LLM
logger.info(f"üîç [DEBUG] Final blocks to LLM: {len(blocks)} –±–ª–æ–∫–æ–≤")
for i, block in enumerate(blocks):
    logger.info(f"  [{i+1}] block_id={block.block_id}, title={block.title[:50]}")
```


***

### –®–ê–ì 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å TF-IDF Retriever

**–§–∞–π–ª:** `bot_agent/retriever.py`

**–ù–∞–π—Ç–∏ —Ñ—É–Ω–∫—Ü–∏—é:** `retrieve(query: str, top_k: int)`

**–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏:**

```python
def retrieve(self, query: str, top_k: int = 10) -> List[Block]:
    logger.info(f"üîç [RETRIEVER] Query: '{query}', top_k={top_k}")
    
    # –ü–æ—Å–ª–µ TF-IDF –ø–æ–∏—Å–∫–∞
    results = self.tfidf_search(query, top_k)
    
    logger.info(f"üîç [RETRIEVER] TF-IDF –Ω–∞—à–µ–ª {len(results)} –±–ª–æ–∫–æ–≤:")
    for i, (block, score) in enumerate(results[:10]):
        logger.info(f"  [{i+1}] score={score:.4f}, block_id={block.block_id}, title={block.title[:60]}")
    
    return [block for block, score in results]
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–∏ TF-IDF —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –±–ª–æ–∫–∏ –∏–ª–∏ —É–∂–µ –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –¥—É–±–ª–∏?

***

### –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Stage Filter

**–§–∞–π–ª:** `bot_agent/retrieval/stage_filter.py`

**–ù–∞–π—Ç–∏ —Ñ—É–Ω–∫—Ü–∏—é:** `filter_blocks_by_state()`

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É:**

```python
def filter_blocks_by_state(blocks: List[Block], state_info: dict) -> List[Block]:
    state = state_info.get("primary_state", "curious")
    confidence = state_info.get("confidence", 0.5)
    
    logger.info(f"üîç [STAGE_FILTER] Input: {len(blocks)} –±–ª–æ–∫–æ–≤, state={state}, confidence={confidence}")
    
    # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —ç—Ç–∏ —É—Å–ª–æ–≤–∏—è
    if state == "curious":
        # –ú–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è?
        filtered = [b for b in blocks if b.complexity_score <= 0.7]
    elif state == "confused":
        filtered = [b for b in blocks if b.complexity_score <= 0.5]
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    
    logger.info(f"üîç [STAGE_FILTER] Output: {len(filtered)} –±–ª–æ–∫–æ–≤ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏")
    for i, block in enumerate(filtered[:5]):
        logger.info(f"  [{i+1}] complexity={block.complexity_score}, block_id={block.block_id}")
    
    return filtered
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**

- –ù–µ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ª–∏ –¥–æ 1 –±–ª–æ–∫–∞?
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ –æ–¥–Ω–∞ –∏ —Ç–∞ –∂–µ –ª–æ–≥–∏–∫–∞ –¥–ª—è –≤—Å–µ—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π?

***

### –®–ê–ì 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Confidence Cap

**–§–∞–π–ª:** `bot_agent/answer_adaptive.py`

**–ù–∞–π—Ç–∏ –∫–æ–¥ –æ–±—Ä–µ–∑–∫–∏ –±–ª–æ–∫–æ–≤:**

```python
# –ú–æ–∂–µ—Ç –±—ã—Ç—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:
confidence_cap = get_confidence_cap(state_confidence)
blocks = blocks[:confidence_cap]

# –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥:
logger.info(f"üîç [CONFIDENCE_CAP] –û–±—Ä–µ–∑–∞–µ–º –¥–æ {confidence_cap} –±–ª–æ–∫–æ–≤ (–±—ã–ª–æ {len(blocks)})")
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:** –ù–µ –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è –ª–∏ –¥–æ 1 –±–ª–æ–∫–∞ –ø—Ä–∏ –ª—é–±–æ–º confidence?

***

### –®–ê–ì 5: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ/–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

**–í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –†–µ–∑—É–ª—å—Ç–∞—Ç—ã retrieval –∫—ç—à–∏—Ä—É—é—Ç—Å—è –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è.

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**

1. `bot_agent/semantic_memory.py` - –µ—Å—Ç—å –ª–∏ –∫—ç—à —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤?
2. `bot_agent/retriever.py` - –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –ª–∏ TF-IDF –∏–Ω–¥–µ–∫—Å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏?
3. Session context - –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ª–∏ —Å—Ç–∞—Ä—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤–º–µ—Å—Ç–æ –Ω–æ–≤–æ–≥–æ?
```python
# –î–æ–±–∞–≤–∏—Ç—å –≤ –Ω–∞—á–∞–ª–æ retrieve():
logger.info(f"üîç [CACHE CHECK] Query hash: {hash(query)}, timestamp: {time.time()}")
```


***

### –®–ê–ì 6: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞

**–§–∞–π–ª:** `bot_agent/answer_adaptive.py`

**–ù–∞–π—Ç–∏ –∫–æ–¥ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è `metadata.sources`:**

```python
# –ì–¥–µ-—Ç–æ –µ—Å—Ç—å –∫–æ–¥ —Ç–∏–ø–∞:
sources = [
    {
        "block_id": block.block_id,
        "title": block.title,
        "youtube_link": block.youtube_link,
        # ...
    }
    for block in final_blocks
]

# –î–æ–±–∞–≤–∏—Ç—å:
logger.info(f"üîç [SOURCES] –§–æ—Ä–º–∏—Ä—É–µ–º {len(final_blocks)} –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:")
for i, block in enumerate(final_blocks):
    logger.info(f"  [{i+1}] block_id={block.block_id}, title={block.title[:60]}")
```


***

## üß™ –¢–ï–°–¢–û–í–´–ô –°–¶–ï–ù–ê–†–ò–ô

### –ó–∞–ø—É—Å—Ç–∏—Ç—å API —Å –Ω–æ–≤—ã–º–∏ –ª–æ–≥–∞–º–∏:

```bash
cd bot_psychologist
python -m uvicorn api.main:app --reload --port 8001 --log-level debug
```


### –°–¥–µ–ª–∞—Ç—å 3 —Ä–∞–∑–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–¥—Ä—è–¥:

**–ó–∞–ø—Ä–æ—Å 1:**

```json
POST http://localhost:8001/api/v1/questions/adaptive
{
  "question": "–ß—Ç–æ —Ç–∞–∫–æ–µ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å?",
  "user_id": "test_user_001",
  "session_id": "test_session_001",
  "debug": true
}
```

**–ó–∞–ø—Ä–æ—Å 2:**

```json
{
  "question": "–ö–∞–∫ —É–ª—É—á—à–∏—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å –ª—é–¥—å–º–∏?",
  "user_id": "test_user_001",
  "session_id": "test_session_001",
  "debug": true
}
```

**–ó–∞–ø—Ä–æ—Å 3:**

```json
{
  "question": "–ü–æ—á–µ–º—É —è —á—É–≤—Å—Ç–≤—É—é —Ç—Ä–µ–≤–æ–≥—É?",
  "user_id": "test_user_001",
  "session_id": "test_session_001",
  "debug": true
}
```


***

## üìä –û–ñ–ò–î–ê–ï–ú–´–ô –í–´–í–û–î

### –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–±—Ä–∞—Ç—å:

**1. –õ–æ–≥–∏ retrieval pipeline:**

```
üîç [RETRIEVER] Query: '–ß—Ç–æ —Ç–∞–∫–æ–µ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å?', top_k=10
üîç [RETRIEVER] TF-IDF –Ω–∞—à–µ–ª 10 –±–ª–æ–∫–æ–≤:
  [1] score=0.8234, block_id=block_042, title=–û—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å –∫–∞–∫ –ø—Ä–∞–∫—Ç–∏–∫–∞...
  [2] score=0.7891, block_id=block_156, title=–ú–µ–¥–∏—Ç–∞—Ü–∏—è –∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ...
  [3] score=0.7234, block_id=block_089, title=–í–Ω–∏–º–∞–Ω–∏–µ –∫ –Ω–∞—Å—Ç–æ—è—â–µ–º—É –º–æ–º–µ–Ω—Ç—É...
  ...

üîç [STAGE_FILTER] Input: 10 –±–ª–æ–∫–æ–≤, state=curious, confidence=0.70
üîç [STAGE_FILTER] Output: 5 –±–ª–æ–∫–æ–≤ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
  [1] complexity=0.6, block_id=block_042
  [2] complexity=0.5, block_id=block_156
  ...

üîç [CONFIDENCE_CAP] –û–±—Ä–µ–∑–∞–µ–º –¥–æ 3 –±–ª–æ–∫–æ–≤ (–±—ã–ª–æ 5)

üîç [SOURCES] –§–æ—Ä–º–∏—Ä—É–µ–º 3 –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:
  [1] block_id=block_042, title=–û—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å –∫–∞–∫ –ø—Ä–∞–∫—Ç–∏–∫–∞...
  [2] block_id=block_156, title=–ú–µ–¥–∏—Ç–∞—Ü–∏—è –∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ...
  [3] block_id=block_089, title=–í–Ω–∏–º–∞–Ω–∏–µ –∫ –Ω–∞—Å—Ç–æ—è—â–µ–º—É –º–æ–º–µ–Ω—Ç—É...
```

**2. JSON response —Å debug=true:**

```json
{
  "answer": "...",
  "metadata": {
    "retrieval_details": {
      "initial_retrieval": [...],
      "after_stage_filter": [...],
      "final_blocks": [...]
    },
    "sources": [
      {
        "block_id": "block_042",
        "title": "–û—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å –∫–∞–∫ –ø—Ä–∞–∫—Ç–∏–∫–∞...",
        "youtube_link": "..."
      }
    ]
  }
}
```


***

## üö® –ö–†–ò–¢–ò–ß–ù–´–ï –í–û–ü–†–û–°–´ –î–õ–Ø –ü–†–û–í–ï–†–ö–ò

1. **–ù–∞ –∫–∞–∫–æ–º —ç—Ç–∞–ø–µ —Ç–µ—Ä—è–µ—Ç—Å—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ –±–ª–æ–∫–æ–≤?**
    - TF-IDF —É–∂–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏?
    - Stage filter –æ–±—Ä–µ–∑–∞–µ—Ç –¥–æ 1 –±–ª–æ–∫–∞?
    - Confidence cap —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–π?
2. **–ï—Å—Ç—å –ª–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤?**
    - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å timestamps –≤ –ª–æ–≥–∞—Ö
    - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å hash –∑–∞–ø—Ä–æ—Å–æ–≤
3. **–ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç TF-IDF –∏–Ω–¥–µ–∫—Å?**
    - –ò–Ω–¥–µ–∫—Å —Å—Ç—Ä–æ–∏—Ç—Å—è –∏–∑ –≤—Å–µ—Ö 781 –±–ª–æ–∫–æ–≤?
    - –ù–µ—Ç –ª–∏ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏?
4. **–ù–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –ª–∏ –±–ª–æ–∫–∏ –≤ –ø–∞–º—è—Ç–∏?**
    - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å block_id –Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
    - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ list –Ω–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

***

## ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô –ß–ï–ö–õ–ò–°–¢

–ü–æ—Å–ª–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å:

- [ ] –õ–æ–≥–∏ –≤—Å–µ—Ö 3 —Ç–µ—Å—Ç–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —Å DEBUG –ª–æ–≥–∞–º–∏
- [ ] JSON responses —Å `debug=true` –¥–ª—è –≤—Å–µ—Ö 3 –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] –ê–Ω–∞–ª–∏–∑: –Ω–∞ –∫–∞–∫–æ–º —ç—Ç–∞–ø–µ —Ç–µ—Ä—è–µ—Ç—Å—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ
- [ ] –ö–æ–¥ –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ —É—á–∞—Å—Ç–∫–∞ (–µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω)
- [ ] –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

***

## üìÅ –§–ê–ô–õ–´ –î–õ–Ø –ü–†–û–í–ï–†–ö–ò (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É)

1. `bot_agent/answer_adaptive.py` - –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª orchestration
2. `bot_agent/retriever.py` - TF-IDF –ø–æ–∏—Å–∫
3. `bot_agent/retrieval/stage_filter.py` - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ state
4. `bot_agent/retrieval/confidence_cap.py` - –æ–±—Ä–µ–∑–∫–∞ –ø–æ confidence
5. `bot_agent/semantic_memory.py` - –∫—ç—à —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
6. `bot_agent/conversation_memory.py` - –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞

***

## üéØ –£–°–ü–ï–®–ù–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢

**–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞:** –¢—Ä–∏ —Ä–∞–∑–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Ç—Ä–∏ —Ä–∞–∑–Ω—ã—Ö –Ω–∞–±–æ—Ä–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:

```
–í–æ–ø—Ä–æ—Å 1: "–æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å" ‚Üí block_042, block_156, block_089
–í–æ–ø—Ä–æ—Å 2: "–æ—Ç–Ω–æ—à–µ–Ω–∏—è" ‚Üí block_234, block_567, block_123  
–í–æ–ø—Ä–æ—Å 3: "—Ç—Ä–µ–≤–æ–≥–∞" ‚Üí block_445, block_778, block_334
```

**–ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:** –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã ‚Üí –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ `block_id`

***

**Cursor AI, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞:**

1. –î–æ–±–∞–≤—å —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ª–æ–≥–∏
2. –ó–∞–ø—É—Å—Ç–∏ 3 —Ç–µ—Å—Ç–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–∞
3. –°–æ–±–µ—Ä–∏ –ª–æ–≥–∏ –∏ JSON responses
4. –ù–∞–π–¥–∏ —É–∑–∫–æ–µ –º–µ—Å—Ç–æ –≤ pipeline
5. –ü—Ä–µ–¥–ª–æ–∂–∏ fix

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–µ—Ä–µ–¥–∞–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.**

