

***

# üìã –ò–ù–°–¢–†–£–ö–¶–ò–Ø –î–õ–Ø CURSOR AI: –≠—Ç–∞–ø ‚Ññ3 ‚Äî CausalChainExtractor

## üéØ –¶–µ–ª—å

–°–æ–∑–¥–∞—Ç—å —ç–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä –ø—Ä–∏—á–∏–Ω–Ω–æ-—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ü–µ–ø–æ—á–µ–∫ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å–æ–∑–Ω–∞–Ω–∏—è –≤ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏ –°–∞–ª–∞–º–∞—Ç–∞ –°–∞—Ä—Å–µ–∫–µ–Ω–æ–≤–∞, –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å **SMART —Ä–µ–∂–∏–º–æ–º –≤–∞–ª–∏–¥–∞—Ü–∏–∏**.

***

## üìö –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞

### –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–≠—Ç–∞–ø—ã 1-2):

**1. TerminologyValidator** ‚Äî –§—É–Ω–¥–∞–º–µ–Ω—Ç —Å–∏—Å—Ç–µ–º—ã

- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 4 —Ä–µ–∂–∏–º–∞: `smart` (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π), `soft`, `strict`, `off`
- ‚úÖ **SMART —Ä–µ–∂–∏–º** (—Ç–µ–∫—É—â–∏–π):
    - –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–ª–æ—Ç–Ω–æ—Å—Ç—å: **15%** (vs 25% –≤ strict)
    - **Forbidden terms –ò–ì–ù–û–†–ò–†–£–Æ–¢–°–Ø** (–Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç —Ç–µ–∫—Å—Ç)
    - –§–∏–ª–æ—Å–æ—Ñ–∏—è: "–õ–µ–∫—Ç–æ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–º–µ—à–∞–Ω–Ω—É—é —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é, —É–º–Ω—ã–π –±–æ—Ç —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –Ω–∞ –≤—ã—Ö–æ–¥–µ"
- ‚úÖ –õ–µ–º–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ `pymorphy3` (—Ä–∞–±–æ—Ç–∞ —Å —Ä—É—Å—Å–∫–∏–º —è–∑—ã–∫–æ–º)
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π –°–∞—Ä—Å–µ–∫–µ–Ω–æ–≤–∞
- ‚úÖ –†–∞—Å—á—ë—Ç –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ —Ç–µ—Ä–º–∏–Ω–æ–≤

**2. NeurostalkingPatternExtractor** ‚Äî –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

- ‚úÖ 4 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤: —Ç—Ä–∏–∞–¥–∞_—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏, —Ä–∞–±–æ—Ç–∞_—Å_–≤–Ω–∏–º–∞–Ω–∏–µ–º, —Ä–∞–∑–æ—Ç–æ–∂–¥–µ—Å—Ç–≤–ª–µ–Ω–∏–µ, —Å–æ—Å—Ç–æ—è–Ω–∏—è_—Å–æ–∑–Ω–∞–Ω–∏—è
- ‚úÖ Rule-based –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ
- ‚úÖ –†–∞—Å—á—ë—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (confidence)
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å TerminologyValidator

***

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≠—Ç–∞–ø–∞ ‚Ññ3

### –§–∏–ª–æ—Å–æ—Ñ–∏—è CausalChainExtractor

**–ù–ï –ª–∏–Ω–µ–π–Ω–∞—è –ø—Ä–∏—á–∏–Ω–Ω–æ—Å—Ç—å** (A‚ÜíB‚ÜíC), **–ê –°–ò–°–¢–ï–ú–ù–ê–Ø —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è**:

- –ö–∞–∂–¥—ã–π —ç—Ç–∞–ø –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –∏–∑ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ (—ç–º–µ—Ä–¥–∂–µ–Ω—Ç–Ω–æ—Å—Ç—å)
- –≠—Ç–∞–ø—ã —Å–≤—è–∑–∞–Ω—ã —á–µ—Ä–µ–∑ `emerges_from` –∏ `enables`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö/—Å–ø–∏—Ä–∞–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- –ú–∞—Ä–∫–µ—Ä—ã —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã


### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (5 —Ç–∏–ø–æ–≤):

```python
PROCESS_CATEGORIES = {
    "—Ç—Ä–∏–∞–¥–∞_—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏": [
        "–º–µ—Ç–∞–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ", "–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ", "–æ—Å–æ–∑–Ω–∞–≤–∞–Ω–∏–µ", "—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è",
        "—á–∏—Å—Ç–æ–µ –æ—Å–æ–∑–Ω–∞–≤–∞–Ω–∏–µ", "—Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ–≤–∞–Ω–∏–µ"
    ],
    "—Ä–∞–±–æ—Ç–∞_—Å_–≤–Ω–∏–º–∞–Ω–∏–µ–º": [
        "–ø–æ–ª–µ –≤–Ω–∏–º–∞–Ω–∏—è", "—Å–≤–æ–±–æ–¥–Ω–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ", "–∑–∞—Ö–≤–∞—Ç –≤–Ω–∏–º–∞–Ω–∏—è",
        "—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ", "–ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ"
    ],
    "—Ä–∞–∑–æ—Ç–æ–∂–¥–µ—Å—Ç–≤–ª–µ–Ω–∏–µ": [
        "—Ä–∞–∑–æ—Ç–æ–∂–¥–µ—Å—Ç–≤–ª–µ–Ω–∏–µ", "–Ø-–æ–±—Ä–∞–∑", "–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è",
        "–ª–æ–∂–Ω–∞—è —Å–∞–º–æ—Å—Ç—å", "–∞–≤—Ç–æ–º–∞—Ç–∏–∑–º—ã –ø—Å–∏—Ö–∏–∫–∏"
    ],
    "–ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ_—Å–æ–∑–Ω–∞–Ω–∏—è": [
        "–ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ", "—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è", "–ø—Ä–æ–∑—Ä–µ–Ω–∏–µ", "—è—Å–Ω–æ—Å—Ç—å",
        "–∂–∏–≤–æ–µ –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏–µ", "–±—ã—Ç–∏–µ"
    ],
    "–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è_—Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏": [
        "–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è", "—Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å", "—Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å",
        "–≥–æ–º–µ–æ—Å—Ç–∞–∑", "—ç–º–µ—Ä–¥–∂–µ–Ω—Ç–Ω–æ—Å—Ç—å", "–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ–ø—ã—Ç–∞"
    ]
}
```


***

## üìù –®–ê–ì 1: –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ `causal_chain_extractor.py`

### –ü—É—Ç—å: `text_processor/extractors/causal_chain_extractor.py`

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:

```python
@dataclass
class InterventionPoint:
    """–¢–æ—á–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å"""
    at_stage: int                    # –ù–∞ –∫–∞–∫–æ–º —ç—Ç–∞–ø–µ
    practice: str                    # –ö–∞–∫–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è
    triggers: List[str]              # –ß—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∞–∫—Ç–∏–∫—É
    expected_outcome: str            # –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

@dataclass
class CausalChainStage:
    """–≠—Ç–∞–ø –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏"""
    stage: int                       # –ù–æ–º–µ—Ä —ç—Ç–∞–ø–∞
    stage_name: str                  # –ù–∞–∑–≤–∞–Ω–∏–µ (–∏–∑ —Ç–µ—Ä–º–∏–Ω–æ–≤)
    description: str                 # –û–ø–∏—Å–∞–Ω–∏–µ (–∏–∑ —Ç–µ–∫—Å—Ç–∞)
    sarsekenov_terms: List[str]      # –¢–µ—Ä–º–∏–Ω—ã –°–∞—Ä—Å–µ–∫–µ–Ω–æ–≤–∞
    # –°–ò–°–¢–ï–ú–ù–´–ï —Å–≤—è–∑–∏ (–Ω–µ –ª–∏–Ω–µ–π–Ω—ã–µ):
    emerges_from: Optional[List[int]]  # –ò–∑ –∫–∞–∫–∏—Ö —ç—Ç–∞–ø–æ–≤ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç
    enables: Optional[List[int]]       # –ö–∞–∫–∏–µ —ç—Ç–∞–ø—ã –¥–µ–ª–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã–º–∏

@dataclass
class CausalChain:
    """–ü—Ä–∏—á–∏–Ω–Ω–æ-—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ (—Å–∏—Å—Ç–µ–º–Ω–∞—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è)"""
    process_name: str                # –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞
    process_category: str            # –ö–∞—Ç–µ–≥–æ—Ä–∏—è (–∏–∑ 5 —Ç–∏–ø–æ–≤)
    stages: List[CausalChainStage]   # –≠—Ç–∞–ø—ã –ø—Ä–æ—Ü–µ—Å—Å–∞
    intervention_points: List[InterventionPoint]
    context: str                     # –ö–æ–Ω—Ç–µ–∫—Å—Ç (200 —Å–∏–º–≤–æ–ª–æ–≤)
    source_quote: str                # –ò—Å—Ö–æ–¥–Ω–∞—è —Ü–∏—Ç–∞—Ç–∞
    confidence: float                # –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å (0.0-1.0)
    
    # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º–Ω–æ—Å—Ç–∏:
    is_cyclical: bool = False        # –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å?
    wholeness_markers: List[str] = None  # –ú–∞—Ä–∫–µ—Ä—ã —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
    sarsekenov_density: float = 0.0  # –ü–ª–æ—Ç–Ω–æ—Å—Ç—å —Ç–µ—Ä–º–∏–Ω–æ–≤
```


***

## üìù –®–ê–ì 2: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞—Å—Å–∞ `CausalChainExtractor`

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:

```python
class CausalChainExtractor:
    """
    –§–ò–õ–û–°–û–§–ò–Ø SMART –†–ï–ñ–ò–ú–ê:
    ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    1. Forbidden terms –ù–ï –±–ª–æ–∫–∏—Ä—É—é—Ç —Ç–µ–∫—Å—Ç
    2. –ú–∏–Ω–∏–º—É–º 15% –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ (–Ω–µ 25%)
    3. –§–æ–∫—É—Å –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω–æ—Å—Ç–∏, –Ω–µ –ª–∏–Ω–µ–π–Ω–æ—Å—Ç–∏
    4. LLM –Ω–∞ –≤—ã—Ö–æ–¥–µ —Å–∞–º —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Å—Ç–∏–ª—å
    ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    """
    
    MIN_SARSEKENOV_TERMS = 3  # –ú–∏–Ω–∏–º—É–º —Ç–µ—Ä–º–∏–Ω–æ–≤ –≤ —Ü–µ–ø–æ—á–∫–µ
    
    def __init__(
        self,
        terminology_validator: Optional[TerminologyValidator] = None,
        use_llm: bool = False,
        llm_client: Optional[Any] = None
    ):
        self.validator = terminology_validator or TerminologyValidator()
        self.use_llm = use_llm
        self.llm_client = llm_client
        self._load_sarsekenov_terms()
```


### –ì–ª–∞–≤–Ω—ã–π –º–µ—Ç–æ–¥ `extract()`:

```python
def extract(
    self,
    text: str,
    specific_category: Optional[str] = None,
    min_stages: int = 2,
    max_stages: int = 10
) -> Dict[str, Any]:
    """
    –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∏—á–∏–Ω–Ω–æ-—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ü–µ–ø–æ—á–µ–∫.
    
    Returns:
        {
            "valid": bool,
            "reason": str,
            "chains": List[Dict],  # –°–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ CausalChain
            "metrics": Dict
        }
    """
    
    # 1. –í–ê–õ–ò–î–ê–¶–ò–Ø —á–µ—Ä–µ–∑ TerminologyValidator (SMART —Ä–µ–∂–∏–º)
    validation = self.validator.validate_text(text)
    
    if not validation.is_valid:
        return {
            "valid": False,
            "reason": validation.reason,
            "chains": [],
            "metrics": validation.metrics
        }
    
    # 2. –ò–ó–í–õ–ï–ß–ï–ù–ò–ï —Ü–µ–ø–æ—á–µ–∫ (rule-based –∏–ª–∏ LLM)
    if self.use_llm and self.llm_client:
        chains = self._extract_with_llm(...)
    else:
        chains = self._extract_rule_based(...)
    
    # 3. –í–ê–õ–ò–î–ê–¶–ò–Ø –∫–∞–∂–¥–æ–π —Ü–µ–ø–æ—á–∫–∏
    validated_chains = [c for c in chains if self._validate_chain(c)]
    
    return {
        "valid": True,
        "reason": f"–ò–∑–≤–ª–µ—á–µ–Ω–æ {len(validated_chains)} —Ü–µ–ø–æ—á–µ–∫",
        "chains": [asdict(c) for c in validated_chains],
        "metrics": {
            "density": validation.metrics['density'],
            "total_chains": len(validated_chains),
            "categories": list(set(c.process_category for c in validated_chains))
        }
    }
```


***

## üìù –®–ê–ì 3: Rule-based –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ

### –ê–ª–≥–æ—Ä–∏—Ç–º `_extract_rule_based()`:

```python
def _extract_rule_based(
    self,
    text: str,
    entities: List[str],
    specific_category: Optional[str],
    min_stages: int,
    max_stages: int
) -> List[CausalChain]:
    """
    Rule-based –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ü–µ–ø–æ—á–µ–∫.
    
    –ê–ª–≥–æ—Ä–∏—Ç–º:
    1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ —Ç–µ–∫—Å—Ç–µ
    2. –†–∞–∑–±–∏—Ç—å –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
    3. –ù–∞–π—Ç–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    4. –ü–æ—Å—Ç—Ä–æ–∏—Ç—å —ç—Ç–∞–ø—ã –ø—Ä–æ—Ü–µ—Å—Å–∞
    5. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–æ—á–∫–∏ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞
    6. –°–æ–∑–¥–∞—Ç—å —Ü–µ–ø–æ—á–∫—É
    """
    chains = []
    
    # 1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    relevant_categories = self._identify_categories(entities, specific_category)
    
    # 2. –†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
    sentences = self._split_sentences(text)
    
    for category in relevant_categories:
        # 3. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        category_sentences = self._filter_by_category(sentences, category)
        
        if len(category_sentences) < min_stages:
            continue
        
        # 4. –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ü–µ–ø–æ—á–∫–∏
        chain = self._build_chain_from_sentences(
            category_sentences[:max_stages],
            category,
            text
        )
        
        if chain and len(chain.stages) >= min_stages:
            chains.append(chain)
    
    return chains
```


### –ö–ª—é—á–µ–≤—ã–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã:

```python
def _identify_categories(entities, specific_category):
    """–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–º–∏–Ω–∏–º—É–º 2 —Ç–µ—Ä–º–∏–Ω–∞)"""

def _split_sentences(text):
    """–†–∞–∑–±–∏—Ç—å —Ç–µ–∫—Å—Ç –ø–æ [.!?]"""

def _filter_by_category(sentences, category):
    """–û—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Å —Ç–µ—Ä–º–∏–Ω–∞–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"""

def _build_chain_from_sentences(sentences, category, full_text):
    """
    –ü–æ—Å—Ç—Ä–æ–∏—Ç—å CausalChain:
    - –°–æ–∑–¥–∞—Ç—å stages –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
    - –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å emerges_from/enables (—Å–∏—Å—Ç–µ–º–Ω–æ—Å—Ç—å)
    - –ù–∞–π—Ç–∏ intervention_points
    - –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å is_cyclical
    - –ò–∑–≤–ª–µ—á—å wholeness_markers
    """

def _calculate_confidence(stages, all_terms):
    """
    –†–∞—Å—á—ë—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏:
    - –ë–∞–∑–æ–≤–∞—è: 0.5
    - +0.05 –∑–∞ –∫–∞–∂–¥—ã–π —ç—Ç–∞–ø (–º–∞–∫—Å 0.2)
    - +0.02 –∑–∞ –∫–∞–∂–¥—ã–π —Ç–µ—Ä–º–∏–Ω (–º–∞–∫—Å 0.2)
    - +0.05 –∑–∞ –∫–∞–∂–¥—É—é —Å–∏—Å—Ç–µ–º–Ω—É—é —Å–≤—è–∑—å (–º–∞–∫—Å 0.1)
    """

def _detect_cyclical(sentences):
    """–ü–æ–∏—Å–∫ –º–∞—Ä–∫–µ—Ä–æ–≤: "—Å–Ω–æ–≤–∞", "–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è", "—Å–ø–∏—Ä–∞–ª—å", "—Ü–∏–∫–ª" """

def _extract_wholeness_markers(sentences):
    """–ü–æ–∏—Å–∫: "—Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å", "–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è", "—ç–º–µ—Ä–¥–∂–µ–Ω—Ç–Ω–æ—Å—Ç—å" """
```


***

## üìù –®–ê–ì 4: –í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–µ–ø–æ—á–∫–∏

```python
def _validate_chain(self, chain: CausalChain) -> bool:
    """
    –í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–µ–ø–æ—á–∫–∏:
    1. –ú–∏–Ω–∏–º—É–º 3 —Ç–µ—Ä–º–∏–Ω–∞ –°–∞—Ä—Å–µ–∫–µ–Ω–æ–≤–∞
    2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ù–ï –ù–£–ñ–ù–ê –¥–ª—è forbidden terms (SMART —Ä–µ–∂–∏–º)
    """
    all_terms = []
    for stage in chain.stages:
        all_terms.extend(stage.sarsekenov_terms)
    
    return len(all_terms) >= self.MIN_SARSEKENOV_TERMS
```


***

## üìù –®–ê–ì 5: Utility —Ñ—É–Ω–∫—Ü–∏—è

```python
def extract_causal_chains(
    text: str,
    specific_category: Optional[str] = None,
    min_stages: int = 2,
    max_stages: int = 10,
    use_llm: bool = False
) -> Dict[str, Any]:
    """–ë—ã—Å—Ç—Ä–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ü–µ–ø–æ—á–µ–∫"""
    extractor = CausalChainExtractor(use_llm=use_llm)
    return extractor.extract(text, specific_category, min_stages, max_stages)
```


***

## üìù –®–ê–ì 6: –§–∞–π–ª —Ç–µ—Å—Ç–æ–≤

### –ü—É—Ç—å: `tests/extractors/test_causal_chain_extractor.py`

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Ç–µ—Å—Ç—ã:

```python
def test_extract_triada_transformation_chain():
    """–¢—Ä–∏–∞–¥–∞: –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ ‚Üí –æ—Å–æ–∑–Ω–∞–≤–∞–Ω–∏–µ ‚Üí —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è"""

def test_extract_attention_work_chain():
    """–†–∞–±–æ—Ç–∞ —Å –≤–Ω–∏–º–∞–Ω–∏–µ–º"""

def test_low_density_rejected():
    """–ù–∏–∑–∫–∞—è –ø–ª–æ—Ç–Ω–æ—Å—Ç—å (<15%) –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è"""

def test_forbidden_terms_NOT_rejected_in_smart_mode():
    """
    –ö–†–ò–¢–ò–ß–ù–û: –í SMART —Ä–µ–∂–∏–º–µ forbidden terms –ù–ï –±–ª–æ–∫–∏—Ä—É—é—Ç!
    """
    text = '''
    –ö–æ–≥–¥–∞ —á–µ–ª–æ–≤–µ–∫ –≥–æ–≤–æ—Ä–∏—Ç –æ–± —ç–≥–æ –∏ –º–µ–¥–∏—Ç–∞—Ü–∏–∏, —è –æ–±—ä—è—Å–Ω—è—é:
    —ç—Ç–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –Ø-–æ–±—Ä–∞–∑ –∏ –º–µ—Ç–∞–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ. –†–∞–∑–æ—Ç–æ–∂–¥–µ—Å—Ç–≤–ª–µ–Ω–∏–µ
    —Å –Ø-–æ–±—Ä–∞–∑–æ–º –≤–µ–¥—ë—Ç –∫ —á–∏—Å—Ç–æ–º—É –æ—Å–æ–∑–Ω–∞–≤–∞–Ω–∏—é.
    '''
    result = extractor.extract(text)
    # –î–æ–ª–∂–Ω–æ –ü–†–û–ô–¢–ò (–ø–ª–æ—Ç–Ω–æ—Å—Ç—å ~30%, —Ä–µ–∂–∏–º smart)
    assert result['valid'] is True

def test_intervention_points_identified():
    """–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–æ—á–µ–∫ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞"""

def test_cyclical_process_detection():
    """–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–∏–∫–ª–∏—á–Ω–æ—Å—Ç–∏ (–º–∞—Ä–∫–µ—Ä—ã: "—Å–Ω–æ–≤–∞", "—Å–ø–∏—Ä–∞–ª—å")"""

def test_wholeness_markers_extraction():
    """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ: "—Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å", "–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è", "—ç–º–µ—Ä–¥–∂–µ–Ω—Ç–Ω–æ—Å—Ç—å" """

def test_systemic_relationships():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ emerges_from –∏ enables –≤ stages"""

def test_confidence_calculation():
    """–†–∞—Å—á—ë—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (5+ —ç—Ç–∞–ø–æ–≤, 8+ —Ç–µ—Ä–º–∏–Ω–æ–≤ ‚Üí >0.7)"""

def test_multiple_categories_in_text():
    """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑ –æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞"""

def test_minimum_sarsekenov_terms_requirement():
    """–ú–∏–Ω–∏–º—É–º 3 —Ç–µ—Ä–º–∏–Ω–∞ –°–∞—Ä—Å–µ–∫–µ–Ω–æ–≤–∞ –Ω–∞ —Ü–µ–ø–æ—á–∫—É"""
```


***

## üìù –®–ê–ì 7: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å TerminologyValidator

### –ö—Ä–∏—Ç–∏—á–Ω–æ: SMART —Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

```python
# –í extract():
validation = self.validator.validate_text(text)
# –ù–ï —É–∫–∞–∑—ã–≤–∞–µ–º min_density - –±–µ—Ä—ë—Ç—Å—è –∏–∑ .env:
# MIN_SARSEKENOV_DENSITY_SMART=0.15 (–Ω–µ 0.25!)

# Forbidden terms –ù–ï –±–ª–æ–∫–∏—Ä—É—é—Ç –≤ SMART —Ä–µ–∂–∏–º–µ
# –û–Ω–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ validation.forbidden_terms_found –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```


***

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- [x] –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `text_processor/extractors/causal_chain_extractor.py`
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã dataclasses: InterventionPoint, CausalChainStage, CausalChain
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–ª–∞—Å—Å CausalChainExtractor
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `extract()` —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω `_extract_rule_based()` —Å 5 –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–≤—è–∑–∏ (emerges_from, enables)
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–∏–∫–ª–∏—á–Ω–æ—Å—Ç–∏
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ wholeness_markers
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω `_validate_chain()` (–º–∏–Ω–∏–º—É–º 3 —Ç–µ—Ä–º–∏–Ω–∞)
- [x] –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/extractors/test_causal_chain_extractor.py`
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ 14+ —Ç–µ—Å—Ç–æ–≤ (–≤–∫–ª—é—á–∞—è —Ç–µ—Å—Ç SMART —Ä–µ–∂–∏–º–∞)
- [x] –û–±–Ω–æ–≤–ª—ë–Ω `__init__.py` —Å —ç–∫—Å–ø–æ—Ä—Ç–æ–º –Ω–æ–≤—ã—Ö –∫–ª–∞—Å—Å–æ–≤
- [x] –û–±–Ω–æ–≤–ª—ë–Ω `EXTRACTORS_DEVELOPMENT_REPORT.md`
- [ ] **–ó–ê–ü–£–°–¢–ò–¢–¨ –¢–ï–°–¢–´** (—Å–º. –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –Ω–∏–∂–µ)

***

## üö® –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1. SMART —Ä–µ–∂–∏–º –≤–∞–ª–∏–¥–∞—Ü–∏–∏:

- ‚úÖ –ú–∏–Ω–∏–º—É–º **15%** –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ (–Ω–µ 25%)
- ‚úÖ Forbidden terms **–ù–ï –±–ª–æ–∫–∏—Ä—É—é—Ç** —Ç–µ–∫—Å—Ç
- ‚úÖ –í–∞–ª–∏–¥–∞—Ç–æ—Ä –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ë–ï–ó –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `min_density` (–±–µ—Ä—ë—Ç—Å—è –∏–∑ .env)


### 2. –°–∏—Å—Ç–µ–º–Ω–æ—Å—Ç—å (–Ω–µ –ª–∏–Ω–µ–π–Ω–æ—Å—Ç—å):

- ‚úÖ –≠—Ç–∞–ø—ã —Å–≤—è–∑–∞–Ω—ã —á–µ—Ä–µ–∑ `emerges_from` –∏ `enables`
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- ‚úÖ –ú–∞—Ä–∫–µ—Ä—ã —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏


### 3. –ú–∏–Ω–∏–º—É–º 3 —Ç–µ—Ä–º–∏–Ω–∞ –°–∞—Ä—Å–µ–∫–µ–Ω–æ–≤–∞ –Ω–∞ —Ü–µ–ø–æ—á–∫—É

### 4. Utility —Ñ—É–Ω–∫—Ü–∏—è `extract_causal_chains()`


***

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–£–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ:

```
pymorphy3>=1.0.0
python-dotenv>=1.0.0
```


***

## üéØ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```python
from text_processor.extractors import CausalChainExtractor, extract_causal_chains

text = """
–ö–æ–≥–¥–∞ –ò—â—É—â–∏–π –ø—Ä–∞–∫—Ç–∏–∫—É–µ—Ç –º–µ—Ç–∞–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ, –æ–Ω —Å–Ω–∞—á–∞–ª–∞ –Ω–∞–±–ª—é–¥–∞–µ—Ç 
–∑–∞ –º—ã—Å–ª–∏—Ç–µ–ª—å–Ω—ã–º –ø–æ—Ç–æ–∫–æ–º. –ó–∞—Ç–µ–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—Å–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–º–æ–≤ 
–ø—Å–∏—Ö–∏–∫–∏. –≠—Ç–æ –≤–µ–¥–µ—Ç –∫ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ —Ä–∞–∑–æ—Ç–æ–∂–¥–µ—Å—Ç–≤–ª–µ–Ω–∏–µ —Å –Ø-–æ–±—Ä–∞–∑–æ–º.
–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç —á–∏—Å—Ç–æ–µ –æ—Å–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∏ —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ.
"""

# –ë—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–±:
result = extract_causal_chains(text, specific_category="—Ç—Ä–∏–∞–¥–∞_—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏")

print(f"–í–∞–ª–∏–¥–µ–Ω: {result['valid']}")
print(f"–¶–µ–ø–æ—á–µ–∫: {len(result['chains'])}")
for chain in result['chains']:
    print(f"  - {chain['process_category']}: {chain['process_name']}")
    print(f"    –≠—Ç–∞–ø–æ–≤: {len(chain['stages'])}, –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {chain['confidence']:.2f}")
```


***

## üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```powershell
# –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd c:\My_practice\Text_transcription\voice_bot_pipeline

# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
.\.venv\Scripts\Activate.ps1

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç
python tests/extractors/run_causal_chain_tests.py

# –ò–ª–∏ –ø–æ–ª–Ω—ã–π pytest
python -m pytest tests/extractors/test_causal_chain_extractor.py -v
```

***

## üìä –°—Ç–∞—Ç—É—Å: –≠–¢–ê–ü 3 –ó–ê–í–ï–†–®–Å–ù ‚úÖ

**–î–∞—Ç–∞:** 2024-12-08

**–°–æ–∑–¥–∞–Ω–æ:**
- `text_processor/extractors/causal_chain_extractor.py` ‚Äî –ü–æ–ª–Ω—ã–π —ç–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä
- `tests/extractors/test_causal_chain_extractor.py` ‚Äî 14+ —Ç–µ—Å—Ç–æ–≤
- `tests/extractors/run_causal_chain_tests.py` ‚Äî –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:**
- `text_processor/extractors/__init__.py` ‚Äî –≠–∫—Å–ø–æ—Ä—Ç –Ω–æ–≤—ã—Ö –∫–ª–∞—Å—Å–æ–≤
- `EXTRACTORS_DEVELOPMENT_REPORT.md` ‚Äî –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

***

–≠—Ç–æ –ø–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è Cursor AI —Å —É—á—ë—Ç–æ–º –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ SMART —Ä–µ–∂–∏–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏!

