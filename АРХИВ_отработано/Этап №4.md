<img src="https://r2cdn.perplexity.ai/pplx-full-logo-primary-dark%402x.png" style="height:64px;margin-right:32px"/>

# –û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π –ø—Ä–∏—Å—Ç—É–ø–∏–º –∫ —ç—Ç–∞–ø—É ‚Ññ4

–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–º –ø–æ–ª–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –¥–ª—è **–≠—Ç–∞–ø–∞ ‚Ññ4: ConceptHierarchyExtractor**.

***

# üìã –ò–ù–°–¢–†–£–ö–¶–ò–Ø –î–õ–Ø CURSOR AI: –≠—Ç–∞–ø ‚Ññ4 ‚Äî ConceptHierarchyExtractor

## üéØ –¶–µ–ª—å

–°–æ–∑–¥–∞—Ç—å —ç–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä **–∏–µ—Ä–∞—Ä—Ö–∏–∏ –∫–æ–Ω—Ü–µ–ø—Ç–æ–≤** —É—á–µ–Ω–∏—è –°–∞–ª–∞–º–∞—Ç–∞ –°–∞—Ä—Å–µ–∫–µ–Ω–æ–≤–∞ —Å–æ —Å—Ç—Ä–æ–≥–æ–π 5-—É—Ä–æ–≤–Ω–µ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π, –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å **SMART —Ä–µ–∂–∏–º–æ–º –≤–∞–ª–∏–¥–∞—Ü–∏–∏**.

***

## üìö –ö–æ–Ω—Ç–µ–∫—Å—Ç: –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–≠—Ç–∞–ø—ã 1-3)

‚úÖ **–≠—Ç–∞–ø ‚Ññ1:** TerminologyValidator (SMART —Ä–µ–∂–∏–º: 15% –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏, forbidden –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è)
‚úÖ **–≠—Ç–∞–ø ‚Ññ2:** NeurostalkingPatternExtractor (4 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤)
‚úÖ **–≠—Ç–∞–ø ‚Ññ3:** CausalChainExtractor (—Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ü–µ–ø–æ—á–∫–∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏)

***

## üèóÔ∏è –§–∏–ª–æ—Å–æ—Ñ–∏—è –≠—Ç–∞–ø–∞ ‚Ññ4

### –ß—Ç–æ —Ç–∞–∫–æ–µ "–∏–µ—Ä–∞—Ä—Ö–∏—è –∫–æ–Ω—Ü–µ–ø—Ç–æ–≤"?

**–ê–Ω–∞–ª–æ–≥–∏—è:** –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–ø–∞–Ω–∏–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  CEO (Root)         [–Ω–µ–π—Ä–æ-—Å—Ç–∞–ª–∫–∏–Ω–≥]    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ –û—Ç–¥–µ–ª—ã (Domains)                   ‚îÇ
‚îÇ      ‚îú‚îÄ‚îÄ HR  [—Ä–∞–±–æ—Ç–∞ —Å –≤–Ω–∏–º–∞–Ω–∏–µ–º]       ‚îÇ
‚îÇ      ‚îî‚îÄ‚îÄ IT  [—Ä–∞–∑–æ—Ç–æ–∂–¥–µ—Å—Ç–≤–ª–µ–Ω–∏–µ]        ‚îÇ
‚îÇ          ‚îî‚îÄ‚îÄ –ü—Ä–æ—Ü–µ—Å—Å—ã (Practices)       ‚îÇ
‚îÇ              ‚îú‚îÄ‚îÄ –ù–∞–π–º [–º–µ—Ç–∞–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ]  ‚îÇ
‚îÇ              ‚îî‚îÄ‚îÄ –û–±—É—á–µ–Ω–∏–µ               ‚îÇ
‚îÇ                  ‚îî‚îÄ‚îÄ –ú–µ—Ç–æ–¥–∏–∫–∏ (Techniques)‚îÇ
‚îÇ                      ‚îî‚îÄ‚îÄ –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è (Exercises)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–í —É—á–µ–Ω–∏–∏ –°–∞—Ä—Å–µ–∫–µ–Ω–æ–≤–∞:** –°—Ç—Ä–æ–≥–∞—è 5-—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç –∫–æ—Ä–Ω–µ–≤—ã—Ö –∫–æ–Ω—Ü–µ–ø—Ç–æ–≤ –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π.

***

## üìä 5-—É—Ä–æ–≤–Ω–µ–≤–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è –°–∞—Ä—Å–µ–∫–µ–Ω–æ–≤–∞

### –£—Ä–æ–≤–µ–Ω—å 1: ROOT (–ö–æ—Ä–µ–Ω—å —É—á–µ–Ω–∏—è)

```python
# –ú–æ–∂–µ—Ç –±—ã—Ç—å –¢–û–õ–¨–ö–û –æ–¥–∏–Ω –∏–∑ —Ç—Ä—ë—Ö:
ROOT_CONCEPTS = [
    "–Ω–µ–π—Ä–æ-—Å—Ç–∞–ª–∫–∏–Ω–≥",  # –û—Å–Ω–æ–≤–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
    "–Ω–µ–æ-—Å—Ç–∞–ª–∫–∏–Ω–≥",    # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
    "—Å—Ç–∞–ª–∫–∏–Ω–≥ —É–º–∞"     # –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
]
```

**–ü—Ä–∏–º–µ—Ä –∏–∑ —Ç–µ–∫—Å—Ç–∞:**
> "–ù–µ–π—Ä–æ-—Å—Ç–∞–ª–∫–∏–Ω–≥ ‚Äî —ç—Ç–æ –ø—Ä–∞–∫—Ç–∏–∫–∞ –ø—Ä—è–º–æ–≥–æ –æ—Å–æ–∑–Ω–∞–≤–∞–Ω–∏—è..."

***

### –£—Ä–æ–≤–µ–Ω—å 2: DOMAIN (–î–æ–º–µ–Ω–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏)

```python
# –û—Å–Ω–æ–≤–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏ —É—á–µ–Ω–∏—è
DOMAIN_CONCEPTS = [
    "–ø–æ–ª–µ –≤–Ω–∏–º–∞–Ω–∏—è",
    "–ø–æ–ª–µ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è",
    "—á–∏—Å—Ç–æ–µ –æ—Å–æ–∑–Ω–∞–≤–∞–Ω–∏–µ",
    "–∂–∏–≤–æ–µ –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏–µ",
    "–Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ–µ –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ",
    "–ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ",
    "–Ω–∞–±–ª—é–¥–∞—é—â–µ–µ —Å–æ–∑–Ω–∞–Ω–∏–µ"
]
```

**–°–≤—è–∑—å:** `is_core_component_of` ‚Üí ROOT
**–ü—Ä–∏–º–µ—Ä:** "–ü–æ–ª–µ –≤–Ω–∏–º–∞–Ω–∏—è ‚Äî —ç—Ç–æ core component –Ω–µ–π—Ä–æ-—Å—Ç–∞–ª–∫–∏–Ω–≥–∞"

***

### –£—Ä–æ–≤–µ–Ω—å 3: PRACTICE (–ü—Ä–∞–∫—Ç–∏–∫–∏)

```python
# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏
PRACTICE_CONCEPTS = [
    "–º–µ—Ç–∞–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ",
    "—Ä–∞–∑–æ—Ç–æ–∂–¥–µ—Å—Ç–≤–ª–µ–Ω–∏–µ",
    "—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–∏",
    "—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ",
    "–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ–ø—ã—Ç–∞",
    "–ø—Ä–æ–∑—Ä–µ–Ω–∏–µ",
    "–ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ —Å–æ–∑–Ω–∞–Ω–∏—è"
]
```

**–°–≤—è–∑—å:** `is_practice_for` ‚Üí DOMAIN
**–ü—Ä–∏–º–µ—Ä:** "–ú–µ—Ç–∞–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –ø—Ä–∞–∫—Ç–∏–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª–µ–º –≤–Ω–∏–º–∞–Ω–∏—è"

***

### –£—Ä–æ–≤–µ–Ω—å 4: TECHNIQUE (–¢–µ—Ö–Ω–∏–∫–∏/–ú–µ—Ç–æ–¥–∏–∫–∏)

```python
# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∞–∫—Ç–∏–∫
TECHNIQUE_CONCEPTS = [
    "–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –º—ã—Å–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞",
    "–æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–º–æ–≤",
    "–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –¥–∏–∞–ª–æ–≥–∞",
    "—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –¥—ã—Ö–∞–Ω–∏–∏",
    "—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Å–Ω—ã—Ö –æ—â—É—â–µ–Ω–∏–π"
]
```

**–°–≤—è–∑—å:** `is_technique_for` ‚Üí PRACTICE
**–ü—Ä–∏–º–µ—Ä:** "–ù–∞–±–ª—é–¥–µ–Ω–∏–µ –º—ã—Å–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ ‚Äî —ç—Ç–æ —Ç–µ—Ö–Ω–∏–∫–∞ –º–µ—Ç–∞–Ω–∞–±–ª—é–¥–µ–Ω–∏—è"

***

### –£—Ä–æ–≤–µ–Ω—å 5: EXERCISE (–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è)

```python
# –ü–æ—à–∞–≥–æ–≤—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
EXERCISE_CONCEPTS = [
    {
        "name": "5-–º–∏–Ω—É—Ç–Ω–æ–µ –º–µ—Ç–∞–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ",
        "duration": "5 –º–∏–Ω—É—Ç",
        "frequency": "3 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å",
        "instructions": "1. –°—è–¥—å —É–¥–æ–±–Ω–æ...",
        "parent_technique": "–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –º—ã—Å–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞"
    }
]
```

**–°–≤—è–∑—å:** `is_exercise_for` ‚Üí TECHNIQUE
**–ü—Ä–∏–º–µ—Ä:** "5-–º–∏–Ω—É—Ç–Ω–æ–µ –º–µ—Ç–∞–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ ‚Äî —ç—Ç–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –¥–ª—è —Ç–µ—Ö–Ω–∏–∫–∏ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è"

***

## üîó –¢–∏–ø—ã —Å–≤—è–∑–µ–π (Relationships)

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–≤—è–∑–∏ (–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ):

```python
VERTICAL_RELATIONSHIPS = {
    "is_core_component_of": "Domain —è–≤–ª—è–µ—Ç—Å—è —è–¥—Ä–æ–º Root",
    "is_practice_for": "Practice –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è Domain",
    "is_technique_for": "Technique —Ä–µ–∞–ª–∏–∑—É–µ—Ç Practice",
    "is_exercise_for": "Exercise —Ç—Ä–µ–Ω–∏—Ä—É–µ—Ç Technique"
}
```


### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ (cross-connections):

```python
HORIZONTAL_RELATIONSHIPS = {
    "enables": "Concept A –¥–µ–ª–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã–º Concept B",
    "requires": "Concept A —Ç—Ä–µ–±—É–µ—Ç Concept B",
    "leads_to": "Concept A –≤–µ–¥—ë—Ç –∫ Concept B",
    "transforms_into": "Concept A —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –≤ Concept B"
}
```


***

## üìù –®–ê–ì 1: –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö

### –ü—É—Ç—å: `text_processor/extractors/concept_hierarchy_extractor.py`

```python
@dataclass
class ConceptNode:
    """–£–∑–µ–ª –≤ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –∫–æ–Ω—Ü–µ–ø—Ç–æ–≤"""
    name: str                    # –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–∞
    level: str                   # root/domain/practice/technique/exercise
    parent: Optional[str]        # –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–Ω—Ü–µ–ø—Ç
    relation_type: str           # –¢–∏–ø —Å–≤—è–∑–∏ —Å —Ä–æ–¥–∏—Ç–µ–ª–µ–º
    description: str             # –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑ —Ç–µ–∫—Å—Ç–∞
    sarsekenov_terms: List[str]  # –¢–µ—Ä–º–∏–Ω—ã –°–∞—Ä—Å–µ–∫–µ–Ω–æ–≤–∞ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏
    tier: int                    # Tier –∏–∑ sarsekenov_terms.json (1-6)
    
    # –î–ª—è EXERCISE:
    duration: Optional[str] = None      # "5 –º–∏–Ω—É—Ç", "10-15 –º–∏–Ω—É—Ç"
    frequency: Optional[str] = None     # "3 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å", "–µ–∂–µ–¥–Ω–µ–≤–Ω–æ"
    instructions: Optional[str] = None  # –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

@dataclass
class CrossConnection:
    """–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è —Å–≤—è–∑—å –º–µ–∂–¥—É –∫–æ–Ω—Ü–µ–ø—Ç–∞–º–∏"""
    from_concept: str
    to_concept: str
    relation: str          # enables/requires/leads_to/transforms_into
    explanation: str       # –û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Å–≤—è–∑–∏
    context: str           # –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ —Ç–µ–∫—Å—Ç–∞

@dataclass
class ConceptHierarchy:
    """–ü–æ–ª–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è –∫–æ–Ω—Ü–µ–ø—Ç–æ–≤"""
    root: ConceptNode              # –ö–æ—Ä–µ–Ω—å (–≤—Å–µ–≥–¥–∞ 1)
    domains: List[ConceptNode]     # –î–æ–º–µ–Ω—ã (–º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ)
    practices: List[ConceptNode]   # –ü—Ä–∞–∫—Ç–∏–∫–∏
    techniques: List[ConceptNode]  # –¢–µ—Ö–Ω–∏–∫–∏
    exercises: List[ConceptNode]   # –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
    cross_connections: List[CrossConnection]  # –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏
    confidence: float              # –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ –∏–µ—Ä–∞—Ä—Ö–∏–∏
    sarsekenov_density: float      # –ü–ª–æ—Ç–Ω–æ—Å—Ç—å —Ç–µ—Ä–º–∏–Ω–æ–≤
```


***

## üìù –®–ê–ì 2: –ö–ª–∞—Å—Å ConceptHierarchyExtractor

```python
class ConceptHierarchyExtractor:
    """
    –≠–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä –∏–µ—Ä–∞—Ä—Ö–∏–∏ –∫–æ–Ω—Ü–µ–ø—Ç–æ–≤ –°–∞—Ä—Å–µ–∫–µ–Ω–æ–≤–∞.
    
    –§–ò–õ–û–°–û–§–ò–Ø:
    ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    1. –°–¢–†–û–ì–ê–Ø 5-—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–±–µ–∑ –∏—Å–∫–ª—é—á–µ–Ω–∏–π)
    2. ROOT –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ: –Ω–µ–π—Ä–æ-—Å—Ç–∞–ª–∫–∏–Ω–≥/–Ω–µ–æ-—Å—Ç–∞–ª–∫–∏–Ω–≥/—Å—Ç–∞–ª–∫–∏–Ω–≥ —É–º–∞
    3. –ö–∞–∂–¥—ã–π –∫–æ–Ω—Ü–µ–ø—Ç –∏–º–µ–µ—Ç –†–û–í–ù–û –û–î–ù–û–ì–û —Ä–æ–¥–∏—Ç–µ–ª—è (–¥–µ—Ä–µ–≤–æ, –Ω–µ –≥—Ä–∞—Ñ)
    4. –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ ‚Äî –æ—Ç–¥–µ–ª—å–Ω–æ (cross_connections)
    5. SMART —Ä–µ–∂–∏–º –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (15%, forbidden –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è)
    ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    """
    
    # –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –∫–æ—Ä–Ω–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ç—ã
    ALLOWED_ROOTS = ["–Ω–µ–π—Ä–æ-—Å—Ç–∞–ª–∫–∏–Ω–≥", "–Ω–µ–æ-—Å—Ç–∞–ª–∫–∏–Ω–≥", "—Å—Ç–∞–ª–∫–∏–Ω–≥ —É–º–∞"]
    
    # –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Ä–º–∏–Ω–æ–≤ –°–∞—Ä—Å–µ–∫–µ–Ω–æ–≤–∞
    MIN_SARSEKENOV_TERMS = 3
    
    # –£—Ä–æ–≤–Ω–∏ –∏–µ—Ä–∞—Ä—Ö–∏–∏ (–°–¢–†–û–ì–û –≤ —Ç–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ)
    HIERARCHY_LEVELS = ["root", "domain", "practice", "technique", "exercise"]
    
    def __init__(
        self,
        terminology_validator: Optional[TerminologyValidator] = None,
        use_llm: bool = False,
        llm_client: Optional[Any] = None
    ):
        self.validator = terminology_validator or TerminologyValidator()
        self.use_llm = use_llm
        self.llm_client = llm_client
        self._load_sarsekenov_terms()
        self._build_level_term_mapping()
    
    def _load_sarsekenov_terms(self):
        """–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Ä–º–∏–Ω–æ–≤ –∏–∑ config/terminology/sarsekenov_terms.json"""
        config_path = Path(__file__).parent.parent.parent / "config" / "terminology" / "sarsekenov_terms.json"
        with open(config_path, 'r', encoding='utf-8') as f:
            self.sarsekenov_terms_config = json.load(f)
    
    def _build_level_term_mapping(self):
        """
        –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥: —Ç–µ—Ä–º–∏–Ω ‚Üí —É—Ä–æ–≤–µ–Ω—å –∏–µ—Ä–∞—Ä—Ö–∏–∏
        
        –ò—Å–ø–æ–ª—å–∑—É–µ–º tier –∏–∑ sarsekenov_terms.json:
        - tier_1_root ‚Üí root
        - tier_2_domain ‚Üí domain
        - tier_3_practice ‚Üí practice
        - tier_4_diagnostic ‚Üí –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –ª—é–±–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
        - tier_5_agents ‚Üí –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –ª—é–±–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
        - tier_6_states ‚Üí –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –ª—é–±–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
        """
        self.term_to_level = {}
        self.term_to_tier = {}
        
        for tier_key, tier_data in self.sarsekenov_terms_config.items():
            level = tier_data.get('level', 'unknown')
            terms = tier_data.get('terms', [])
            tier_num = int(tier_key.split('_')[^1])
            
            for term in terms:
                self.term_to_level[term] = level
                self.term_to_tier[term] = tier_num
    
    def extract(
        self,
        text: str,
        expected_root: Optional[str] = None
    ) -> Dict[str, Any]:
        """
        –ò–∑–≤–ª–µ—á—å –∏–µ—Ä–∞—Ä—Ö–∏—é –∫–æ–Ω—Ü–µ–ø—Ç–æ–≤ –∏–∑ —Ç–µ–∫—Å—Ç–∞.
        
        Args:
            text: –¢–µ–∫—Å—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
            expected_root: –û–∂–∏–¥–∞–µ–º—ã–π root (None = –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ)
        
        Returns:
            {
                "valid": bool,
                "reason": str,
                "hierarchy": Dict,  # –°–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è ConceptHierarchy
                "metrics": Dict
            }
        """
        
        # 1. –í–ê–õ–ò–î–ê–¶–ò–Ø —á–µ—Ä–µ–∑ TerminologyValidator (SMART —Ä–µ–∂–∏–º)
        validation = self.validator.validate_text(text)
        
        if not validation.is_valid:
            return {
                "valid": False,
                "reason": validation.reason,
                "hierarchy": None,
                "metrics": validation.metrics
            }
        
        # 2. –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï ROOT
        root_node = self._identify_root(text, validation.sarsekenov_entities, expected_root)
        
        if not root_node:
            return {
                "valid": False,
                "reason": "–ù–µ –Ω–∞–π–¥–µ–Ω –∫–æ—Ä–Ω–µ–≤–æ–π –∫–æ–Ω—Ü–µ–ø—Ç (–Ω–µ–π—Ä–æ-—Å—Ç–∞–ª–∫–∏–Ω–≥/–Ω–µ–æ-—Å—Ç–∞–ª–∫–∏–Ω–≥/—Å—Ç–∞–ª–∫–∏–Ω–≥ —É–º–∞)",
                "hierarchy": None,
                "metrics": validation.metrics
            }
        
        # 3. –ò–ó–í–õ–ï–ß–ï–ù–ò–ï —É—Ä–æ–≤–Ω–µ–π (rule-based –∏–ª–∏ LLM)
        if self.use_llm and self.llm_client:
            hierarchy = self._extract_with_llm(text, root_node, validation)
        else:
            hierarchy = self._extract_rule_based(text, root_node, validation)
        
        # 4. –í–ê–õ–ò–î–ê–¶–ò–Ø –∏–µ—Ä–∞—Ä—Ö–∏–∏
        if not self._validate_hierarchy(hierarchy):
            return {
                "valid": False,
                "reason": "–ò–µ—Ä–∞—Ä—Ö–∏—è –Ω–µ –ø—Ä–æ—à–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—é (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Ä–æ–≤–Ω–∏ –∏ —Å–≤—è–∑–∏)",
                "hierarchy": None,
                "metrics": validation.metrics
            }
        
        return {
            "valid": True,
            "reason": f"–ò–∑–≤–ª–µ—á–µ–Ω–∞ –∏–µ—Ä–∞—Ä—Ö–∏—è —Å {len(hierarchy.domains)} –¥–æ–º–µ–Ω–∞–º–∏",
            "hierarchy": asdict(hierarchy),
            "metrics": {
                "density": validation.metrics['density'],
                "total_nodes": (
                    1 +  # root
                    len(hierarchy.domains) +
                    len(hierarchy.practices) +
                    len(hierarchy.techniques) +
                    len(hierarchy.exercises)
                ),
                "levels": {
                    "domains": len(hierarchy.domains),
                    "practices": len(hierarchy.practices),
                    "techniques": len(hierarchy.techniques),
                    "exercises": len(hierarchy.exercises)
                },
                "cross_connections": len(hierarchy.cross_connections)
            }
        }
```


***

## üìù –®–ê–ì 3: Rule-based –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ

```python
def _identify_root(
    self,
    text: str,
    entities: List[str],
    expected_root: Optional[str]
) -> Optional[ConceptNode]:
    """
    –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ—Ä–Ω–µ–≤–æ–π –∫–æ–Ω—Ü–µ–ø—Ç.
    
    –ê–ª–≥–æ—Ä–∏—Ç–º:
    1. –ï—Å–ª–∏ expected_root —É–∫–∞–∑–∞–Ω –∏ –Ω–∞–π–¥–µ–Ω –≤ —Ç–µ–∫—Å—Ç–µ ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
    2. –ò–Ω–∞—á–µ –∏—Å–∫–∞—Ç—å –ª—é–±–æ–π –∏–∑ ALLOWED_ROOTS –≤ entities
    3. –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ ‚Üí –≤—ã–±—Ä–∞—Ç—å –ø–µ—Ä–≤—ã–π –ø–æ –≤—Å—Ç—Ä–µ—á–∞–µ–º–æ—Å—Ç–∏ –≤ —Ç–µ–∫—Å—Ç–µ
    """
    text_lower = text.lower()
    
    if expected_root:
        if expected_root in self.ALLOWED_ROOTS and expected_root.lower() in text_lower:
            return ConceptNode(
                name=expected_root,
                level="root",
                parent=None,
                relation_type="",
                description=self._extract_root_description(text, expected_root),
                sarsekenov_terms=[expected_root],
                tier=1
            )
    
    # –ü–æ–∏—Å–∫ –ª—é–±–æ–≥–æ –∫–æ—Ä–Ω—è
    for root_term in self.ALLOWED_ROOTS:
        if root_term.lower() in text_lower or root_term in entities:
            return ConceptNode(
                name=root_term,
                level="root",
                parent=None,
                relation_type="",
                description=self._extract_root_description(text, root_term),
                sarsekenov_terms=[root_term],
                tier=1
            )
    
    return None

def _extract_rule_based(
    self,
    text: str,
    root_node: ConceptNode,
    validation: ValidationResult
) -> ConceptHierarchy:
    """
    Rule-based –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏.
    
    –ê–ª–≥–æ—Ä–∏—Ç–º:
    1. –†–∞–∑–±–∏—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
    2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è (domain‚Üípractice‚Üítechnique‚Üíexercise):
       - –ù–∞–π—Ç–∏ —Ç–µ—Ä–º–∏–Ω—ã —ç—Ç–æ–≥–æ —É—Ä–æ–≤–Ω—è –≤ entities
       - –°–æ–∑–¥–∞—Ç—å —É–∑–ª—ã —Å —Ä–æ–¥–∏—Ç–µ–ª—è–º–∏
    3. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å cross-connections –º–µ–∂–¥—É —É–∑–ª–∞–º–∏
    """
    
    sentences = self._split_sentences(text)
    entities = validation.sarsekenov_entities
    
    # –£–†–û–í–ï–ù–¨ 2: DOMAINS
    domains = self._extract_level_nodes(
        sentences,
        entities,
        level="domain",
        parent_node=root_node,
        relation_type="is_core_component_of"
    )
    
    # –£–†–û–í–ï–ù–¨ 3: PRACTICES
    practices = []
    for domain in domains:
        domain_practices = self._extract_level_nodes(
            sentences,
            entities,
            level="practice",
            parent_node=domain,
            relation_type="is_practice_for"
        )
        practices.extend(domain_practices)
    
    # –£–†–û–í–ï–ù–¨ 4: TECHNIQUES
    techniques = []
    for practice in practices:
        practice_techniques = self._extract_level_nodes(
            sentences,
            entities,
            level="technique",
            parent_node=practice,
            relation_type="is_technique_for"
        )
        techniques.extend(practice_techniques)
    
    # –£–†–û–í–ï–ù–¨ 5: EXERCISES
    exercises = []
    for technique in techniques:
        technique_exercises = self._extract_exercises(
            sentences,
            technique
        )
        exercises.extend(technique_exercises)
    
    # –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏
    cross_connections = self._extract_cross_connections(
        sentences,
        domains + practices + techniques
    )
    
    hierarchy = ConceptHierarchy(
        root=root_node,
        domains=domains,
        practices=practices,
        techniques=techniques,
        exercises=exercises,
        cross_connections=cross_connections,
        confidence=self._calculate_hierarchy_confidence(domains, practices, techniques),
        sarsekenov_density=validation.metrics['density']
    )
    
    return hierarchy

def _extract_level_nodes(
    self,
    sentences: List[str],
    entities: List[str],
    level: str,
    parent_node: ConceptNode,
    relation_type: str
) -> List[ConceptNode]:
    """
    –ò–∑–≤–ª–µ—á—å —É–∑–ª—ã –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è.
    
    –ê–ª–≥–æ—Ä–∏—Ç–º:
    1. –ù–∞–π—Ç–∏ –≤—Å–µ —Ç–µ—Ä–º–∏–Ω—ã —ç—Ç–æ–≥–æ —É—Ä–æ–≤–Ω—è –≤ entities
    2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Ä–º–∏–Ω–∞ –Ω–∞–π—Ç–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º
    3. –°–æ–∑–¥–∞—Ç—å ConceptNode
    """
    level_nodes = []
    
    # –ù–∞–π—Ç–∏ —Ç–µ—Ä–º–∏–Ω—ã —ç—Ç–æ–≥–æ —É—Ä–æ–≤–Ω—è
    level_terms = [e for e in entities if self.term_to_level.get(e) == level]
    
    for term in level_terms:
        # –ù–∞–π—Ç–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Å —ç—Ç–∏–º —Ç–µ—Ä–º–∏–Ω–æ–º
        description = self._find_description_for_term(sentences, term)
        
        # –ò–∑–≤–ª–µ—á—å —Ç–µ—Ä–º–∏–Ω—ã –°–∞—Ä—Å–µ–∫–µ–Ω–æ–≤–∞ –∏–∑ –æ–ø–∏—Å–∞–Ω–∏—è
        desc_terms = [e for e in entities if e.lower() in description.lower()]
        
        node = ConceptNode(
            name=term,
            level=level,
            parent=parent_node.name,
            relation_type=relation_type,
            description=description,
            sarsekenov_terms=desc_terms,
            tier=self.term_to_tier.get(term, 0)
        )
        
        level_nodes.append(node)
    
    return level_nodes

def _extract_exercises(
    self,
    sentences: List[str],
    parent_technique: ConceptNode
) -> List[ConceptNode]:
    """
    –ò–∑–≤–ª–µ—á—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –¥–ª—è —Ç–µ—Ö–Ω–∏–∫–∏.
    
    –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è —Ä–µ–¥–∫–æ —è–≤–Ω–æ –Ω–∞–∑–≤–∞–Ω—ã –≤ —Ç–µ–∫—Å—Ç–µ, –ø–æ—ç—Ç–æ–º—É:
    1. –ò—â–µ–º –º–∞—Ä–∫–µ—Ä—ã —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π: "–ø—Ä–∞–∫—Ç–∏–∫—É–π", "–¥–µ–ª–∞–π", "–ø–æ–ø—Ä–æ–±—É–π", "—É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ"
    2. –ò–∑–≤–ª–µ–∫–∞–µ–º duration, frequency, instructions
    """
    exercises = []
    
    exercise_markers = ["–ø—Ä–∞–∫—Ç–∏–∫—É–π", "–¥–µ–ª–∞–π", "–ø–æ–ø—Ä–æ–±—É–π", "—É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ", "—Ç—Ä–µ–Ω–∏—Ä—É–π"]
    
    for sentence in sentences:
        sentence_lower = sentence.lower()
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –º–∞—Ä–∫–µ—Ä–∞ –ò —Ç–µ—Ä–º–∏–Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—è
        if any(marker in sentence_lower for marker in exercise_markers):
            if parent_technique.name.lower() in sentence_lower:
                
                # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–º–µ–Ω–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
                exercise_name = f"–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –¥–ª—è {parent_technique.name}"
                
                # –ü–æ–ø—ã—Ç–∫–∞ –∏–∑–≤–ª–µ—á—å duration
                duration = self._extract_duration(sentence)
                
                # –ü–æ–ø—ã—Ç–∫–∞ –∏–∑–≤–ª–µ—á—å frequency
                frequency = self._extract_frequency(sentence)
                
                exercise = ConceptNode(
                    name=exercise_name,
                    level="exercise",
                    parent=parent_technique.name,
                    relation_type="is_exercise_for",
                    description=sentence,
                    sarsekenov_terms=[],
                    tier=5,
                    duration=duration,
                    frequency=frequency,
                    instructions=sentence
                )
                
                exercises.append(exercise)
    
    return exercises

def _extract_cross_connections(
    self,
    sentences: List[str],
    all_nodes: List[ConceptNode]
) -> List[CrossConnection]:
    """
    –ò–∑–≤–ª–µ—á—å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∫–æ–Ω—Ü–µ–ø—Ç–∞–º–∏.
    
    –ú–∞—Ä–∫–µ—Ä—ã —Å–≤—è–∑–µ–π:
    - "enables": "–¥–µ–ª–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã–º", "–ø–æ–∑–≤–æ–ª—è–µ—Ç", "–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø—É—Ç—å –∫"
    - "requires": "—Ç—Ä–µ–±—É–µ—Ç", "–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ", "–Ω—É–∂–Ω–æ —Å–Ω–∞—á–∞–ª–∞"
    - "leads_to": "–≤–µ–¥—ë—Ç –∫", "–ø—Ä–∏–≤–æ–¥–∏—Ç –∫", "—Ä–µ–∑—É–ª—å—Ç–∞—Ç"
    - "transforms_into": "—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –≤", "–ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤"
    """
    connections = []
    
    relation_markers = {
        "enables": ["–¥–µ–ª–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã–º", "–ø–æ–∑–≤–æ–ª—è–µ—Ç", "–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø—É—Ç—å –∫"],
        "requires": ["—Ç—Ä–µ–±—É–µ—Ç", "–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ", "–Ω—É–∂–Ω–æ —Å–Ω–∞—á–∞–ª–∞"],
        "leads_to": ["–≤–µ–¥—ë—Ç –∫", "–ø—Ä–∏–≤–æ–¥–∏—Ç –∫", "—Ä–µ–∑—É–ª—å—Ç–∞—Ç"],
        "transforms_into": ["—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –≤", "–ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤", "—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è"]
    }
    
    for sentence in sentences:
        sentence_lower = sentence.lower()
        
        # –ù–∞–π—Ç–∏ –∫–æ–Ω—Ü–µ–ø—Ç—ã –≤ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏
        concepts_in_sentence = [
            node for node in all_nodes 
            if node.name.lower() in sentence_lower
        ]
        
        if len(concepts_in_sentence) >= 2:
            # –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø —Å–≤—è–∑–∏
            for relation, markers in relation_markers.items():
                if any(marker in sentence_lower for marker in markers):
                    connection = CrossConnection(
                        from_concept=concepts_in_sentence[^0].name,
                        to_concept=concepts_in_sentence[^1].name,
                        relation=relation,
                        explanation=sentence,
                        context=sentence
                    )
                    connections.append(connection)
                    break
    
    return connections

def _calculate_hierarchy_confidence(
    self,
    domains: List[ConceptNode],
    practices: List[ConceptNode],
    techniques: List[ConceptNode]
) -> float:
    """
    –†–∞—Å—á—ë—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –≤ –∏–µ—Ä–∞—Ä—Ö–∏–∏.
    
    –§–∞–∫—Ç–æ—Ä—ã:
    - –ë–∞–∑–æ–≤–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: 0.5
    - +0.1 –∑–∞ –∫–∞–∂–¥—ã–π domain (–º–∞–∫—Å 0.2)
    - +0.05 –∑–∞ –∫–∞–∂–¥—É—é practice (–º–∞–∫—Å 0.15)
    - +0.02 –∑–∞ –∫–∞–∂–¥—É—é technique (–º–∞–∫—Å 0.1)
    - +0.05 –µ—Å–ª–∏ –µ—Å—Ç—å –≤—Å–µ 5 —É—Ä–æ–≤–Ω–µ–π
    """
    confidence = 0.5
    
    confidence += min(len(domains) * 0.1, 0.2)
    confidence += min(len(practices) * 0.05, 0.15)
    confidence += min(len(techniques) * 0.02, 0.1)
    
    # –ë–æ–Ω—É—Å –∑–∞ –ø–æ–ª–Ω–æ—Ç—É –∏–µ—Ä–∞—Ä—Ö–∏–∏
    if domains and practices and techniques:
        confidence += 0.05
    
    return min(confidence, 1.0)
```


***

## üìù –®–ê–ì 4: –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–µ—Ä–∞—Ä—Ö–∏–∏

```python
def _validate_hierarchy(self, hierarchy: ConceptHierarchy) -> bool:
    """
    –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–µ—Ä–∞—Ä—Ö–∏–∏.
    
    –ü—Ä–æ–≤–µ—Ä–∫–∏:
    1. Root –µ—Å—Ç—å –∏ —è–≤–ª—è–µ—Ç—Å—è –æ–¥–Ω–∏–º –∏–∑ ALLOWED_ROOTS
    2. –ö–∞–∂–¥—ã–π —É–∑–µ–ª –∏–º–µ–µ—Ç —Ä–æ–≤–Ω–æ –æ–¥–Ω–æ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª—è (–∫—Ä–æ–º–µ root)
    3. –£—Ä–æ–≤–Ω–∏ —Å—Ç—Ä–æ–≥–æ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω—ã (domain‚Üípractice‚Üítechnique‚Üíexercise)
    4. –ú–∏–Ω–∏–º—É–º —Ç–µ—Ä–º–∏–Ω–æ–≤ –°–∞—Ä—Å–µ–∫–µ–Ω–æ–≤–∞ –≤ –∏–µ—Ä–∞—Ä—Ö–∏–∏
    """
    
    # 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ root
    if hierarchy.root.name not in self.ALLOWED_ROOTS:
        return False
    
    # 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–¥–∏—Ç–µ–ª–µ–π
    all_nodes = (
        [hierarchy.root] + 
        hierarchy.domains + 
        hierarchy.practices + 
        hierarchy.techniques + 
        hierarchy.exercises
    )
    
    for node in all_nodes:
        if node.level != "root":
            if not node.parent:
                return False
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Ä–æ–¥–∏—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            parent_exists = any(n.name == node.parent for n in all_nodes)
            if not parent_exists:
                return False
    
    # 3. –ü–æ–¥—Å—á—ë—Ç —Ç–µ—Ä–º–∏–Ω–æ–≤
    all_terms = []
    for node in all_nodes:
        all_terms.extend(node.sarsekenov_terms)
    
    if len(set(all_terms)) < self.MIN_SARSEKENOV_TERMS:
        return False
    
    return True
```


***

## üìù –®–ê–ì 5: Utility —Ñ—É–Ω–∫—Ü–∏—è

```python
def extract_concept_hierarchy(
    text: str,
    expected_root: Optional[str] = None,
    use_llm: bool = False
) -> Dict[str, Any]:
    """
    –ë—ã—Å—Ç—Ä–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –∫–æ–Ω—Ü–µ–ø—Ç–æ–≤.
    
    Args:
        text: –¢–µ–∫—Å—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
        expected_root: –û–∂–∏–¥–∞–µ–º—ã–π –∫–æ—Ä–µ–Ω—å (None = –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ)
        use_llm: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å LLM
    
    Returns:
        Dict —Å –∏–µ—Ä–∞—Ä—Ö–∏–µ–π
    """
    extractor = ConceptHierarchyExtractor(use_llm=use_llm)
    return extractor.extract(text, expected_root)
```


***

## üìù –®–ê–ì 6: –¢–µ—Å—Ç—ã

### –ü—É—Ç—å: `tests/extractors/test_concept_hierarchy_extractor.py`

```python
def test_strict_5_level_hierarchy():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä–æ–≥–æ–π 5-—É—Ä–æ–≤–Ω–µ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã"""
    text = """
    –ù–µ–π—Ä–æ-—Å—Ç–∞–ª–∫–∏–Ω–≥ –≤–∫–ª—é—á–∞–µ—Ç –ø–æ–ª–µ –≤–Ω–∏–º–∞–Ω–∏—è –∫–∞–∫ core component.
    –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª–µ–º –≤–Ω–∏–º–∞–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –º–µ—Ç–∞–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ.
    –ú–µ—Ç–∞–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ç–µ—Ö–Ω–∏–∫—É –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –º—ã—Å–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞.
    """
    
    result = extractor.extract(text)
    
    assert result['valid'] is True
    hierarchy = result['hierarchy']
    
    assert hierarchy['root']['level'] == "root"
    assert all(d['level'] == "domain" for d in hierarchy['domains'])
    assert all(p['level'] == "practice" for p in hierarchy['practices'])
    
def test_root_must_be_allowed():
    """Root –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑ ALLOWED_ROOTS"""
    text = """
    –ü—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–∏—è –≤–∫–ª—é—á–∞–µ—Ç –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å —Å–æ–∑–Ω–∞–Ω–∏–µ–º.
    """
    
    result = extractor.extract(text)
    
    # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ (–Ω–µ—Ç –Ω–µ–π—Ä–æ-—Å—Ç–∞–ª–∫–∏–Ω–≥–∞)
    assert result['valid'] is False
    assert "–∫–æ—Ä–Ω–µ–≤–æ–π –∫–æ–Ω—Ü–µ–ø—Ç" in result['reason'].lower()

def test_parent_child_relationships():
    """–ö–∞–∂–¥—ã–π —É–∑–µ–ª –∏–º–µ–µ—Ç —Ä–æ–¥–∏—Ç–µ–ª—è"""
    text = """
    –ù–µ–π—Ä–æ-—Å—Ç–∞–ª–∫–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø–æ–ª–µ–º –≤–Ω–∏–º–∞–Ω–∏—è.
    –ú–µ—Ç–∞–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –ø—Ä–∞–∫—Ç–∏–∫–∞ –¥–ª—è –ø–æ–ª—è –≤–Ω–∏–º–∞–Ω–∏—è.
    """
    
    result = extractor.extract(text)
    
    assert result['valid'] is True
    hierarchy = result['hierarchy']
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ practices –∏–º–µ—é—Ç —Ä–æ–¥–∏—Ç–µ–ª–µ–π –∏–∑ domains
    for practice in hierarchy['practices']:
        assert practice['parent'] in [d['name'] for d in hierarchy['domains']]

def test_cross_connections_extracted():
    """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã—Ö —Å–≤—è–∑–µ–π"""
    text = """
    –ú–µ—Ç–∞–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –¥–µ–ª–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã–º —Ä–∞–∑–æ—Ç–æ–∂–¥–µ—Å—Ç–≤–ª–µ–Ω–∏–µ.
    –†–∞–∑–æ—Ç–æ–∂–¥–µ—Å—Ç–≤–ª–µ–Ω–∏–µ –≤–µ–¥—ë—Ç –∫ —á–∏—Å—Ç–æ–º—É –æ—Å–æ–∑–Ω–∞–≤–∞–Ω–∏—é.
    """
    
    result = extractor.extract(text)
    
    assert result['valid'] is True
    assert len(result['hierarchy']['cross_connections']) > 0
    
    conn = result['hierarchy']['cross_connections'][^0]
    assert conn['relation'] in ['enables', 'leads_to', 'requires', 'transforms_into']

def test_exercises_with_duration_frequency():
    """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏"""
    text = """
    –ü—Ä–∞–∫—Ç–∏–∫—É–π –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –º—ã—Å–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ 5 –º–∏–Ω—É—Ç,
    3 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å.
    """
    
    result = extractor.extract(text)
    
    if result['hierarchy']['exercises']:
        exercise = result['hierarchy']['exercises'][^0]
        assert exercise['duration'] is not None
        assert exercise['frequency'] is not None

def test_minimum_sarsekenov_terms():
    """–ú–∏–Ω–∏–º—É–º 3 —Ç–µ—Ä–º–∏–Ω–∞ –°–∞—Ä—Å–µ–∫–µ–Ω–æ–≤–∞ –≤ –∏–µ—Ä–∞—Ä—Ö–∏–∏"""
    text = """
    –ù–µ–π—Ä–æ-—Å—Ç–∞–ª–∫–∏–Ω–≥ ‚Äî —ç—Ç–æ —É—á–µ–Ω–∏–µ.
    """
    
    result = extractor.extract(text)
    
    # –ú–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ –∏–∑-–∑–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∞ —Ç–µ—Ä–º–∏–Ω–æ–≤
    if not result['valid']:
        assert "—Ç–µ—Ä–º–∏–Ω" in result['reason'].lower()

def test_utility_function():
    """–¢–µ—Å—Ç utility —Ñ—É–Ω–∫—Ü–∏–∏"""
    text = """
    –ù–µ–π—Ä–æ-—Å—Ç–∞–ª–∫–∏–Ω–≥ –≤–∫–ª—é—á–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å –ø–æ–ª–µ–º –≤–Ω–∏–º–∞–Ω–∏—è
    —á–µ—Ä–µ–∑ –ø—Ä–∞–∫—Ç–∏–∫—É –º–µ—Ç–∞–Ω–∞–±–ª—é–¥–µ–Ω–∏—è.
    """
    
    result = extract_concept_hierarchy(text, expected_root="–Ω–µ–π—Ä–æ-—Å—Ç–∞–ª–∫–∏–Ω–≥")
    
    assert result['valid'] is True
    assert result['hierarchy']['root']['name'] == "–Ω–µ–π—Ä–æ-—Å—Ç–∞–ª–∫–∏–Ω–≥"

def test_smart_mode_validation():
    """SMART —Ä–µ–∂–∏–º: forbidden terms –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç"""
    text = """
    –ù–µ–π—Ä–æ-—Å—Ç–∞–ª–∫–∏–Ω–≥ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –º–µ–¥–∏—Ç–∞—Ü–∏–∏ –∏ —Ä–∞–±–æ—Ç—ã —Å —ç–≥–æ.
    –û—Å–Ω–æ–≤–∞ ‚Äî –ø–æ–ª–µ –≤–Ω–∏–º–∞–Ω–∏—è –∏ –º–µ—Ç–∞–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ.
    """
    
    result = extractor.extract(text)
    
    # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–∏–Ω—è—Ç–æ (–ø–ª–æ—Ç–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è, —Ä–µ–∂–∏–º smart)
    assert result['valid'] is True
```


***

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- [ ] –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `text_processor/extractors/concept_hierarchy_extractor.py`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã dataclasses: ConceptNode, CrossConnection, ConceptHierarchy
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–ª–∞—Å—Å ConceptHierarchyExtractor
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `extract()` —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω `_identify_root()` (ALLOWED_ROOTS)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω `_extract_rule_based()` –¥–ª—è 5 —É—Ä–æ–≤–Ω–µ–π
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω `_extract_cross_connections()`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω `_validate_hierarchy()` (—Å—Ç—Ä–æ–≥–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ exercises —Å duration/frequency
- [ ] –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/extractors/test_concept_hierarchy_extractor.py`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ 10+ —Ç–µ—Å—Ç–æ–≤
- [ ] **–í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´** ‚úÖ

***

## üéØ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```python
from text_processor.extractors import ConceptHierarchyExtractor, extract_concept_hierarchy

text = """
–ù–µ–π—Ä–æ-—Å—Ç–∞–ª–∫–∏–Ω–≥ ‚Äî —ç—Ç–æ –ø—Ä–∞–∫—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª–µ–º –≤–Ω–∏–º–∞–Ω–∏—è —á–µ—Ä–µ–∑
–º–µ—Ç–∞–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ. –ú–µ—Ç–∞–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ç–µ—Ö–Ω–∏–∫—É
–Ω–∞–±–ª—é–¥–µ–Ω–∏—è –º—ã—Å–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞. –ü—Ä–∞–∫—Ç–∏–∫—É–π 5 –º–∏–Ω—É—Ç, 3 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å.
–ú–µ—Ç–∞–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –¥–µ–ª–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã–º —Ä–∞–∑–æ—Ç–æ–∂–¥–µ—Å—Ç–≤–ª–µ–Ω–∏–µ.
"""

result = extract_concept_hierarchy(text, expected_root="–Ω–µ–π—Ä–æ-—Å—Ç–∞–ª–∫–∏–Ω–≥")

print(f"–í–∞–ª–∏–¥–µ–Ω: {result['valid']}")
print(f"Root: {result['hierarchy']['root']['name']}")
print(f"Domains: {len(result['hierarchy']['domains'])}")
print(f"Practices: {len(result['hierarchy']['practices'])}")
print(f"Cross-connections: {len(result['hierarchy']['cross_connections'])}")
```

**–í—ã–≤–æ–¥:**

```
–í–∞–ª–∏–¥–µ–Ω: True
Root: –Ω–µ–π—Ä–æ-—Å—Ç–∞–ª–∫–∏–Ω–≥
Domains: 1
Practices: 1
Cross-connections: 1
```


***

**–ì–æ—Ç–æ–≤–æ! –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è Cursor AI –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≠—Ç–∞–ø–∞ ‚Ññ4!** üéØ‚ú®

<div align="center">‚ÅÇ</div>

[^1]: Kontseptsii-i-terminologiia_Izuchenie-trudov-S.-Sarsek-1.md

