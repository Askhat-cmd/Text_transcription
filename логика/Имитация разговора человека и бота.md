
# ะธััะพะดั ะธะท ััะพะณะพ ะดะฐะฒะฐะน ัะผะพะดะตะปะธััะตะผ ะดะธะฐะปะพะณ ะฟะพะปัะทะพะฒะฐัะตะปั ะธ ะฑะพัะฐ. ะะฐะบ ััะพ ะฑัะดะตั ะฟัะพะธััะพะดะธัั ัะตัะฝะธัะตัะบะธ ะฐััะธัะตะบัััะฝะพ.  ะะพััะฐัะฐะนัั ะพะฑัััะฝััั ะฟัะพััะพ ะบะฐะบ ัะบะพะปัะฝะธะบั, ััะพะฑั ั ะผะตะฝั ะฟะพัะฒะธะปะพัั ัะตะปะพััะฝะฐั ะบะฐััะธะฝะบะฐ

ะัะปะธัะฝะพ! ะะฐะฒะฐะนัะต ัะฐะทะฑะตััะผ **ะถะธะฒะพะน ะดะธะฐะปะพะณ** ะฟะพัะฐะณะพะฒะพ, ะบะฐะบ ะฑัะดัะพ ะผั ัะผะพััะธะผ ัะธะปัะผ ะธ ััะฐะฒะธะผ ะฝะฐ ะฟะฐัะทั, ััะพะฑั ะทะฐะณะปัะฝััั "ะฟะพะด ะบะฐะฟะพั" ๐ฌ

## ๐ญ ะะธะฒะพะน ะดะธะฐะปะพะณ: 7 ัะพะพะฑัะตะฝะธะน (ัะตะฐะปะธััะธัะฝะพ)


***

# ๐จ ะฅะะ โ1: ะะพะปัะทะพะฒะฐัะตะปั ะฝะฐัะธะฝะฐะตั

**ะะพะปัะทะพะฒะฐัะตะปั ะฟะธัะตั:**
> "ะัะธะฒะตั. ะงัะฒััะฒัั ัะตะฑั ะบะฐะบ-ัะพ ัััะฐะฝะฝะพ ะฟะพัะปะตะดะฝะตะต ะฒัะตะผั..."

***

## ๐ง ะงัะพ ะฟัะพะธััะพะดะธั ะฟะพะด ะบะฐะฟะพัะพะผ (ะฟะฐัะทะฐ!)

### ะจะฐะณ 1: ะะพั ะฟะพะปััะฐะตั ัะพะพะฑัะตะฝะธะต

```
User input โ system
```


### ะจะฐะณ 2: ะะพั ัะตัะฐะตั โ ะบะฐะบะพะน ัะตะถะธะผ ะธัะฟะพะปัะทะพะฒะฐัั? ๐งญ

**Decision gate (ะฟัะพััะฐั ะฟัะพะฒะตัะบะฐ):**

```python
# ะะตัะฒะพะต ัะพะพะฑัะตะฝะธะต?
if len(turns) == 0:
    mode = "PRESENCE"  # ะะตะณะบะธะน ัะตะถะธะผ
```

**ะะพัะตะผั PRESENCE?**

- ะญัะพ ะทะฝะฐะบะพะผััะฒะพ
- ะะตั ะบะพะฝะบัะตัะฝะพะณะพ ะฒะพะฟัะพัะฐ
- ะญะผะพัะธะพะฝะฐะปัะฝะพะต, ัะฐัะฟะปัะฒัะฐัะพะต
- ะะต ะฝัะถะฝะพ ะณะปัะฑะพะบะพ ะบะพะฟะฐัั


### ะจะฐะณ 3: ะะฐะบัั ะฟะฐะผััั ะธัะฟะพะปัะทัะตั ะฑะพั?

```
MODE: PRESENCE
โ
Memory: ัะพะปัะบะพ ัะตะบััะตะต ัะพะพะฑัะตะฝะธะต (ะฝะตั ะธััะพัะธะธ)
โ
Embeddings: ะะะข (ะฝะต ะธัะตะผ ะฒ ะฑะฐะทะต)
Voyage: ะะะข (ะฝะต ะฝัะถะฝะพ)
```

**ะะฝะฐะปะพะณะธั:**
> ะัะตะดััะฐะฒั, ััะพ ะฑะพั โ ััะพ ะฒัะฐั.
> ะัะธ ะฟะตัะฒะพะผ "ะทะดัะฐะฒััะฒัะนัะต" ะพะฝ ะฝะต ะดะพััะฐัั ัะตะฝัะณะตะฝ ะธ ะฐะฝะฐะปะธะทั.
> ะะฝ ะฟัะพััะพ ัะปััะฐะตั ะธ ะบะธะฒะฐะตั.

### ะจะฐะณ 4: ะคะพัะผะธัะพะฒะฐะฝะธะต ะพัะฒะตัะฐ

**ะัะพะดะฝัะต ะดะฐะฝะฝัะต ะดะปั LLM:**

```json
{
  "system_prompt": "ะขั ะฟัะธัะพะปะพะณ-ะฑะพั, ัะฐะฑะพัะฐะตัั ะผัะณะบะพ...",
  "context": "ะะพะปัะทะพะฒะฐัะตะปั: ะัะธะฒะตั. ะงัะฒััะฒัั ัะตะฑั ะบะฐะบ-ัะพ ัััะฐะฝะฝะพ...",
  "mode": "PRESENCE",
  "instruction": "ะััะฐะทะธ ัะพััะพัะฝะธะต, ะฝะต ะธะฝัะตัะฟัะตัะธััะน"
}
```

**ะขะพะบะตะฝั:** ~500 (ะพัะตะฝั ะปะตะณะบะพ)
**ะกัะพะธะผะพััั:** \$0.005

### ะจะฐะณ 5: ะะพั ะพัะฒะตัะฐะตั

**ะะพั:**
> "ะกะปััั, ััะพ ัะตะฑะต ัะตะนัะฐั ะฝะตะฟัะพััะพ. ะะพะถะตัั ัะฐััะบะฐะทะฐัั ัััั ะฟะพะดัะพะฑะฝะตะต โ ััะพ ะธะผะตะฝะฝะพ ะบะฐะถะตััั ัััะฐะฝะฝัะผ?"

***

## ๐ง ะงัะพ ะทะฐะฟะพะผะฝะธะปะพัั ะฒ ะฟะฐะผััะธ ะฟะพัะปะต ัะพะดะฐ โ1?

```json
{
  "turn_1": {
    "user": "ะัะธะฒะตั. ะงัะฒััะฒัั ัะตะฑั ะบะฐะบ-ัะพ ัััะฐะฝะฝะพ...",
    "bot": "ะกะปััั, ััะพ ัะตะฑะต ัะตะนัะฐั ะฝะตะฟัะพััะพ...",
    "mode": "PRESENCE",
    "working_state": {
      "dominant_state": "ะฝะตะพะฟัะตะดะตะปัะฝะฝะพััั",
      "emotion": "ะปัะณะบะฐั ััะตะฒะพะณะฐ",
      "defense": null,
      "phase": "ะฝะฐัะฐะปะพ ะบะพะฝัะฐะบัะฐ"
    }
  }
}
```

**ะะฐะผััั:**

- โ Short-term: 1 ัะพะด
- โ Semantic: ะฟัััะพ
- โ Summary: ะตัั ัะฐะฝะพ

***

# ๐จ ะฅะะ โ2: ะะพะปัะทะพะฒะฐัะตะปั ัะฐัะบััะฒะฐะตััั

**ะะพะปัะทะพะฒะฐัะตะปั:**
> "ะั ัะฐะบะพะต... ะบะฐะบ ะฑัะดัะพ ะดะตะปะฐั ะฒัั ะฝะฐ ะฐะฒัะพะผะฐัะต. ะะฐะฑะพัะฐ, ะดะพะผ, ัะพะฝ. ะะพ ะฒะฝัััะธ ะฟัััะพ ะบะฐะบ-ัะพ."

***

## ๐ง ะะพะด ะบะฐะฟะพัะพะผ

### ะจะฐะณ 1: Decision gate

```python
# ะััั ะปะธ ะฒะพะฟัะพั? ะะะข
# ะััั ะปะธ ัะธะณะฝะฐะปั ะณะปัะฑะธะฝั? ะะะข (ะฟะพะบะฐ ะพะฟะธัะฐะฝะธะต)
# ะกะบะพะปัะบะพ ัะพะดะพะฒ? 2

mode = "PRESENCE"  # ะัั ะตัั ัะปััะฐะตะผ
```


### ะจะฐะณ 2: ะะฐะผััั

```
MODE: PRESENCE
โ
Memory: ะฟะพัะปะตะดะฝะธะต 2 ัะพะดะฐ (ัะพะด โ1 + ัะตะบััะธะน)
โ
Context size: ~1K ัะพะบะตะฝะพะฒ
โ
ะะฐะทะฐ ะทะฝะฐะฝะธะน: ะะ ะะกะะะะฌะะฃะะขะกะฏ
```

**ะะพัะตะผั ะฝะต ะปะตะทะตะผ ะฒ ะฑะฐะทั?**

- ะะพะปัะทะพะฒะฐัะตะปั ัะพะปัะบะพ ะพะฟะธััะฒะฐะตั
- ะะต ะทะฐะดะฐะป ะฒะพะฟัะพั
- ะะฐะฝะพ ะธะฝัะตัะฟัะตัะธัะพะฒะฐัั
- ะัะธัะพะปะพะณ ะฟัะพััะพ ะกะะฃะจะะะข


### ะจะฐะณ 3: LLM ะฟะพะปััะฐะตั

```json
{
  "context": "
    [ะฅะพะด 1]
    User: ะัะธะฒะตั. ะงัะฒััะฒัั ัะตะฑั ัััะฐะฝะฝะพ...
    Bot: ะกะปััั, ััะพ ัะตะฑะต ะฝะตะฟัะพััะพ...
    
    [ะฅะพะด 2]
    User: ะั ัะฐะบะพะต... ะบะฐะบ ะฑัะดัะพ ะดะตะปะฐั ะฒัั ะฝะฐ ะฐะฒัะพะผะฐัะต...
  ",
  "mode": "PRESENCE",
  "working_state": {
    "dominant_state": "ัะผะพัะธะพะฝะฐะปัะฝะพะต ะพะฝะตะผะตะฝะธะต",
    "emotion": "ะฟัััะพัะฐ"
  }
}
```

**ะขะพะบะตะฝั:** ~800
**ะกัะพะธะผะพััั:** \$0.008

### ะจะฐะณ 4: ะะพั ะพัะฒะตัะฐะตั

**ะะพั:**
> "ะะพะฝะธะผะฐั. ะัะดัะพ ะถะธะฒััั, ะฝะพ ะฝะต ััะฒััะฒัะตัั ะถะธะทะฝะธ. ะะฐะฒะฝะพ ััะพ ั ัะพะฑะพะน?"

***

## ๐ ะกะพััะพัะฝะธะต ะฟะฐะผััะธ ะฟะพัะปะต ัะพะดะฐ โ2

```
Short-term: [ัะพะด 1, ัะพะด 2]
Working state: ะพะฑะฝะพะฒะปัะฝ โ "ัะผะพัะธะพะฝะฐะปัะฝะพะต ะพะฝะตะผะตะฝะธะต"
Summary: ะตัั ะฝะตั
```


***

# ๐จ ะฅะะ โ3: ะะพะปััะต ะบะพะฝัะตะบััะฐ

**ะะพะปัะทะพะฒะฐัะตะปั:**
> "ะะตัััะฐ 3-4 ะฝะฐะฒะตัะฝะพะต. ะกะฝะฐัะฐะปะฐ ะฝะต ะทะฐะผะตัะฐะป, ะฐ ัะตะนัะฐั ัะตะฐะปัะฝะพ ะดะพััะฐะปะพ."

***

## ๐ง ะะพะด ะบะฐะฟะพัะพะผ

### Decision gate

```python
# ะะพะฟัะพั? ะะะข
# ะฅะพะดะพะฒ: 3
mode = "PRESENCE"
```


### ะะฐะผััั

```
Short-term: [ัะพะด 1, ัะพะด 2, ัะพะด 3]
```

**ะะพั:**
> "ะขะพ ะตััั ััะพ ะฝะต ัะตะทะบะพ ัะปััะธะปะพัั, ะฐ ะฟะพััะตะฟะตะฝะฝะพ ะฝะฐัะฐััะฐะปะพ. ะ ัะตะฟะตัั ััะฐะปะพ ะทะฐะผะตัะฝะพ ะฝะฐััะพะปัะบะพ, ััะพ ัะถะต ะผะตัะฐะตั."

**ะขะพะบะตะฝั:** ~1200
**ะกัะพะธะผะพััั:** \$0.012

***

# ๐จ ะฅะะ โ4: ะะตัะฒัะน ะะะะะะก (ะฟะตัะตะปะพะผะฝัะน ะผะพะผะตะฝั!)

**ะะพะปัะทะพะฒะฐัะตะปั:**
> "ะะฐ, ะธะผะตะฝะฝะพ! ะ ะฟะพัะตะผั ัะฐะบ ะฟัะพะธััะพะดะธั? ะฏ ะฒัะพะดะต ะฝะธัะตะณะพ ะฟะปะพัะพะณะพ ะฝะต ะดะตะปะฐะป..."

***

## ๐ง ะะพะด ะบะฐะฟะพัะพะผ (ะะะะะ โ ะทะดะตัั ะฒัั ะผะตะฝัะตััั!)

### ะจะฐะณ 1: Decision gate ๐จ

```python
# ะัะพะฒะตัะบะฐ ัะธะณะฝะฐะปะพะฒ:
user_message = "ะฟะพัะตะผั ัะฐะบ ะฟัะพะธััะพะดะธั?"

if "ะฟะพัะตะผั" in user_message:
    intervention_signal = True
    
if len(turns) >= 3:
    enough_context = True

โ mode = "INTERVENTION"  # ๐ฏ ะะะฃะะะะะ ะะะะะ
```

**ะญัะพ ะบะฐะบ:**
> ะงะตะปะพะฒะตะบ ะธะท "ั ะฟัะพััะพ ัะฐััะบะฐะทัะฒะฐั"
> ะฟะตัะตััะป ะฒ "ั ัะพัั ะะะะฏะขะฌ"
>
> ะัะฐั ะดะพััะฐัั ะธะฝััััะผะตะฝัั.

***

### ะจะฐะณ 2: ะะฐะผััั (ัะฐััะธัะตะฝะฝะฐั!)

```
MODE: INTERVENTION ๐ฏ
โ
Memory components:
  1. Short-term: ะะกะ 4 ัะพะดะฐ (ะฝะต 3!)
  2. Working state: ัะตะบััะตะต ัะพััะพัะฝะธะต
  3. Summary: ะบัะฐัะบะพะต ัะตะทัะผะต
```

**ะัะพะดะฝัะต ะดะฐะฝะฝัะต:**

```json
{
  "short_term": "
    [ะฅะพะด 1] User: ะัะธะฒะตั, ัััะฐะฝะฝะพ ัะตะฑั ััะฒััะฒัั...
    [ะฅะพะด 2] User: ะะตะปะฐั ะฒัั ะฝะฐ ะฐะฒัะพะผะฐัะต, ะฒะฝัััะธ ะฟัััะพ...
    [ะฅะพะด 3] User: ะะตัััะฐ 3-4, ะฟะพััะตะฟะตะฝะฝะพ ะฝะฐัะฐััะฐะปะพ...
    [ะฅะพะด 4] User: ะะพัะตะผั ัะฐะบ ะฟัะพะธััะพะดะธั?
  ",
  
  "working_state": {
    "dominant_state": "ัะผะพัะธะพะฝะฐะปัะฝะพะต ะพะฝะตะผะตะฝะธะต",
    "emotion": "ะฟัััะพัะฐ, ััััััะฐัะธั",
    "defense": "ะธะฝัะตะปะปะตะบััะฐะปะธะทะฐัะธั (ะธัะตั ะฟัะธัะธะฝั)",
    "phase": "ะพัะผััะปะตะฝะธะต"
  },
  
  "summary": "ะะพะปัะทะพะฒะฐัะตะปั ะพะฟะธััะฒะฐะตั ัะพััะพัะฝะธะต ัะผะพัะธะพะฝะฐะปัะฝะพะณะพ 
             ะพะฝะตะผะตะฝะธั, ะบะพัะพัะพะต ะฝะฐัะฐััะฐะตั 3-4 ะผะตัััะฐ. 
             ะะธะทะฝั ะฝะฐ ะฐะฒัะพะฟะธะปะพัะต, ะฝะตั ััะฒััะฒ.",
  
  "current_question": "ะะพัะตะผั ัะฐะบ ะฟัะพะธััะพะดะธั?"
}
```


***

### ะจะฐะณ 3: ะคะพัะผะธัะพะฒะฐะฝะธะต HYBRID QUERY ๐งฌ

**ะญัะพ ะฒะฐัะฐ ัะฝะธะบะฐะปัะฝะฐั ัะธัะบะฐ ะธะท file:14!**

**ะัะพะผะฟั ะดะปั LLM (ัะพัะผะธัะพะฒะฐะฝะธะต ะฟะพะธัะบะพะฒะพะณะพ ะทะฐะฟัะพัะฐ):**

```
ะขะตะบััะธะน ะฒะพะฟัะพั: "ะะพัะตะผั ัะฐะบ ะฟัะพะธััะพะดะธั?"

ะะพะฝัะตะบัั ะฑะตัะตะดั: [summary ะฒััะต]

ะกะพััะพัะฝะธะต: ัะผะพัะธะพะฝะฐะปัะฝะพะต ะพะฝะตะผะตะฝะธะต, ััััััะฐัะธั

โ ะกัะพัะผะธััะน ะฟะพะธัะบะพะฒัะน ะทะฐะฟัะพั ะดะปั ะฑะฐะทั ะทะฝะฐะฝะธะน
```

**LLM ะฒะพะทะฒัะฐัะฐะตั HYBRID_QUERY:**

```text
ะะพะฟัะพั ะฝะฐะฟัะฐะฒะปะตะฝ ะฝะฐ ะฟะพะฝะธะผะฐะฝะธะต ะฟัะธัะธะฝ ะฟะพััะตะฟะตะฝะฝะพะณะพ ะฝะฐัะฐััะฐะฝะธั 
ัะผะพัะธะพะฝะฐะปัะฝะพะณะพ ะพะฝะตะผะตะฝะธั, ะบะพะณะดะฐ ะถะธะทะฝั ะฟัะพะดะพะปะถะฐะตััั ััะฝะบัะธะพะฝะฐะปัะฝะพ, 
ะฝะพ ัััะฐัะธะฒะฐะตััั ะฒะฝัััะตะฝะฝัั ะฝะฐะฟะพะปะฝะตะฝะฝะพััั ะธ ะบะพะฝัะฐะบั ั ัะพะฑััะฒะตะฝะฝัะผะธ 
ััะฒััะฒะฐะผะธ. ะกะพััะพัะฝะธะต ัะฐัะฐะบัะตัะธะทัะตััั ะฟะพะฟััะบะพะน ัะฐัะธะพะฝะฐะปะธะทะฐัะธะธ 
ัะตัะตะท ะฟะพะธัะบ ะฒะฝะตัะฝะธั ะฟัะธัะธะฝ, ััะพ ะผะพะถะตั ะฑััั ะทะฐัะธัะพะน ะพั ะฟัะพะถะธะฒะฐะฝะธั 
ััััััะฐัะธะธ. ะฃะผะตััะฝะพ ะฟัะพััะฝะธัั ะผะตัะฐะฝะธะทะผ ะพะฝะตะผะตะฝะธั ะบะฐะบ ะทะฐัะธัั ะธ 
ัะฐะทะปะธัะธะต ะผะตะถะดั ััะฝะบัะธะพะฝะธัะพะฒะฐะฝะธะตะผ ะธ ะฟัะพะถะธะฒะฐะฝะธะตะผ.
```


***

### ะจะฐะณ 4: ะะพะธัะบ ะฒ ะฑะฐะทะต (embeddings)

```
HYBRID_QUERY
โ
Local embeddings model (ะฒะฐัะฐ ะปะพะบะฐะปัะฝะฐั ะผะพะดะตะปั)
โ
Vector DB search (top-7)
โ
ะะตะทัะปััะฐั:
  1. chunk_42: "ะญะผะพัะธะพะฝะฐะปัะฝะพะต ะพะฝะตะผะตะฝะธะต ะบะฐะบ ะทะฐัะธัะฐ" (0.78)
  2. chunk_17: "ะะพัะตัั ะบะพะฝัะฐะบัะฐ ั ััะฒััะฒะฐะผะธ" (0.74)
  3. chunk_88: "ะคัะฝะบัะธะพะฝะธัะพะฒะฐะฝะธะต vs ะฟัะพะถะธะฒะฐะฝะธะต" (0.72)
  4. chunk_31: "ะะพััะตะฟะตะฝะฝะพะต ะฒัะณะพัะฐะฝะธะต" (0.70)
  5. chunk_05: "ะะฐัะธัะฝะฐั ะฐะฒัะพะผะฐัะธะทะฐัะธั" (0.68)
  6. chunk_12: "ะญะบะทะธััะตะฝัะธะฐะปัะฝะฐั ะฟัััะพัะฐ" (0.66)
  7. chunk_54: "ะะตะฟัะตััะธะฒะฝะฐั ะฐะฟะฐัะธั" (0.64)
```

**ะญัะพ ะบะฐะบ:**
> ะะธะฑะปะธะพัะตะบะฐัั ะฟัะธะฝัั 7 ะบะฝะธะณ ะธ ะฟะพะปะพะถะธะป ะฝะฐ ััะพะป.
> ะขะตะฟะตัั ะฝัะถะฝะพ ะฒัะฑัะฐัั ะะฃะงะจะฃะฎ.

***

### ะจะฐะณ 5: Voyage AI (re-rank) ๐ฏ

**ะัะฟัะฐะฒะปัะตะผ ะฝะฐ ัะตัะฒะตั Voyage:**

```json
{
  "query": "ะะพัะตะผั ัะฐะบ ะฟัะพะธััะพะดะธั?",
  "hybrid_query": "[ัะตะบัั HYBRID_QUERY ะฒััะต]",
  "candidates": [
    {"id": "chunk_42", "text": "ะญะผะพัะธะพะฝะฐะปัะฝะพะต ะพะฝะตะผะตะฝะธะต..."},
    {"id": "chunk_17", "text": "ะะพัะตัั ะบะพะฝัะฐะบัะฐ..."},
    ... (ะฒัะต 7 ัะฐะฝะบะพะฒ)
  ]
}
```

**Voyage ะฐะฝะฐะปะธะทะธััะตั ะธ ะฒะพะทะฒัะฐัะฐะตั:**

```json
{
  "selected_id": "chunk_42",
  "confidence": 0.82,
  "reason": "ะงะฐะฝะบ ะฝะฐะฟััะผัั ะพะฑัััะฝัะตั ะผะตัะฐะฝะธะทะผ ะพะฝะตะผะตะฝะธั 
            ะบะฐะบ ะทะฐัะธัั, ััะพ ัะพัะฝะพ ัะพะพัะฒะตัััะฒัะตั ะบะพะฝัะตะบััั 
            ะธ ัะตะบััะตะผั ะฒะพะฟัะพัั"
}
```

**ะญัะพ ะบะฐะบ:**
> ะญะบัะฟะตัั ะฟัะพัะธัะฐะป ะฒัะต 7 ะบะฝะธะณ ะธ ัะบะฐะทะฐะป:
> "ะะพั ะญะขะ ะบะฝะธะณะฐ ัะพัะฝะพ ะพัะฒะตัะฐะตั ะฝะฐ ะฒะพะฟัะพั"

***

### ะจะฐะณ 6: ะคะพัะผะธัะพะฒะฐะฝะธะต ะพัะฒะตัะฐ

**ะัะพะดะฝัะต ะดะฐะฝะฝัะต ะดะปั ัะธะฝะฐะปัะฝะพะณะพ LLM:**

```json
{
  "context": "[ะฒัะต 4 ัะพะดะฐ ะดะธะฐะปะพะณะฐ]",
  "working_state": {...},
  "selected_chunk": "
    ะญะผะพัะธะพะฝะฐะปัะฝะพะต ะพะฝะตะผะตะฝะธะต ัะฐััะพ ะฒะพะทะฝะธะบะฐะตั ะบะฐะบ ะทะฐัะธัะฝัะน 
    ะผะตัะฐะฝะธะทะผ ะฟัะธัะธะบะธ, ะบะพะณะดะฐ ะฝะฐะบะพะฟะปะตะฝะฝะพะต ะฝะฐะฟััะถะตะฝะธะต ะธะปะธ 
    ะดะปะธัะตะปัะฝะฐั ััััััะฐัะธั ััะฐะฝะพะฒัััั ะฝะตะฒัะฝะพัะธะผัะผะธ. 
    ะะผะตััะพ ัะพะณะพ ััะพะฑั ััะฒััะฒะพะฒะฐัั ะฑะพะปั, ะฟัะธัะธะบะฐ 
    'ะฒัะบะปััะฐะตั' ัะผะพัะธะธ. ะญัะพ ะฝะต ัะพะทะฝะฐัะตะปัะฝัะน ะฒัะฑะพั...
  ",
  "confidence": 0.82,
  "instruction": "ะัะฟะพะปัะทัะน chunk, ะฝะพ ะณะพะฒะพัะธ ะฟัะพััะพ, 
                  ะฝะต ัะธัะฐะน ะปะตะบัะธั, ะณะพะฒะพัะธ ะณะธะฟะพัะตัะธัะตัะบะธ"
}
```

**ะขะพะบะตะฝั:** ~6000 (ะฒ 6 ัะฐะท ะฑะพะปััะต, ัะตะผ PRESENCE!)
**ะกัะพะธะผะพััั:** \$0.06

***

### ะจะฐะณ 7: ะะพั ะพัะฒะตัะฐะตั (ะธะฝัะตัะฒะตะฝัะธั)

**ะะพั:**
> "ะะพัะพะถะต, ััะพ ััะพ ะผะพะถะตั ะฑััั ะทะฐัะธัะฝะฐั ัะตะฐะบัะธั ะฟัะธัะธะบะธ. ะะพะณะดะฐ ะฝะฐะบะฐะฟะปะธะฒะฐะตััั ะฝะฐะฟััะถะตะฝะธะต ะธะปะธ ะดะพะปะณะพ ััะพ-ัะพ ััััััะธััะตั, ะฟัะธัะธะบะฐ ะธะฝะพะณะดะฐ ัะปะพะฒะฝะพ 'ะฒัะบะปััะฐะตั' ััะฒััะฒะฐ, ััะพะฑั ะฝะต ััะฒััะฒะพะฒะฐัั ะฑะพะปั. ะญัะพ ะฝะต ะฒัะฑะพั, ััะพ ะฐะฒัะพะผะฐัะธัะตัะบะฐั ะทะฐัะธัะฐ. ะัะบะปะธะบะฐะตััั ะปะธ ัะตะฑะต ััะฐ ะธะดะตั?"

**ะะฑัะฐัะธ ะฒะฝะธะผะฐะฝะธะต:**

- โ ะัะฟะพะปัะทะพะฒะฐะป ะทะฝะฐะฝะธั ะธะท chunk_42
- โ ะะพ ะณะพะฒะพัะธั ะฟัะพััะพ, ะฝะต "ัะผะฝะธัะฐะตั"
- โ ะะฐะบะฐะฝัะธะฒะฐะตั ะฒะพะฟัะพัะพะผ (ะฝะต ััะฒะตัะถะดะฐะตั)
- โ ะะธะฟะพัะตัะธัะฝะพ ("ะฟะพัะพะถะต", "ะผะพะถะตั ะฑััั")

***

## ๐ ะะธะทัะฐะปะธะทะฐัะธั: ะฅะะ โ4 (INTERVENTION)

```
USER MESSAGE
     โ
[Decision Gate] โ mode = INTERVENTION ๐ฏ
     โ
[Memory Layer]
  โโ Short-term (4 ัะพะดะฐ)
  โโ Working state
  โโ Summary
     โ
[Hybrid Query Builder] โ LLM ัะพัะผะธััะตั ะฟะพะธัะบะพะฒัะน ะทะฐะฟัะพั
     โ
[Local Embeddings Search] โ 7 ะบะฐะฝะดะธะดะฐัะพะฒ
     โ
[Voyage Re-rank] โ 1 ะปัััะธะน chunk
     โ
[Response Generator] โ ะฟัะพััะพะน ัะตะปะพะฒะตัะตัะบะธะน ะพัะฒะตั
     โ
BOT RESPONSE
```


***

# ๐จ ะฅะะ โ5: ะัะพะดะพะปะถะตะฝะธะต (ะฝะฐะทะฐะด ะฒ PRESENCE)

**ะะพะปัะทะพะฒะฐัะตะปั:**
> "ะะฐ, ัะพัะฝะพ! ะขะพ ะตััั ั ะฝะต ะฒะธะฝะพะฒะฐั?.."

***

## ๐ง ะะพะด ะบะฐะฟะพัะพะผ

### Decision gate

```python
# ะะพะฟัะพั? ะะ, ะฝะพ ะฝะต ะณะปัะฑะพะบะธะน
# ะญัะพ ัะผะพัะธะพะฝะฐะปัะฝะฐั ัะตะฐะบัะธั ะฝะฐ ะธะฝัะฐะนั

mode = "PRESENCE"  # ะะพะทะฒัะฐั ะฒ ะปะตะณะบะธะน ัะตะถะธะผ
```

**ะะพัะตะผั ะฝะต INTERVENTION?**

- ะะต ะฝัะถะฝะพ ัะฝะพะฒะฐ ะธัะบะฐัั ะฒ ะฑะฐะทะต
- Chunk ัะถะต ะธัะฟะพะปัะทะพะฒะฐะฝ
- ะกะตะนัะฐั ะฝัะถะฝะฐ ะฟะพะดะดะตัะถะบะฐ, ะฝะต ะฝะพะฒัะต ะทะฝะฐะฝะธั


### ะะฐะผััั

```
Short-term: ะฟะพัะปะตะดะฝะธะต 5 ัะพะดะพะฒ
ะะฐะทะฐ: ะะ ะธัะฟะพะปัะทัะตััั
Voyage: ะะ ะฒัะทัะฒะฐะตััั
```

**ะะพั:**
> "ะะตั, ัั ะฝะต ะฒะธะฝะพะฒะฐั. ะญัะพ ะฝะต ัะปะฐะฑะพััั ะธ ะฝะต ัะฒะพั ะฒะธะฝะฐ โ ััะพ ะบะฐะบ ะพัะณะฐะฝะธะทะผ ัะตะฐะณะธััะตั ะฝะฐ ะฟะตัะตะณััะทะบั."

**ะขะพะบะตะฝั:** ~2000
**ะกัะพะธะผะพััั:** \$0.02

***

# ๐จ ะฅะะ โ6: THINKING (ัะพะฝะพะฒะพะต ะพะฑะฝะพะฒะปะตะฝะธะต)

**ะะพะปัะทะพะฒะฐัะตะปั:**
> "ะฅะผ... ะ ััะพ ัะตะฟะตัั ั ััะธะผ ะดะตะปะฐัั?"

***

## ๐ง ะะพะด ะบะฐะฟะพัะพะผ

### Decision gate

```python
# ะฅะพะดะพะฒ: 6
# 6 % 5 == 1 (ะฝะต ะฟะพัะฐ ะพะฑะฝะพะฒะปััั)

# ะะพ ะตััั ะฒะพะฟัะพั "ััะพ ะดะตะปะฐัั?"
if "ััะพ ะดะตะปะฐัั" in message:
    mode = "INTERVENTION"
```

**ะะ! ะะตัะตะด INTERVENTION โ ะฟัะพะฒะตัะบะฐ:**

```python
# ะัะป ะปะธ ัะถะต ะฝะตะดะฐะฒะฝะพ INTERVENTION?
last_intervention = turn_4

if current_turn - last_intervention < 3:
    mode = "THINKING"  # ะะต ัะฟะตัะธะผ
```


### ะงัะพ ะดะตะปะฐะตั THINKING?

```
1. ะะฑะฝะพะฒะธัั working_state
2. ะะฑะฝะพะฒะธัั summary
3. ะะ ะธัะบะฐัั ะฝะพะฒัะน chunk
4. ะะฐัั ะผัะณะบะธะน ะพัะฒะตั
```

**ะะพั:**
> "ะฅะพัะพัะธะน ะฒะพะฟัะพั. ะะพ ะดะฐะฒะฐะน ัะฝะฐัะฐะปะฐ ัััั ะฟะพะฑัะดะตะผ ั ัะตะผ, ััะพ ะพัะบััะปะพัั. ะขั ะฟะพััะฒััะฒะพะฒะฐะป ะพะฑะปะตะณัะตะฝะธะต, ะบะพะณะดะฐ ะฟะพะฝัะป, ััะพ ััะพ ะทะฐัะธัะฐ?"

**ะขะพะบะตะฝั:** ~3000
**ะกัะพะธะผะพััั:** \$0.03

***

# ๐จ ะฅะะ โ7: ะัะพัะพะน INTERVENTION

**ะะพะปัะทะพะฒะฐัะตะปั:**
> "ะะฐ, ะปะตะณัะต ััะฐะปะพ. ะะพ ะฒัั ัะฐะฒะฝะพ โ ะบะฐะบ ั ััะธะผ ัะฐะฑะพัะฐัั? ะะฐะบ 'ะฒะบะปััะธัั' ะพะฑัะฐัะฝะพ ััะฒััะฒะฐ?"

***

## ๐ง ะะพะด ะบะฐะฟะพัะพะผ

### Decision gate

```python
# ะััะผะพะน ะทะฐะฟัะพั ะฝะฐ ะผะตัะพะด
# ะัะพัะปะพ 3 ัะพะดะฐ ะฟะพัะปะต ะฟะพัะปะตะดะฝะตะณะพ INTERVENTION

mode = "INTERVENTION"  # ะกะฝะพะฒะฐ ะณะปัะฑะพะบะธะน ัะตะถะธะผ
```


### Hybrid Query

**ะะพะฒัะน ะฟะพะธัะบะพะฒัะน ะทะฐะฟัะพั:**

```text
ะะพะฟัะพั ะพ ัะฟะพัะพะฑะฐั ะฒะพัััะฐะฝะพะฒะปะตะฝะธั ะบะพะฝัะฐะบัะฐ ั ััะฒััะฒะฐะผะธ 
ะฟะพัะปะต ัะผะพัะธะพะฝะฐะปัะฝะพะณะพ ะพะฝะตะผะตะฝะธั. ะะพะปัะทะพะฒะฐัะตะปั ัะถะต ะฟะพะฝัะป 
ะผะตัะฐะฝะธะทะผ ะทะฐัะธัั, ัะตะฟะตัั ะณะพัะพะฒ ะบ ะฟัะฐะบัะธัะตัะบะธะผ ัะฐะณะฐะผ. 
ะฃะผะตััะฝะฐ ะผัะณะบะฐั ะธะฝัะตัะฒะตะฝัะธั, ะฝะต ะธะฝััััะบัะธั.
```


### Embeddings โ Voyage

**ะะพะฒัะน chunk ะฒัะฑัะฐะฝ:**

```
chunk_73: "ะะพััะตะฟะตะฝะฝะพะต ัะฐะทะผะพัะฐะถะธะฒะฐะฝะธะต ััะฒััะฒ"
confidence: 0.79
```

**ะะพั:**
> "ะฅะพัะพัะพ, ััะพ ัั ะบ ััะพะผั ะณะพัะพะฒ. ะงัะฒััะฒะฐ ะฝะต 'ะฒะบะปััะฐัััั' ะพะดะฝะพะน ะบะฝะพะฟะบะพะน โ ััะพ ะฟะพััะตะฟะตะฝะฝัะน ะฟัะพัะตัั. ะะตัะฒัะน ัะฐะณ โ ะฝะฐัะฐัั ะทะฐะผะตัะฐัั ัะตะปะตัะฝัะต ะพัััะตะฝะธั. ะะดะต ัะตะนัะฐั ะฒ ัะตะปะต ะฝะฐะฟััะถะตะฝะธะต? ะะพะถะตัั ะฟะพััะฒััะฒะพะฒะฐัั?"

***

## ๐ ะัะพะณะพะฒะฐั ััะฐัะธััะธะบะฐ ะดะธะฐะปะพะณะฐ

| ะฅะพะด | ะะตะถะธะผ | Short-term | ะะฐะทะฐ | Voyage | ะขะพะบะตะฝั | ะกัะพะธะผะพััั |
| :-- | :-- | :-- | :-- | :-- | :-- | :-- |
| 1 | PRESENCE | 1 ัะพะด | โ | โ | 500 | \$0.005 |
| 2 | PRESENCE | 2 ัะพะดะฐ | โ | โ | 800 | \$0.008 |
| 3 | PRESENCE | 3 ัะพะดะฐ | โ | โ | 1200 | \$0.012 |
| 4 | **INTERVENTION** | 4 ัะพะดะฐ | โ | โ | 6000 | \$0.060 |
| 5 | PRESENCE | 5 ัะพะดะพะฒ | โ | โ | 2000 | \$0.020 |
| 6 | THINKING | 6 ัะพะดะพะฒ | โ | โ | 3000 | \$0.030 |
| 7 | **INTERVENTION** | 7 ัะพะดะพะฒ | โ | โ | 6500 | \$0.065 |
| **ะะขะะะ** |  |  |  |  | **20K** | **\$0.20** |

**ะะฐัะฟัะตะดะตะปะตะฝะธะต ัะตะถะธะผะพะฒ:**

- PRESENCE: 57% (4 ะธะท 7)
- INTERVENTION: 29% (2 ะธะท 7)
- THINKING: 14% (1 ะธะท 7)

***

## ๐ฏ ะะปััะตะฒัะต ะฒัะฒะพะดั (ะฟัะพัััะผ ัะทัะบะพะผ)

### 1. ะะพั ัะฐะฑะพัะฐะตั ะฒ 3 ัะบะพัะพัััั ๐

**PRESENCE (1-ั ะฟะตัะตะดะฐัะฐ):**

- ะกะปััะฐะตั, ะพััะฐะถะฐะตั
- ะะฐะปะพ ัะพะบะตะฝะพะฒ, ะฑััััะพ
- ะะต ะปะตะทะตั ะฒ ะฑะฐะทั

**THINKING (2-ั ะฟะตัะตะดะฐัะฐ):**

- ะะฑะฝะพะฒะปัะตั ัะฒะพั ะฟะพะฝะธะผะฐะฝะธะต
- ะกัะตะดะฝัั ะฝะฐะณััะทะบะฐ
- ะะต ะฟะพะบะฐะทัะฒะฐะตั ะฟะพะปัะทะพะฒะฐัะตะปั

**INTERVENTION (5-ั ะฟะตัะตะดะฐัะฐ):**

- ะัะตั ะฒ ะฑะฐะทะต ะทะฝะฐะฝะธะน
- ะัะทัะฒะฐะตั Voyage
- ะะฐัั ะณะปัะฑะพะบะธะน ะพัะฒะตั
- ะะพัะพะณะพ, ะฝะพ ัะพัะฝะพ


### 2. ะะฐะผััั ัะฐัััั ะฟะพััะตะฟะตะฝะฝะพ ๐

```
ะฅะพะด 1: [โข]
ะฅะพะด 2: [โข โข]
ะฅะพะด 3: [โข โข โข]
ะฅะพะด 4: [โข โข โข โข] + ะฑะฐะทะฐ ะทะฝะฐะฝะธะน
ะฅะพะด 5: [โข โข โข โข โข]
```


### 3. Hybrid Query = ะฟะตัะตะพัะผััะปะตะฝะธะต ะฒะพะฟัะพัะฐ ๐ง

**ะะ ะธัะตะผ ะฟะพ:** "ะะพัะตะผั ัะฐะบ ะฟัะพะธััะพะดะธั?"

**ะัะตะผ ะฟะพ:**
> "ะะพะฟัะพั ะพ ะฟัะธัะธะฝะฐั ัะผะพัะธะพะฝะฐะปัะฝะพะณะพ ะพะฝะตะผะตะฝะธั,
> ะฝะฐัะฐััะฐััะตะณะพ 3-4 ะผะตัััะฐ, ะฒ ะบะพะฝัะตะบััะต ะฟะพะฟััะบะธ
> ัะฐัะธะพะฝะฐะปะธะทะฐัะธะธ ะธ ะทะฐัะธัั ะพั ััััััะฐัะธะธ"

### 4. Voyage = ะฐัะฑะธัั, ะฝะต ะฟะพะธัะบะพะฒะธะบ โ๏ธ

**ะะพะบะฐะปัะฝัะต embeddings:** "ะะพั 7 ะฟะพัะพะถะธั ะบััะบะพะฒ"
**Voyage:** "ะะท ััะธั 7 ะฒะพั ะญะขะะข โ ัะฐะผัะน ัะพัะฝัะน"

***

## ๐๏ธ ะััะธัะตะบัััะฐ ะพะดะฝะพะน ะบะฐััะธะฝะบะพะน

```
         USER MESSAGE
              โ
      โโโโโโโโโโโโโโโโ
      โ DECISION     โ  ะะฐะบะพะน ัะตะถะธะผ?
      โ GATE         โ  
      โโโโโโโโฌโโโโโโโโ
             โโโโ 80% โ [PRESENCE] โ Short-term (3-5 ัะพะดะพะฒ)
             โโโโ 15% โ [THINKING] โ Short-term + State update
             โโโโ 5%  โ [INTERVENTION] โ
                                       โ
                        โโโโโโโโโโโโโโโโโโโโโโโโ
                        โ MEMORY LAYER         โ
                        โ - Short: 15-20 ัะพะดะพะฒ โ
                        โ - Summary            โ
                        โ - Working State      โ
                        โโโโโโโโฌโโโโโโโโโโโโโโโโ
                               โ
                        โโโโโโโโโโโโโโโโโโโโ
                        โ HYBRID QUERY     โ  LLM ะฟะตัะตะพัะผััะปัะตั
                        โ BUILDER          โ  ะฒะพะฟัะพั ะฒ ะบะพะฝัะตะบััะต
                        โโโโโโโโฌโโโโโโโโโโโโ
                               โ
                        โโโโโโโโโโโโโโโโโโโโ
                        โ LOCAL            โ  ะะฐัะธ embeddings
                        โ EMBEDDINGS       โ  Top-7 candidates
                        โโโโโโโโฌโโโโโโโโโโโโ
                               โ
                        โโโโโโโโโโโโโโโโโโโโ
                        โ VOYAGE AI        โ  ะัะฑะพั ะปัััะตะณะพ
                        โ RE-RANK          โ  confidence
                        โโโโโโโโฌโโโโโโโโโโโโ
                               โ
                        โโโโโโโโโโโโโโโโโโโโ
                        โ RESPONSE         โ  ะัะพััะพะน
                        โ GENERATOR        โ  ัะตะปะพะฒะตัะตัะบะธะน ะพัะฒะตั
                        โโโโโโโโฌโโโโโโโโโโโโ
                               โ
                          BOT RESPONSE
```


***

## ๐ก ะะปะฐะฒะฝะฐั ะธะดะตั (ะดะปั ัะบะพะปัะฝะธะบะฐ)

ะัะตะดััะฐะฒั, ััะพ ะฑะพั โ ััะพ **ัะผะฝัะน ะดััะณ ั ะฑะธะฑะปะธะพัะตะบะพะน**:

1. **ะะฑััะฝะพ** ะพะฝ ะฟัะพััะพ ัะปััะฐะตั ัะตะฑั (PRESENCE)
2. **ะะฝะพะณะดะฐ** ะพะฝ ะฟัะพ ัะตะฑั ะดัะผะฐะตั ะพ ัะฐะทะณะพะฒะพัะต (THINKING)
3. **ะะตะดะบะพ**, ะบะพะณะดะฐ ัั ะทะฐะดะฐััั ะฒะฐะถะฝัะน ะฒะพะฟัะพั, ะพะฝ:
    - ะัะฟะพะผะธะฝะฐะตั ะะกะ, ััะพ ะฒั ะพะฑััะถะดะฐะปะธ
    - ะะดัั ะฒ ะฑะธะฑะปะธะพัะตะบั
    - ะัะธะฝะพัะธั 7 ะบะฝะธะณ
    - ะะพะฒัั ัะบัะฟะตััะฐ: "ะะฐะบะฐั ะบะฝะธะณะฐ ัะพัะฝะพ ะพัะฒะตัะธั?"
    - ะงะธัะฐะตั ะตั
    - ะะฑัััะฝัะตั ัะตะฑะต ะะะะกะขะซะะ ัะปะพะฒะฐะผะธ

**ะะต ะบะฐะถะดัะน ัะฐะท ะธะดัั ะฒ ะฑะธะฑะปะธะพัะตะบั** โ ัะพะปัะบะพ ะบะพะณะดะฐ ัะตะฐะปัะฝะพ ะฝัะถะฝะพ!



